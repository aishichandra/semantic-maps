(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const T of m.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&a(T)}).observe(document,{childList:!0,subtree:!0});function n(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerpolicy&&(m.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?m.credentials="include":d.crossorigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function a(d){if(d.ep)return;d.ep=!0;const m=n(d);fetch(d.href,m)}})();function gr(){}function Ns(e){return e()}function rs(){return Object.create(null)}function zr(e){e.forEach(Ns)}function Is(e){return typeof e=="function"}function Ua(e,r){return e!=e?r==r:e!==r||e&&typeof e=="object"||typeof e=="function"}function sd(e){return Object.keys(e).length===0}function je(e,r){e.appendChild(r)}function Mt(e,r,n){e.insertBefore(r,n||null)}function Ft(e){e.parentNode.removeChild(e)}function Ms(e,r){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(r)}function nt(e){return document.createElement(e)}function yr(e){return document.createTextNode(e)}function Lt(){return yr(" ")}function Vt(e,r,n,a){return e.addEventListener(r,n,a),()=>e.removeEventListener(r,n,a)}function Ge(e,r,n){n==null?e.removeAttribute(r):e.getAttribute(r)!==n&&e.setAttribute(r,n)}function ud(e){return e===""?null:+e}function ld(e){return Array.from(e.childNodes)}function jr(e,r){r=""+r,e.wholeText!==r&&(e.data=r)}function ns(e,r){e.value=r==null?"":r}function ur(e,r,n,a){n===null?e.style.removeProperty(r):e.style.setProperty(r,n,a?"important":"")}function as(e,r){for(let n=0;n<e.options.length;n+=1){const a=e.options[n];if(a.__value===r){a.selected=!0;return}}e.selectedIndex=-1}function cd(e){const r=e.querySelector(":checked")||e.options[0];return r&&r.__value}function dd(e,r,{bubbles:n=!1,cancelable:a=!1}={}){const d=document.createEvent("CustomEvent");return d.initCustomEvent(e,n,a,r),d}let Wn;function zn(e){Wn=e}function $i(){if(!Wn)throw new Error("Function called outside component initialization");return Wn}function ef(e){$i().$$.on_mount.push(e)}function hd(e){$i().$$.on_destroy.push(e)}function md(){const e=$i();return(r,n,{cancelable:a=!1}={})=>{const d=e.$$.callbacks[r];if(d){const m=dd(r,n,{cancelable:a});return d.slice().forEach(T=>{T.call(e,m)}),!m.defaultPrevented}return!0}}const Vn=[],Vr=[],ka=[],Hi=[],pd=Promise.resolve();let Xi=!1;function vd(){Xi||(Xi=!0,pd.then(Bs))}function Ga(e){ka.push(e)}function is(e){Hi.push(e)}const ji=new Set;let Ra=0;function Bs(){const e=Wn;do{for(;Ra<Vn.length;){const r=Vn[Ra];Ra++,zn(r),_d(r.$$)}for(zn(null),Vn.length=0,Ra=0;Vr.length;)Vr.pop()();for(let r=0;r<ka.length;r+=1){const n=ka[r];ji.has(n)||(ji.add(n),n())}ka.length=0}while(Vn.length);for(;Hi.length;)Hi.pop()();Xi=!1,ji.clear(),zn(e)}function _d(e){if(e.fragment!==null){e.update(),zr(e.before_update);const r=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,r),e.after_update.forEach(Ga)}}const Da=new Set;let tn;function Ps(){tn={r:0,c:[],p:tn}}function Us(){tn.r||zr(tn.c),tn=tn.p}function Dr(e,r){e&&e.i&&(Da.delete(e),e.i(r))}function nn(e,r,n,a){if(e&&e.o){if(Da.has(e))return;Da.add(e),tn.c.push(()=>{Da.delete(e),a&&(n&&e.d(1),a())}),e.o(r)}else a&&a()}function fs(e,r,n){const a=e.$$.props[r];a!==void 0&&(e.$$.bound[a]=n,n(e.$$.ctx[a]))}function tf(e){e&&e.c()}function ja(e,r,n,a){const{fragment:d,after_update:m}=e.$$;d&&d.m(r,n),a||Ga(()=>{const T=e.$$.on_mount.map(Ns).filter(Is);e.$$.on_destroy?e.$$.on_destroy.push(...T):zr(T),e.$$.on_mount=[]}),m.forEach(Ga)}function Va(e,r){const n=e.$$;n.fragment!==null&&(zr(n.on_destroy),n.fragment&&n.fragment.d(r),n.on_destroy=n.fragment=null,n.ctx=[])}function bd(e,r){e.$$.dirty[0]===-1&&(Vn.push(e),vd(),e.$$.dirty.fill(0)),e.$$.dirty[r/31|0]|=1<<r%31}function za(e,r,n,a,d,m,T,y=[-1]){const N=Wn;zn(e);const x=e.$$={fragment:null,ctx:[],props:m,update:gr,not_equal:d,bound:rs(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(N?N.$$.context:[])),callbacks:rs(),dirty:y,skip_bound:!1,root:r.target||N.$$.root};T&&T(x.root);let q=!1;if(x.ctx=n?n(e,r.props||{},(ee,ve,...Me)=>{const ke=Me.length?Me[0]:ve;return x.ctx&&d(x.ctx[ee],x.ctx[ee]=ke)&&(!x.skip_bound&&x.bound[ee]&&x.bound[ee](ke),q&&bd(e,ee)),ve}):[],x.update(),q=!0,zr(x.before_update),x.fragment=a?a(x.ctx):!1,r.target){if(r.hydrate){const ee=ld(r.target);x.fragment&&x.fragment.l(ee),ee.forEach(Ft)}else x.fragment&&x.fragment.c();r.intro&&Dr(e.$$.fragment),ja(e,r.target,r.anchor,r.customElement),Bs()}zn(N)}class Ha{$destroy(){Va(this,1),this.$destroy=gr}$on(r,n){if(!Is(n))return gr;const a=this.$$.callbacks[r]||(this.$$.callbacks[r]=[]);return a.push(n),()=>{const d=a.indexOf(n);d!==-1&&a.splice(d,1)}}$set(r){this.$$set&&!sd(r)&&(this.$$.skip_bound=!0,this.$$set(r),this.$$.skip_bound=!1)}}var js=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vs={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/(function(e,r){((n,a)=>{e.exports=a()})(js,function n(){var a=typeof self<"u"?self:typeof window<"u"?window:a!==void 0?a:{},d,m=!a.document&&!!a.postMessage,T=a.IS_PAPA_WORKER||!1,y={},N=0,x={};function q(L){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(O){var H=Ke(O);H.chunkSize=parseInt(H.chunkSize),O.step||O.chunk||(H.chunkSize=null),this._handle=new lt(H),(this._handle.streamer=this)._config=H}.call(this,L),this.parseChunk=function(O,H){var P=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<P){let Te=this._config.newline;Te||(fe=this._config.quoteChar||'"',Te=this._handle.guessLineEndings(O,fe)),O=[...O.split(Te).slice(P)].join(Te)}this.isFirstChunk&&We(this._config.beforeFirstChunk)&&(fe=this._config.beforeFirstChunk(O))!==void 0&&(O=fe),this.isFirstChunk=!1,this._halted=!1;var P=this._partialLine+O,fe=(this._partialLine="",this._handle.parse(P,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(O=fe.meta.cursor,P=(this._finished||(this._partialLine=P.substring(O-this._baseIndex),this._baseIndex=O),fe&&fe.data&&(this._rowCount+=fe.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),T)a.postMessage({results:fe,workerId:x.WORKER_ID,finished:P});else if(We(this._config.chunk)&&!H){if(this._config.chunk(fe,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=fe=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(fe.data),this._completeResults.errors=this._completeResults.errors.concat(fe.errors),this._completeResults.meta=fe.meta),this._completed||!P||!We(this._config.complete)||fe&&fe.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),P||fe&&fe.meta.paused||this._nextChunk(),fe}this._halted=!0},this._sendError=function(O){We(this._config.error)?this._config.error(O):T&&this._config.error&&a.postMessage({workerId:x.WORKER_ID,error:O,finished:!1})}}function ee(L){var O;(L=L||{}).chunkSize||(L.chunkSize=x.RemoteChunkSize),q.call(this,L),this._nextChunk=m?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(H){this._input=H,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(O=new XMLHttpRequest,this._config.withCredentials&&(O.withCredentials=this._config.withCredentials),m||(O.onload=pt(this._chunkLoaded,this),O.onerror=pt(this._chunkError,this)),O.open(this._config.downloadRequestBody?"POST":"GET",this._input,!m),this._config.downloadRequestHeaders){var H,P=this._config.downloadRequestHeaders;for(H in P)O.setRequestHeader(H,P[H])}var fe;this._config.chunkSize&&(fe=this._start+this._config.chunkSize-1,O.setRequestHeader("Range","bytes="+this._start+"-"+fe));try{O.send(this._config.downloadRequestBody)}catch(Te){this._chunkError(Te.message)}m&&O.status===0&&this._chunkError()}},this._chunkLoaded=function(){O.readyState===4&&(O.status<200||400<=O.status?this._chunkError():(this._start+=this._config.chunkSize||O.responseText.length,this._finished=!this._config.chunkSize||this._start>=(H=>(H=H.getResponseHeader("Content-Range"))!==null?parseInt(H.substring(H.lastIndexOf("/")+1)):-1)(O),this.parseChunk(O.responseText)))},this._chunkError=function(H){H=O.statusText||H,this._sendError(new Error(H))}}function ve(L){(L=L||{}).chunkSize||(L.chunkSize=x.LocalChunkSize),q.call(this,L);var O,H,P=typeof FileReader<"u";this.stream=function(fe){this._input=fe,H=fe.slice||fe.webkitSlice||fe.mozSlice,P?((O=new FileReader).onload=pt(this._chunkLoaded,this),O.onerror=pt(this._chunkError,this)):O=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var fe=this._input,Te=(this._config.chunkSize&&(Te=Math.min(this._start+this._config.chunkSize,this._input.size),fe=H.call(fe,this._start,Te)),O.readAsText(fe,this._config.encoding));P||this._chunkLoaded({target:{result:Te}})},this._chunkLoaded=function(fe){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(fe.target.result)},this._chunkError=function(){this._sendError(O.error)}}function Me(L){var O;q.call(this,L=L||{}),this.stream=function(H){return O=H,this._nextChunk()},this._nextChunk=function(){var H,P;if(!this._finished)return H=this._config.chunkSize,O=H?(P=O.substring(0,H),O.substring(H)):(P=O,""),this._finished=!O,this.parseChunk(P)}}function ke(L){q.call(this,L=L||{});var O=[],H=!0,P=!1;this.pause=function(){q.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){q.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(fe){this._input=fe,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){P&&O.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),O.length?this.parseChunk(O.shift()):H=!0},this._streamData=pt(function(fe){try{O.push(typeof fe=="string"?fe:fe.toString(this._config.encoding)),H&&(H=!1,this._checkIsFinished(),this.parseChunk(O.shift()))}catch(Te){this._streamError(Te)}},this),this._streamError=pt(function(fe){this._streamCleanUp(),this._sendError(fe)},this),this._streamEnd=pt(function(){this._streamCleanUp(),P=!0,this._streamData("")},this),this._streamCleanUp=pt(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function lt(L){var O,H,P,fe,Te=Math.pow(2,53),at=-Te,St=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,De=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,Se=this,Ne=0,ue=0,Je=!1,Be=!1,Qe=[],Oe={data:[],errors:[],meta:{}};function xt(Le){return L.skipEmptyLines==="greedy"?Le.join("").trim()==="":Le.length===1&&Le[0].length===0}function _t(){if(Oe&&P&&(Re("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+x.DefaultDelimiter+"'"),P=!1),L.skipEmptyLines&&(Oe.data=Oe.data.filter(function(Et){return!xt(Et)})),ut()){let Et=function(Ct,At){We(L.transformHeader)&&(Ct=L.transformHeader(Ct,At)),Qe.push(Ct)};var et=Et;if(Oe)if(Array.isArray(Oe.data[0])){for(var Le=0;ut()&&Le<Oe.data.length;Le++)Oe.data[Le].forEach(Et);Oe.data.splice(0,1)}else Oe.data.forEach(Et)}function we(Et,Ct){for(var At=L.header?{}:[],ht=0;ht<Et.length;ht++){var ft=ht,Dt=Et[ht],Dt=((ze,dt)=>(bt=>(L.dynamicTypingFunction&&L.dynamicTyping[bt]===void 0&&(L.dynamicTyping[bt]=L.dynamicTypingFunction(bt)),(L.dynamicTyping[bt]||L.dynamicTyping)===!0))(ze)?dt==="true"||dt==="TRUE"||dt!=="false"&&dt!=="FALSE"&&((bt=>{if(St.test(bt)&&(bt=parseFloat(bt),at<bt&&bt<Te))return 1})(dt)?parseFloat(dt):De.test(dt)?new Date(dt):dt===""?null:dt):dt)(ft=L.header?ht>=Qe.length?"__parsed_extra":Qe[ht]:ft,Dt=L.transform?L.transform(Dt,ft):Dt);ft==="__parsed_extra"?(At[ft]=At[ft]||[],At[ft].push(Dt)):At[ft]=Dt}return L.header&&(ht>Qe.length?Re("FieldMismatch","TooManyFields","Too many fields: expected "+Qe.length+" fields but parsed "+ht,ue+Ct):ht<Qe.length&&Re("FieldMismatch","TooFewFields","Too few fields: expected "+Qe.length+" fields but parsed "+ht,ue+Ct)),At}var $e;Oe&&(L.header||L.dynamicTyping||L.transform)&&($e=1,!Oe.data.length||Array.isArray(Oe.data[0])?(Oe.data=Oe.data.map(we),$e=Oe.data.length):Oe.data=we(Oe.data,0),L.header&&Oe.meta&&(Oe.meta.fields=Qe),ue+=$e)}function ut(){return L.header&&Qe.length===0}function Re(Le,we,$e,et){Le={type:Le,code:we,message:$e},et!==void 0&&(Le.row=et),Oe.errors.push(Le)}We(L.step)&&(fe=L.step,L.step=function(Le){Oe=Le,ut()?_t():(_t(),Oe.data.length!==0&&(Ne+=Le.data.length,L.preview&&Ne>L.preview?H.abort():(Oe.data=Oe.data[0],fe(Oe,Se))))}),this.parse=function(Le,we,$e){var et=L.quoteChar||'"',et=(L.newline||(L.newline=this.guessLineEndings(Le,et)),P=!1,L.delimiter?We(L.delimiter)&&(L.delimiter=L.delimiter(Le),Oe.meta.delimiter=L.delimiter):((et=((Et,Ct,At,ht,ft)=>{var Dt,ze,dt,bt;ft=ft||[",","	","|",";",x.RECORD_SEP,x.UNIT_SEP];for(var lr=0;lr<ft.length;lr++){for(var nr,f=ft[lr],yt=0,ar=0,Bt=0,qt=(dt=void 0,new Ye({comments:ht,delimiter:f,newline:Ct,preview:10}).parse(Et)),Yt=0;Yt<qt.data.length;Yt++)At&&xt(qt.data[Yt])?Bt++:(nr=qt.data[Yt].length,ar+=nr,dt===void 0?dt=nr:0<nr&&(yt+=Math.abs(nr-dt),dt=nr));0<qt.data.length&&(ar/=qt.data.length-Bt),(ze===void 0||yt<=ze)&&(bt===void 0||bt<ar)&&1.99<ar&&(ze=yt,Dt=f,bt=ar)}return{successful:!!(L.delimiter=Dt),bestDelimiter:Dt}})(Le,L.newline,L.skipEmptyLines,L.comments,L.delimitersToGuess)).successful?L.delimiter=et.bestDelimiter:(P=!0,L.delimiter=x.DefaultDelimiter),Oe.meta.delimiter=L.delimiter),Ke(L));return L.preview&&L.header&&et.preview++,O=Le,H=new Ye(et),Oe=H.parse(O,we,$e),_t(),Je?{meta:{paused:!0}}:Oe||{meta:{paused:!1}}},this.paused=function(){return Je},this.pause=function(){Je=!0,H.abort(),O=We(L.chunk)?"":O.substring(H.getCharIndex())},this.resume=function(){Se.streamer._halted?(Je=!1,Se.streamer.parseChunk(O,!0)):setTimeout(Se.resume,3)},this.aborted=function(){return Be},this.abort=function(){Be=!0,H.abort(),Oe.meta.aborted=!0,We(L.complete)&&L.complete(Oe),O=""},this.guessLineEndings=function(Et,et){Et=Et.substring(0,1048576);var et=new RegExp(Ce(et)+"([^]*?)"+Ce(et),"gm"),$e=(Et=Et.replace(et,"")).split("\r"),et=Et.split(`
`),Et=1<et.length&&et[0].length<$e[0].length;if($e.length===1||Et)return`
`;for(var Ct=0,At=0;At<$e.length;At++)$e[At][0]===`
`&&Ct++;return Ct>=$e.length/2?`\r
`:"\r"}}function Ce(L){return L.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ye(L){var O=(L=L||{}).delimiter,H=L.newline,P=L.comments,fe=L.step,Te=L.preview,at=L.fastMode,St=null,De=!1,Se=L.quoteChar==null?'"':L.quoteChar,Ne=Se;if(L.escapeChar!==void 0&&(Ne=L.escapeChar),(typeof O!="string"||-1<x.BAD_DELIMITERS.indexOf(O))&&(O=","),P===O)throw new Error("Comment character same as delimiter");P===!0?P="#":(typeof P!="string"||-1<x.BAD_DELIMITERS.indexOf(P))&&(P=!1),H!==`
`&&H!=="\r"&&H!==`\r
`&&(H=`
`);var ue=0,Je=!1;this.parse=function(Be,Qe,Oe){if(typeof Be!="string")throw new Error("Input must be a string");var xt=Be.length,_t=O.length,ut=H.length,Re=P.length,Le=We(fe),we=[],$e=[],et=[],Et=ue=0;if(!Be)return yt();if(at||at!==!1&&Be.indexOf(Se)===-1){for(var Ct=Be.split(H),At=0;At<Ct.length;At++){if(et=Ct[At],ue+=et.length,At!==Ct.length-1)ue+=H.length;else if(Oe)return yt();if(!P||et.substring(0,Re)!==P){if(Le){if(we=[],bt(et.split(O)),ar(),Je)return yt()}else bt(et.split(O));if(Te&&Te<=At)return we=we.slice(0,Te),yt(!0)}}return yt()}for(var ht=Be.indexOf(O,ue),ft=Be.indexOf(H,ue),Dt=new RegExp(Ce(Ne)+Ce(Se),"g"),ze=Be.indexOf(Se,ue);;)if(Be[ue]===Se)for(ze=ue,ue++;;){if((ze=Be.indexOf(Se,ze+1))===-1)return Oe||$e.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:we.length,index:ue}),nr();if(ze===xt-1)return nr(Be.substring(ue,ze).replace(Dt,Se));if(Se===Ne&&Be[ze+1]===Ne)ze++;else if(Se===Ne||ze===0||Be[ze-1]!==Ne){ht!==-1&&ht<ze+1&&(ht=Be.indexOf(O,ze+1));var dt=lr((ft=ft!==-1&&ft<ze+1?Be.indexOf(H,ze+1):ft)===-1?ht:Math.min(ht,ft));if(Be.substr(ze+1+dt,_t)===O){et.push(Be.substring(ue,ze).replace(Dt,Se)),Be[ue=ze+1+dt+_t]!==Se&&(ze=Be.indexOf(Se,ue)),ht=Be.indexOf(O,ue),ft=Be.indexOf(H,ue);break}if(dt=lr(ft),Be.substring(ze+1+dt,ze+1+dt+ut)===H){if(et.push(Be.substring(ue,ze).replace(Dt,Se)),f(ze+1+dt+ut),ht=Be.indexOf(O,ue),ze=Be.indexOf(Se,ue),Le&&(ar(),Je))return yt();if(Te&&we.length>=Te)return yt(!0);break}$e.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:we.length,index:ue}),ze++}}else if(P&&et.length===0&&Be.substring(ue,ue+Re)===P){if(ft===-1)return yt();ue=ft+ut,ft=Be.indexOf(H,ue),ht=Be.indexOf(O,ue)}else if(ht!==-1&&(ht<ft||ft===-1))et.push(Be.substring(ue,ht)),ue=ht+_t,ht=Be.indexOf(O,ue);else{if(ft===-1)break;if(et.push(Be.substring(ue,ft)),f(ft+ut),Le&&(ar(),Je))return yt();if(Te&&we.length>=Te)return yt(!0)}return nr();function bt(Bt){we.push(Bt),Et=ue}function lr(Bt){var qt=0;return qt=Bt!==-1&&(Bt=Be.substring(ze+1,Bt))&&Bt.trim()===""?Bt.length:qt}function nr(Bt){return Oe||(Bt===void 0&&(Bt=Be.substring(ue)),et.push(Bt),ue=xt,bt(et),Le&&ar()),yt()}function f(Bt){ue=Bt,bt(et),et=[],ft=Be.indexOf(H,ue)}function yt(Bt){if(L.header&&!Qe&&we.length&&!De){var qt=we[0],Yt={},mr=new Set(qt);let tr=!1;for(let cr=0;cr<qt.length;cr++){let zt=qt[cr];if(Yt[zt=We(L.transformHeader)?L.transformHeader(zt,cr):zt]){let xr,ot=Yt[zt];for(;xr=zt+"_"+ot,ot++,mr.has(xr););mr.add(xr),qt[cr]=xr,Yt[zt]++,tr=!0,(St=St===null?{}:St)[xr]=zt}else Yt[zt]=1,qt[cr]=zt;mr.add(zt)}tr&&console.warn("Duplicate headers found and renamed."),De=!0}return{data:we,errors:$e,meta:{delimiter:O,linebreak:H,aborted:Je,truncated:!!Bt,cursor:Et+(Qe||0),renamedHeaders:St}}}function ar(){fe(yt()),we=[],$e=[]}},this.abort=function(){Je=!0},this.getCharIndex=function(){return ue}}function st(L){var O=L.data,H=y[O.workerId],P=!1;if(O.error)H.userError(O.error,O.file);else if(O.results&&O.results.data){var fe={abort:function(){P=!0,gt(O.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:vt,resume:vt};if(We(H.userStep)){for(var Te=0;Te<O.results.data.length&&(H.userStep({data:O.results.data[Te],errors:O.results.errors,meta:O.results.meta},fe),!P);Te++);delete O.results}else We(H.userChunk)&&(H.userChunk(O.results,fe,O.file),delete O.results)}O.finished&&!P&&gt(O.workerId,O.results)}function gt(L,O){var H=y[L];We(H.userComplete)&&H.userComplete(O),H.terminate(),delete y[L]}function vt(){throw new Error("Not implemented.")}function Ke(L){if(typeof L!="object"||L===null)return L;var O,H=Array.isArray(L)?[]:{};for(O in L)H[O]=Ke(L[O]);return H}function pt(L,O){return function(){L.apply(O,arguments)}}function We(L){return typeof L=="function"}return x.parse=function(L,O){var H=(O=O||{}).dynamicTyping||!1;if(We(H)&&(O.dynamicTypingFunction=H,H={}),O.dynamicTyping=H,O.transform=!!We(O.transform)&&O.transform,!O.worker||!x.WORKERS_SUPPORTED)return H=null,x.NODE_STREAM_INPUT,typeof L=="string"?(L=(P=>P.charCodeAt(0)!==65279?P:P.slice(1))(L),H=new(O.download?ee:Me)(O)):L.readable===!0&&We(L.read)&&We(L.on)?H=new ke(O):(a.File&&L instanceof File||L instanceof Object)&&(H=new ve(O)),H.stream(L);(H=(()=>{var P;return!!x.WORKERS_SUPPORTED&&(P=(()=>{var fe=a.URL||a.webkitURL||null,Te=n.toString();return x.BLOB_URL||(x.BLOB_URL=fe.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",Te,")();"],{type:"text/javascript"})))})(),(P=new a.Worker(P)).onmessage=st,P.id=N++,y[P.id]=P)})()).userStep=O.step,H.userChunk=O.chunk,H.userComplete=O.complete,H.userError=O.error,O.step=We(O.step),O.chunk=We(O.chunk),O.complete=We(O.complete),O.error=We(O.error),delete O.worker,H.postMessage({input:L,config:O,workerId:H.id})},x.unparse=function(L,O){var H=!1,P=!0,fe=",",Te=`\r
`,at='"',St=at+at,De=!1,Se=null,Ne=!1,ue=((()=>{if(typeof O=="object"){if(typeof O.delimiter!="string"||x.BAD_DELIMITERS.filter(function(Qe){return O.delimiter.indexOf(Qe)!==-1}).length||(fe=O.delimiter),typeof O.quotes!="boolean"&&typeof O.quotes!="function"&&!Array.isArray(O.quotes)||(H=O.quotes),typeof O.skipEmptyLines!="boolean"&&typeof O.skipEmptyLines!="string"||(De=O.skipEmptyLines),typeof O.newline=="string"&&(Te=O.newline),typeof O.quoteChar=="string"&&(at=O.quoteChar),typeof O.header=="boolean"&&(P=O.header),Array.isArray(O.columns)){if(O.columns.length===0)throw new Error("Option columns is empty");Se=O.columns}O.escapeChar!==void 0&&(St=O.escapeChar+at),O.escapeFormulae instanceof RegExp?Ne=O.escapeFormulae:typeof O.escapeFormulae=="boolean"&&O.escapeFormulae&&(Ne=/^[=+\-@\t\r].*$/)}})(),new RegExp(Ce(at),"g"));if(typeof L=="string"&&(L=JSON.parse(L)),Array.isArray(L)){if(!L.length||Array.isArray(L[0]))return Je(null,L,De);if(typeof L[0]=="object")return Je(Se||Object.keys(L[0]),L,De)}else if(typeof L=="object")return typeof L.data=="string"&&(L.data=JSON.parse(L.data)),Array.isArray(L.data)&&(L.fields||(L.fields=L.meta&&L.meta.fields||Se),L.fields||(L.fields=Array.isArray(L.data[0])?L.fields:typeof L.data[0]=="object"?Object.keys(L.data[0]):[]),Array.isArray(L.data[0])||typeof L.data[0]=="object"||(L.data=[L.data])),Je(L.fields||[],L.data||[],De);throw new Error("Unable to serialize unrecognized input");function Je(Qe,Oe,xt){var _t="",ut=(typeof Qe=="string"&&(Qe=JSON.parse(Qe)),typeof Oe=="string"&&(Oe=JSON.parse(Oe)),Array.isArray(Qe)&&0<Qe.length),Re=!Array.isArray(Oe[0]);if(ut&&P){for(var Le=0;Le<Qe.length;Le++)0<Le&&(_t+=fe),_t+=Be(Qe[Le],Le);0<Oe.length&&(_t+=Te)}for(var we=0;we<Oe.length;we++){var $e=(ut?Qe:Oe[we]).length,et=!1,Et=ut?Object.keys(Oe[we]).length===0:Oe[we].length===0;if(xt&&!ut&&(et=xt==="greedy"?Oe[we].join("").trim()==="":Oe[we].length===1&&Oe[we][0].length===0),xt==="greedy"&&ut){for(var Ct=[],At=0;At<$e;At++){var ht=Re?Qe[At]:At;Ct.push(Oe[we][ht])}et=Ct.join("").trim()===""}if(!et){for(var ft=0;ft<$e;ft++){0<ft&&!Et&&(_t+=fe);var Dt=ut&&Re?Qe[ft]:ft;_t+=Be(Oe[we][Dt],ft)}we<Oe.length-1&&(!xt||0<$e&&!Et)&&(_t+=Te)}}return _t}function Be(Qe,Oe){var xt,_t;return Qe==null?"":Qe.constructor===Date?JSON.stringify(Qe).slice(1,25):(_t=!1,Ne&&typeof Qe=="string"&&Ne.test(Qe)&&(Qe="'"+Qe,_t=!0),xt=Qe.toString().replace(ue,St),(_t=_t||H===!0||typeof H=="function"&&H(Qe,Oe)||Array.isArray(H)&&H[Oe]||((ut,Re)=>{for(var Le=0;Le<Re.length;Le++)if(-1<ut.indexOf(Re[Le]))return!0;return!1})(xt,x.BAD_DELIMITERS)||-1<xt.indexOf(fe)||xt.charAt(0)===" "||xt.charAt(xt.length-1)===" ")?at+xt+at:xt)}},x.RECORD_SEP=String.fromCharCode(30),x.UNIT_SEP=String.fromCharCode(31),x.BYTE_ORDER_MARK="\uFEFF",x.BAD_DELIMITERS=["\r",`
`,'"',x.BYTE_ORDER_MARK],x.WORKERS_SUPPORTED=!m&&!!a.Worker,x.NODE_STREAM_INPUT=1,x.LocalChunkSize=10485760,x.RemoteChunkSize=5242880,x.DefaultDelimiter=",",x.Parser=Ye,x.ParserHandle=lt,x.NetworkStreamer=ee,x.FileStreamer=ve,x.StringStreamer=Me,x.ReadableStreamStreamer=ke,a.jQuery&&((d=a.jQuery).fn.parse=function(L){var O=L.config||{},H=[];return this.each(function(Te){if(!(d(this).prop("tagName").toUpperCase()==="INPUT"&&d(this).attr("type").toLowerCase()==="file"&&a.FileReader)||!this.files||this.files.length===0)return!0;for(var at=0;at<this.files.length;at++)H.push({file:this.files[at],inputElem:this,instanceConfig:d.extend({},O)})}),P(),this;function P(){if(H.length===0)We(L.complete)&&L.complete();else{var Te,at,St,De,Se=H[0];if(We(L.before)){var Ne=L.before(Se.file,Se.inputElem);if(typeof Ne=="object"){if(Ne.action==="abort")return Te="AbortError",at=Se.file,St=Se.inputElem,De=Ne.reason,void(We(L.error)&&L.error({name:Te},at,St,De));if(Ne.action==="skip")return void fe();typeof Ne.config=="object"&&(Se.instanceConfig=d.extend(Se.instanceConfig,Ne.config))}else if(Ne==="skip")return void fe()}var ue=Se.instanceConfig.complete;Se.instanceConfig.complete=function(Je){We(ue)&&ue(Je,Se.file,Se.inputElem),fe()},x.parse(Se.file,Se.instanceConfig)}}function fe(){H.splice(0,1),P()}}),T&&(a.onmessage=function(L){L=L.data,x.WORKER_ID===void 0&&L&&(x.WORKER_ID=L.workerId),typeof L.input=="string"?a.postMessage({workerId:x.WORKER_ID,results:x.parse(L.input,L.config),finished:!0}):(a.File&&L.input instanceof File||L.input instanceof Object)&&(L=x.parse(L.input,L.config))&&a.postMessage({workerId:x.WORKER_ID,results:L,finished:!0})}),(ee.prototype=Object.create(q.prototype)).constructor=ee,(ve.prototype=Object.create(q.prototype)).constructor=ve,(Me.prototype=Object.create(Me.prototype)).constructor=Me,(ke.prototype=Object.create(q.prototype)).constructor=ke,x})})(Vs);const yd=Vs.exports;function Fa(e,r){return e==null||r==null?NaN:e<r?-1:e>r?1:e>=r?0:NaN}function gd(e,r){return e==null||r==null?NaN:r<e?-1:r>e?1:r>=e?0:NaN}function zs(e){let r,n,a;e.length!==2?(r=Fa,n=(y,N)=>Fa(e(y),N),a=(y,N)=>e(y)-N):(r=e===Fa||e===gd?e:xd,n=e,a=e);function d(y,N,x=0,q=y.length){if(x<q){if(r(N,N)!==0)return q;do{const ee=x+q>>>1;n(y[ee],N)<0?x=ee+1:q=ee}while(x<q)}return x}function m(y,N,x=0,q=y.length){if(x<q){if(r(N,N)!==0)return q;do{const ee=x+q>>>1;n(y[ee],N)<=0?x=ee+1:q=ee}while(x<q)}return x}function T(y,N,x=0,q=y.length){const ee=d(y,N,x,q-1);return ee>x&&a(y[ee-1],N)>-a(y[ee],N)?ee-1:ee}return{left:d,center:T,right:m}}function xd(){return 0}function Ed(e){return e===null?NaN:+e}const Ad=zs(Fa),Td=Ad.right;zs(Ed).center;const wd=Td;class os extends Map{constructor(r,n=Ld){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),r!=null)for(const[a,d]of r)this.set(a,d)}get(r){return super.get(ss(this,r))}has(r){return super.has(ss(this,r))}set(r,n){return super.set(Sd(this,r),n)}delete(r){return super.delete(Rd(this,r))}}function ss({_intern:e,_key:r},n){const a=r(n);return e.has(a)?e.get(a):n}function Sd({_intern:e,_key:r},n){const a=r(n);return e.has(a)?e.get(a):(e.set(a,n),n)}function Rd({_intern:e,_key:r},n){const a=r(n);return e.has(a)&&(n=e.get(a),e.delete(a)),n}function Ld(e){return e!==null&&typeof e=="object"?e.valueOf():e}var Wi=Math.sqrt(50),qi=Math.sqrt(10),Yi=Math.sqrt(2);function Cd(e,r,n){var a,d=-1,m,T,y;if(r=+r,e=+e,n=+n,e===r&&n>0)return[e];if((a=r<e)&&(m=e,e=r,r=m),(y=Hs(e,r,n))===0||!isFinite(y))return[];if(y>0){let N=Math.round(e/y),x=Math.round(r/y);for(N*y<e&&++N,x*y>r&&--x,T=new Array(m=x-N+1);++d<m;)T[d]=(N+d)*y}else{y=-y;let N=Math.round(e*y),x=Math.round(r*y);for(N/y<e&&++N,x/y>r&&--x,T=new Array(m=x-N+1);++d<m;)T[d]=(N+d)/y}return a&&T.reverse(),T}function Hs(e,r,n){var a=(r-e)/Math.max(0,n),d=Math.floor(Math.log(a)/Math.LN10),m=a/Math.pow(10,d);return d>=0?(m>=Wi?10:m>=qi?5:m>=Yi?2:1)*Math.pow(10,d):-Math.pow(10,-d)/(m>=Wi?10:m>=qi?5:m>=Yi?2:1)}function Od(e,r,n){var a=Math.abs(r-e)/Math.max(0,n),d=Math.pow(10,Math.floor(Math.log(a)/Math.LN10)),m=a/d;return m>=Wi?d*=10:m>=qi?d*=5:m>=Yi&&(d*=2),r<e?-d:d}function us(e,r){let n;if(r===void 0)for(const a of e)a!=null&&(n<a||n===void 0&&a>=a)&&(n=a);else{let a=-1;for(let d of e)(d=r(d,++a,e))!=null&&(n<d||n===void 0&&d>=d)&&(n=d)}return n}function ls(e,r){let n;if(r===void 0)for(const a of e)a!=null&&(n>a||n===void 0&&a>=a)&&(n=a);else{let a=-1;for(let d of e)(d=r(d,++a,e))!=null&&(n>d||n===void 0&&d>=d)&&(n=d)}return n}function Xs(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}const cs=Symbol("implicit");function Ws(){var e=new os,r=[],n=[],a=cs;function d(m){let T=e.get(m);if(T===void 0){if(a!==cs)return a;e.set(m,T=r.push(m)-1)}return n[T%n.length]}return d.domain=function(m){if(!arguments.length)return r.slice();r=[],e=new os;for(const T of m)e.has(T)||e.set(T,r.push(T)-1);return d},d.range=function(m){return arguments.length?(n=Array.from(m),d):n.slice()},d.unknown=function(m){return arguments.length?(a=m,d):a},d.copy=function(){return Ws(r,n).unknown(a)},Xs.apply(d,arguments),d}function rf(e,r,n){e.prototype=r.prototype=n,n.constructor=e}function qs(e,r){var n=Object.create(e.prototype);for(var a in r)n[a]=r[a];return n}function Kn(){}var qn=.7,Na=1/qn,An="\\s*([+-]?\\d+)\\s*",Yn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Sr="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kd=/^#([0-9a-f]{3,8})$/,Dd=new RegExp(`^rgb\\(${An},${An},${An}\\)$`),Fd=new RegExp(`^rgb\\(${Sr},${Sr},${Sr}\\)$`),Gd=new RegExp(`^rgba\\(${An},${An},${An},${Yn}\\)$`),Nd=new RegExp(`^rgba\\(${Sr},${Sr},${Sr},${Yn}\\)$`),Id=new RegExp(`^hsl\\(${Yn},${Sr},${Sr}\\)$`),Md=new RegExp(`^hsla\\(${Yn},${Sr},${Sr},${Yn}\\)$`),ds={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};rf(Kn,Qn,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:hs,formatHex:hs,formatHex8:Bd,formatHsl:Pd,formatRgb:ms,toString:ms});function hs(){return this.rgb().formatHex()}function Bd(){return this.rgb().formatHex8()}function Pd(){return Ys(this).formatHsl()}function ms(){return this.rgb().formatRgb()}function Qn(e){var r,n;return e=(e+"").trim().toLowerCase(),(r=kd.exec(e))?(n=r[1].length,r=parseInt(r[1],16),n===6?ps(r):n===3?new fr(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):n===8?La(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):n===4?La(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=Dd.exec(e))?new fr(r[1],r[2],r[3],1):(r=Fd.exec(e))?new fr(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=Gd.exec(e))?La(r[1],r[2],r[3],r[4]):(r=Nd.exec(e))?La(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=Id.exec(e))?bs(r[1],r[2]/100,r[3]/100,1):(r=Md.exec(e))?bs(r[1],r[2]/100,r[3]/100,r[4]):ds.hasOwnProperty(e)?ps(ds[e]):e==="transparent"?new fr(NaN,NaN,NaN,0):null}function ps(e){return new fr(e>>16&255,e>>8&255,e&255,1)}function La(e,r,n,a){return a<=0&&(e=r=n=NaN),new fr(e,r,n,a)}function Ud(e){return e instanceof Kn||(e=Qn(e)),e?(e=e.rgb(),new fr(e.r,e.g,e.b,e.opacity)):new fr}function Qi(e,r,n,a){return arguments.length===1?Ud(e):new fr(e,r,n,a==null?1:a)}function fr(e,r,n,a){this.r=+e,this.g=+r,this.b=+n,this.opacity=+a}rf(fr,Qi,qs(Kn,{brighter(e){return e=e==null?Na:Math.pow(Na,e),new fr(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?qn:Math.pow(qn,e),new fr(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new fr(an(this.r),an(this.g),an(this.b),Ia(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:vs,formatHex:vs,formatHex8:jd,formatRgb:_s,toString:_s}));function vs(){return`#${rn(this.r)}${rn(this.g)}${rn(this.b)}`}function jd(){return`#${rn(this.r)}${rn(this.g)}${rn(this.b)}${rn((isNaN(this.opacity)?1:this.opacity)*255)}`}function _s(){const e=Ia(this.opacity);return`${e===1?"rgb(":"rgba("}${an(this.r)}, ${an(this.g)}, ${an(this.b)}${e===1?")":`, ${e})`}`}function Ia(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function an(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function rn(e){return e=an(e),(e<16?"0":"")+e.toString(16)}function bs(e,r,n,a){return a<=0?e=r=n=NaN:n<=0||n>=1?e=r=NaN:r<=0&&(e=NaN),new br(e,r,n,a)}function Ys(e){if(e instanceof br)return new br(e.h,e.s,e.l,e.opacity);if(e instanceof Kn||(e=Qn(e)),!e)return new br;if(e instanceof br)return e;e=e.rgb();var r=e.r/255,n=e.g/255,a=e.b/255,d=Math.min(r,n,a),m=Math.max(r,n,a),T=NaN,y=m-d,N=(m+d)/2;return y?(r===m?T=(n-a)/y+(n<a)*6:n===m?T=(a-r)/y+2:T=(r-n)/y+4,y/=N<.5?m+d:2-m-d,T*=60):y=N>0&&N<1?0:T,new br(T,y,N,e.opacity)}function Vd(e,r,n,a){return arguments.length===1?Ys(e):new br(e,r,n,a==null?1:a)}function br(e,r,n,a){this.h=+e,this.s=+r,this.l=+n,this.opacity=+a}rf(br,Vd,qs(Kn,{brighter(e){return e=e==null?Na:Math.pow(Na,e),new br(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?qn:Math.pow(qn,e),new br(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,r=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,a=n+(n<.5?n:1-n)*r,d=2*n-a;return new fr(Vi(e>=240?e-240:e+120,d,a),Vi(e,d,a),Vi(e<120?e+240:e-120,d,a),this.opacity)},clamp(){return new br(ys(this.h),Ca(this.s),Ca(this.l),Ia(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Ia(this.opacity);return`${e===1?"hsl(":"hsla("}${ys(this.h)}, ${Ca(this.s)*100}%, ${Ca(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ys(e){return e=(e||0)%360,e<0?e+360:e}function Ca(e){return Math.max(0,Math.min(1,e||0))}function Vi(e,r,n){return(e<60?r+(n-r)*e/60:e<180?n:e<240?r+(n-r)*(240-e)/60:r)*255}const nf=e=>()=>e;function zd(e,r){return function(n){return e+n*r}}function Hd(e,r,n){return e=Math.pow(e,n),r=Math.pow(r,n)-e,n=1/n,function(a){return Math.pow(e+a*r,n)}}function Xd(e){return(e=+e)==1?Qs:function(r,n){return n-r?Hd(r,n,e):nf(isNaN(r)?n:r)}}function Qs(e,r){var n=r-e;return n?zd(e,n):nf(isNaN(e)?r:e)}const gs=function e(r){var n=Xd(r);function a(d,m){var T=n((d=Qi(d)).r,(m=Qi(m)).r),y=n(d.g,m.g),N=n(d.b,m.b),x=Qs(d.opacity,m.opacity);return function(q){return d.r=T(q),d.g=y(q),d.b=N(q),d.opacity=x(q),d+""}}return a.gamma=e,a}(1);function Wd(e,r){r||(r=[]);var n=e?Math.min(r.length,e.length):0,a=r.slice(),d;return function(m){for(d=0;d<n;++d)a[d]=e[d]*(1-m)+r[d]*m;return a}}function qd(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Yd(e,r){var n=r?r.length:0,a=e?Math.min(n,e.length):0,d=new Array(a),m=new Array(n),T;for(T=0;T<a;++T)d[T]=af(e[T],r[T]);for(;T<n;++T)m[T]=r[T];return function(y){for(T=0;T<a;++T)m[T]=d[T](y);return m}}function Qd(e,r){var n=new Date;return e=+e,r=+r,function(a){return n.setTime(e*(1-a)+r*a),n}}function Ma(e,r){return e=+e,r=+r,function(n){return e*(1-n)+r*n}}function Kd(e,r){var n={},a={},d;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(d in r)d in e?n[d]=af(e[d],r[d]):a[d]=r[d];return function(m){for(d in n)a[d]=n[d](m);return a}}var Ki=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zi=new RegExp(Ki.source,"g");function Zd(e){return function(){return e}}function Jd(e){return function(r){return e(r)+""}}function $d(e,r){var n=Ki.lastIndex=zi.lastIndex=0,a,d,m,T=-1,y=[],N=[];for(e=e+"",r=r+"";(a=Ki.exec(e))&&(d=zi.exec(r));)(m=d.index)>n&&(m=r.slice(n,m),y[T]?y[T]+=m:y[++T]=m),(a=a[0])===(d=d[0])?y[T]?y[T]+=d:y[++T]=d:(y[++T]=null,N.push({i:T,x:Ma(a,d)})),n=zi.lastIndex;return n<r.length&&(m=r.slice(n),y[T]?y[T]+=m:y[++T]=m),y.length<2?N[0]?Jd(N[0].x):Zd(r):(r=N.length,function(x){for(var q=0,ee;q<r;++q)y[(ee=N[q]).i]=ee.x(x);return y.join("")})}function af(e,r){var n=typeof r,a;return r==null||n==="boolean"?nf(r):(n==="number"?Ma:n==="string"?(a=Qn(r))?(r=a,gs):$d:r instanceof Qn?gs:r instanceof Date?Qd:qd(r)?Wd:Array.isArray(r)?Yd:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?Kd:Ma)(e,r)}function eh(e,r){return e=+e,r=+r,function(n){return Math.round(e*(1-n)+r*n)}}function th(e){return function(){return e}}function rh(e){return+e}var xs=[0,1];function En(e){return e}function Zi(e,r){return(r-=e=+e)?function(n){return(n-e)/r}:th(isNaN(r)?NaN:.5)}function nh(e,r){var n;return e>r&&(n=e,e=r,r=n),function(a){return Math.max(e,Math.min(r,a))}}function ah(e,r,n){var a=e[0],d=e[1],m=r[0],T=r[1];return d<a?(a=Zi(d,a),m=n(T,m)):(a=Zi(a,d),m=n(m,T)),function(y){return m(a(y))}}function ih(e,r,n){var a=Math.min(e.length,r.length)-1,d=new Array(a),m=new Array(a),T=-1;for(e[a]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++T<a;)d[T]=Zi(e[T],e[T+1]),m[T]=n(r[T],r[T+1]);return function(y){var N=wd(e,y,1,a)-1;return m[N](d[N](y))}}function fh(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function oh(){var e=xs,r=xs,n=af,a,d,m,T=En,y,N,x;function q(){var ve=Math.min(e.length,r.length);return T!==En&&(T=nh(e[0],e[ve-1])),y=ve>2?ih:ah,N=x=null,ee}function ee(ve){return ve==null||isNaN(ve=+ve)?m:(N||(N=y(e.map(a),r,n)))(a(T(ve)))}return ee.invert=function(ve){return T(d((x||(x=y(r,e.map(a),Ma)))(ve)))},ee.domain=function(ve){return arguments.length?(e=Array.from(ve,rh),q()):e.slice()},ee.range=function(ve){return arguments.length?(r=Array.from(ve),q()):r.slice()},ee.rangeRound=function(ve){return r=Array.from(ve),n=eh,q()},ee.clamp=function(ve){return arguments.length?(T=ve?!0:En,q()):T!==En},ee.interpolate=function(ve){return arguments.length?(n=ve,q()):n},ee.unknown=function(ve){return arguments.length?(m=ve,ee):m},function(ve,Me){return a=ve,d=Me,q()}}function sh(){return oh()(En,En)}function uh(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ba(e,r){if((n=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var n,a=e.slice(0,n);return[a.length>1?a[0]+a.slice(2):a,+e.slice(n+1)]}function Tn(e){return e=Ba(Math.abs(e)),e?e[1]:NaN}function lh(e,r){return function(n,a){for(var d=n.length,m=[],T=0,y=e[0],N=0;d>0&&y>0&&(N+y+1>a&&(y=Math.max(1,a-N)),m.push(n.substring(d-=y,d+y)),!((N+=y+1)>a));)y=e[T=(T+1)%e.length];return m.reverse().join(r)}}function ch(e){return function(r){return r.replace(/[0-9]/g,function(n){return e[+n]})}}var dh=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Pa(e){if(!(r=dh.exec(e)))throw new Error("invalid format: "+e);var r;return new ff({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}Pa.prototype=ff.prototype;function ff(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ff.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function hh(e){e:for(var r=e.length,n=1,a=-1,d;n<r;++n)switch(e[n]){case".":a=d=n;break;case"0":a===0&&(a=n),d=n;break;default:if(!+e[n])break e;a>0&&(a=0);break}return a>0?e.slice(0,a)+e.slice(d+1):e}var Ks;function mh(e,r){var n=Ba(e,r);if(!n)return e+"";var a=n[0],d=n[1],m=d-(Ks=Math.max(-8,Math.min(8,Math.floor(d/3)))*3)+1,T=a.length;return m===T?a:m>T?a+new Array(m-T+1).join("0"):m>0?a.slice(0,m)+"."+a.slice(m):"0."+new Array(1-m).join("0")+Ba(e,Math.max(0,r+m-1))[0]}function Es(e,r){var n=Ba(e,r);if(!n)return e+"";var a=n[0],d=n[1];return d<0?"0."+new Array(-d).join("0")+a:a.length>d+1?a.slice(0,d+1)+"."+a.slice(d+1):a+new Array(d-a.length+2).join("0")}const As={"%":(e,r)=>(e*100).toFixed(r),b:e=>Math.round(e).toString(2),c:e=>e+"",d:uh,e:(e,r)=>e.toExponential(r),f:(e,r)=>e.toFixed(r),g:(e,r)=>e.toPrecision(r),o:e=>Math.round(e).toString(8),p:(e,r)=>Es(e*100,r),r:Es,s:mh,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Ts(e){return e}var ws=Array.prototype.map,Ss=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function ph(e){var r=e.grouping===void 0||e.thousands===void 0?Ts:lh(ws.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",a=e.currency===void 0?"":e.currency[1]+"",d=e.decimal===void 0?".":e.decimal+"",m=e.numerals===void 0?Ts:ch(ws.call(e.numerals,String)),T=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"\u2212":e.minus+"",N=e.nan===void 0?"NaN":e.nan+"";function x(ee){ee=Pa(ee);var ve=ee.fill,Me=ee.align,ke=ee.sign,lt=ee.symbol,Ce=ee.zero,Ye=ee.width,st=ee.comma,gt=ee.precision,vt=ee.trim,Ke=ee.type;Ke==="n"?(st=!0,Ke="g"):As[Ke]||(gt===void 0&&(gt=12),vt=!0,Ke="g"),(Ce||ve==="0"&&Me==="=")&&(Ce=!0,ve="0",Me="=");var pt=lt==="$"?n:lt==="#"&&/[boxX]/.test(Ke)?"0"+Ke.toLowerCase():"",We=lt==="$"?a:/[%p]/.test(Ke)?T:"",L=As[Ke],O=/[defgprs%]/.test(Ke);gt=gt===void 0?6:/[gprs]/.test(Ke)?Math.max(1,Math.min(21,gt)):Math.max(0,Math.min(20,gt));function H(P){var fe=pt,Te=We,at,St,De;if(Ke==="c")Te=L(P)+Te,P="";else{P=+P;var Se=P<0||1/P<0;if(P=isNaN(P)?N:L(Math.abs(P),gt),vt&&(P=hh(P)),Se&&+P==0&&ke!=="+"&&(Se=!1),fe=(Se?ke==="("?ke:y:ke==="-"||ke==="("?"":ke)+fe,Te=(Ke==="s"?Ss[8+Ks/3]:"")+Te+(Se&&ke==="("?")":""),O){for(at=-1,St=P.length;++at<St;)if(De=P.charCodeAt(at),48>De||De>57){Te=(De===46?d+P.slice(at+1):P.slice(at))+Te,P=P.slice(0,at);break}}}st&&!Ce&&(P=r(P,1/0));var Ne=fe.length+P.length+Te.length,ue=Ne<Ye?new Array(Ye-Ne+1).join(ve):"";switch(st&&Ce&&(P=r(ue+P,ue.length?Ye-Te.length:1/0),ue=""),Me){case"<":P=fe+P+Te+ue;break;case"=":P=fe+ue+P+Te;break;case"^":P=ue.slice(0,Ne=ue.length>>1)+fe+P+Te+ue.slice(Ne);break;default:P=ue+fe+P+Te;break}return m(P)}return H.toString=function(){return ee+""},H}function q(ee,ve){var Me=x((ee=Pa(ee),ee.type="f",ee)),ke=Math.max(-8,Math.min(8,Math.floor(Tn(ve)/3)))*3,lt=Math.pow(10,-ke),Ce=Ss[8+ke/3];return function(Ye){return Me(lt*Ye)+Ce}}return{format:x,formatPrefix:q}}var Oa,Zs,Js;vh({thousands:",",grouping:[3],currency:["$",""]});function vh(e){return Oa=ph(e),Zs=Oa.format,Js=Oa.formatPrefix,Oa}function _h(e){return Math.max(0,-Tn(Math.abs(e)))}function bh(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Tn(r)/3)))*3-Tn(Math.abs(e)))}function yh(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,Tn(r)-Tn(e))+1}function gh(e,r,n,a){var d=Od(e,r,n),m;switch(a=Pa(a==null?",f":a),a.type){case"s":{var T=Math.max(Math.abs(e),Math.abs(r));return a.precision==null&&!isNaN(m=bh(d,T))&&(a.precision=m),Js(a,T)}case"":case"e":case"g":case"p":case"r":{a.precision==null&&!isNaN(m=yh(d,Math.max(Math.abs(e),Math.abs(r))))&&(a.precision=m-(a.type==="e"));break}case"f":case"%":{a.precision==null&&!isNaN(m=_h(d))&&(a.precision=m-(a.type==="%")*2);break}}return Zs(a)}function xh(e){var r=e.domain;return e.ticks=function(n){var a=r();return Cd(a[0],a[a.length-1],n==null?10:n)},e.tickFormat=function(n,a){var d=r();return gh(d[0],d[d.length-1],n==null?10:n,a)},e.nice=function(n){n==null&&(n=10);var a=r(),d=0,m=a.length-1,T=a[d],y=a[m],N,x,q=10;for(y<T&&(x=T,T=y,y=x,x=d,d=m,m=x);q-- >0;){if(x=Hs(T,y,n),x===N)return a[d]=T,a[m]=y,r(a);if(x>0)T=Math.floor(T/x)*x,y=Math.ceil(y/x)*x;else if(x<0)T=Math.ceil(T*x)/x,y=Math.floor(y*x)/x;else break;N=x}return e},e}function Ji(){var e=sh();return e.copy=function(){return fh(e,Ji())},Xs.apply(e,arguments),xh(e)}function Eh(e){for(var r=e.length/6|0,n=new Array(r),a=0;a<r;)n[a]="#"+e.slice(a*6,++a*6);return n}const Ah=Eh("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");function Th(e){let r;return{c(){r=nt("p"),r.textContent="Hover over a circle to see details here.",Ge(r,"class","svelte-60srhh")},m(n,a){Mt(n,r,a)},p:gr,d(n){n&&Ft(r)}}}function wh(e){let r,n=e[0].title+"",a,d,m,T=e[0][e[1]]+"",y,N,x,q=e[0].date.toISOString().split("T")[0]+"",ee,ve,Me,ke=e[0].text+"",lt;return{c(){r=nt("h1"),a=yr(n),d=Lt(),m=nt("span"),y=yr(T),N=Lt(),x=nt("h2"),ee=yr(q),ve=Lt(),Me=nt("p"),lt=yr(ke),Ge(r,"class","svelte-60srhh"),ur(m,"background",e[2](e[0][e[1]])),Ge(m,"class","svelte-60srhh"),Ge(x,"class","svelte-60srhh"),Ge(Me,"class","svelte-60srhh")},m(Ce,Ye){Mt(Ce,r,Ye),je(r,a),Mt(Ce,d,Ye),Mt(Ce,m,Ye),je(m,y),Mt(Ce,N,Ye),Mt(Ce,x,Ye),je(x,ee),Mt(Ce,ve,Ye),Mt(Ce,Me,Ye),je(Me,lt)},p(Ce,Ye){Ye&1&&n!==(n=Ce[0].title+"")&&jr(a,n),Ye&3&&T!==(T=Ce[0][Ce[1]]+"")&&jr(y,T),Ye&7&&ur(m,"background",Ce[2](Ce[0][Ce[1]])),Ye&1&&q!==(q=Ce[0].date.toISOString().split("T")[0]+"")&&jr(ee,q),Ye&1&&ke!==(ke=Ce[0].text+"")&&jr(lt,ke)},d(Ce){Ce&&Ft(r),Ce&&Ft(d),Ce&&Ft(m),Ce&&Ft(N),Ce&&Ft(x),Ce&&Ft(ve),Ce&&Ft(Me)}}}function Sh(e){let r;function n(m,T){return m[0]?wh:Th}let a=n(e),d=a(e);return{c(){r=nt("div"),d.c(),Ge(r,"class","detail-card svelte-60srhh")},m(m,T){Mt(m,r,T),d.m(r,null)},p(m,[T]){a===(a=n(m))&&d?d.p(m,T):(d.d(1),d=a(m),d&&(d.c(),d.m(r,null)))},i:gr,o:gr,d(m){m&&Ft(r),d.d()}}}function Rh(e,r,n){let{hoveredData:a}=r,{domainColumn:d}=r,{data:m}=r,{colorScale:T}=r;return ef(()=>{T.domain(m.map(y=>y[d]))}),e.$$set=y=>{"hoveredData"in y&&n(0,a=y.hoveredData),"domainColumn"in y&&n(1,d=y.domainColumn),"data"in y&&n(3,m=y.data),"colorScale"in y&&n(2,T=y.colorScale)},[a,d,T,m]}class Lh extends Ha{constructor(r){super(),za(this,r,Rh,Sh,Ua,{hoveredData:0,domainColumn:1,data:3,colorScale:2})}}var $s={exports:{}};(function(e,r){(function(n,a){e.exports=a()})(js,function(){var n=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},a=function(t,o){for(var h=Object.keys(o),D=0;D<h.length;++D)t[h[D]]=o[h[D]];return t},d=`
`;function m(t){return typeof atob<"u"?atob(t):"base64:"+t}function T(t){var o=new Error("(regl) "+t);throw console.error(o),o}function y(t,o){t||T(o)}function N(t){return t?": "+t:""}function x(t,o,h){t in o||T("unknown parameter ("+t+")"+N(h)+". possible values: "+Object.keys(o).join())}function q(t,o){n(t)||T("invalid parameter type"+N(o)+". must be a typed array")}function ee(t,o){switch(o){case"number":return typeof t=="number";case"object":return typeof t=="object";case"string":return typeof t=="string";case"boolean":return typeof t=="boolean";case"function":return typeof t=="function";case"undefined":return typeof t>"u";case"symbol":return typeof t=="symbol"}}function ve(t,o,h){ee(t,o)||T("invalid parameter type"+N(h)+". expected "+o+", got "+typeof t)}function Me(t,o){t>=0&&(t|0)===t||T("invalid parameter type, ("+t+")"+N(o)+". must be a nonnegative integer")}function ke(t,o,h){o.indexOf(t)<0&&T("invalid value"+N(h)+". must be one of: "+o)}var lt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ce(t){Object.keys(t).forEach(function(o){lt.indexOf(o)<0&&T('invalid regl constructor argument "'+o+'". must be one of '+lt)})}function Ye(t,o){for(t=t+"";t.length<o;)t=" "+t;return t}function st(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function gt(t,o){this.number=t,this.line=o,this.errors=[]}function vt(t,o,h){this.file=t,this.line=o,this.message=h}function Ke(){var t=new Error,o=(t.stack||t).toString(),h=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(o);if(h)return h[1];var D=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(o);return D?D[1]:"unknown"}function pt(){var t=new Error,o=(t.stack||t).toString(),h=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(o);if(h)return h[1];var D=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(o);return D?D[1]:"unknown"}function We(t,o){var h=t.split(`
`),D=1,B=0,k={unknown:new st,0:new st};k.unknown.name=k[0].name=o||Ke(),k.unknown.lines.push(new gt(0,""));for(var I=0;I<h.length;++I){var X=h[I],z=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(X);if(z)switch(z[1]){case"line":var Z=/(\d+)(\s+\d+)?/.exec(z[2]);Z&&(D=Z[1]|0,Z[2]&&(B=Z[2]|0,B in k||(k[B]=new st)));break;case"define":var $=/SHADER_NAME(_B64)?\s+(.*)$/.exec(z[2]);$&&(k[B].name=$[1]?m($[2]):$[2]);break}k[B].lines.push(new gt(D++,X))}return Object.keys(k).forEach(function(J){var ae=k[J];ae.lines.forEach(function(W){ae.index[W.number]=W})}),k}function L(t){var o=[];return t.split(`
`).forEach(function(h){if(!(h.length<5)){var D=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(h);D?o.push(new vt(D[1]|0,D[2]|0,D[3].trim())):h.length>0&&o.push(new vt("unknown",0,h))}}),o}function O(t,o){o.forEach(function(h){var D=t[h.file];if(D){var B=D.index[h.line];if(B){B.errors.push(h),D.hasErrors=!0;return}}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(h)})}function H(t,o,h,D,B){if(!t.getShaderParameter(o,t.COMPILE_STATUS)){var k=t.getShaderInfoLog(o),I=D===t.FRAGMENT_SHADER?"fragment":"vertex";Se(h,"string",I+" shader source must be a string",B);var X=We(h,B),z=L(k);O(X,z),Object.keys(X).forEach(function(Z){var $=X[Z];if(!$.hasErrors)return;var J=[""],ae=[""];function W(K,A){J.push(K),ae.push(A||"")}W("file number "+Z+": "+$.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),$.lines.forEach(function(K){if(K.errors.length>0){W(Ye(K.number,4)+"|  ","background-color:yellow; font-weight:bold"),W(K.line+d,"color:red; background-color:yellow; font-weight:bold");var A=0;K.errors.forEach(function(G){var Q=G.message,pe=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Q);if(pe){var V=pe[1];switch(Q=pe[2],V){case"assign":V="=";break}A=Math.max(K.line.indexOf(V,A),0)}else A=0;W(Ye("| ",6)),W(Ye("^^^",A+3)+d,"font-weight:bold"),W(Ye("| ",6)),W(Q+d,"font-weight:bold")}),W(Ye("| ",6)+d)}else W(Ye(K.number,4)+"|  "),W(K.line+d,"color:red")}),typeof document<"u"&&!window.chrome?(ae[0]=J.join("%c"),console.log.apply(console,ae)):console.log(J.join(""))}),y.raise("Error compiling "+I+" shader, "+X[0].name)}}function P(t,o,h,D,B){if(!t.getProgramParameter(o,t.LINK_STATUS)){var k=t.getProgramInfoLog(o),I=We(h,B),X=We(D,B),z='Error linking program with vertex shader, "'+X[0].name+'", and fragment shader "'+I[0].name+'"';typeof document<"u"?console.log("%c"+z+d+"%c"+k,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(z+d+k),y.raise(z)}}function fe(t){t._commandRef=Ke()}function Te(t,o,h,D){fe(t);function B(z){return z?D.id(z):0}t._fragId=B(t.static.frag),t._vertId=B(t.static.vert);function k(z,Z){Object.keys(Z).forEach(function($){z[D.id($)]=!0})}var I=t._uniformSet={};k(I,o.static),k(I,o.dynamic);var X=t._attributeSet={};k(X,h.static),k(X,h.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function at(t,o){var h=pt();T(t+" in command "+(o||Ke())+(h==="unknown"?"":" called from "+h))}function St(t,o,h){t||at(o,h||Ke())}function De(t,o,h,D){t in o||at("unknown parameter ("+t+")"+N(h)+". possible values: "+Object.keys(o).join(),D||Ke())}function Se(t,o,h,D){ee(t,o)||at("invalid parameter type"+N(h)+". expected "+o+", got "+typeof t,D||Ke())}function Ne(t){t()}function ue(t,o,h){t.texture?ke(t.texture._texture.internalformat,o,"unsupported texture format for attachment"):ke(t.renderbuffer._renderbuffer.format,h,"unsupported renderbuffer format for attachment")}var Je=33071,Be=9728,Qe=9984,Oe=9985,xt=9986,_t=9987,ut=5120,Re=5121,Le=5122,we=5123,$e=5124,et=5125,Et=5126,Ct=32819,At=32820,ht=33635,ft=34042,Dt=36193,ze={};ze[ut]=ze[Re]=1,ze[Le]=ze[we]=ze[Dt]=ze[ht]=ze[Ct]=ze[At]=2,ze[$e]=ze[et]=ze[Et]=ze[ft]=4;function dt(t,o){return t===At||t===Ct||t===ht?2:t===ft?4:ze[t]*o}function bt(t){return!(t&t-1)&&!!t}function lr(t,o,h){var D,B=o.width,k=o.height,I=o.channels;y(B>0&&B<=h.maxTextureSize&&k>0&&k<=h.maxTextureSize,"invalid texture shape"),(t.wrapS!==Je||t.wrapT!==Je)&&y(bt(B)&&bt(k),"incompatible wrap mode for texture, both width and height must be power of 2"),o.mipmask===1?B!==1&&k!==1&&y(t.minFilter!==Qe&&t.minFilter!==xt&&t.minFilter!==Oe&&t.minFilter!==_t,"min filter requires mipmap"):(y(bt(B)&&bt(k),"texture must be a square power of 2 to support mipmapping"),y(o.mipmask===(B<<1)-1,"missing or incomplete mipmap data")),o.type===Et&&(h.extensions.indexOf("oes_texture_float_linear")<0&&y(t.minFilter===Be&&t.magFilter===Be,"filter not supported, must enable oes_texture_float_linear"),y(!t.genMipmaps,"mipmap generation not supported with float textures"));var X=o.images;for(D=0;D<16;++D)if(X[D]){var z=B>>D,Z=k>>D;y(o.mipmask&1<<D,"missing mipmap data");var $=X[D];if(y($.width===z&&$.height===Z,"invalid shape for mip images"),y($.format===o.format&&$.internalformat===o.internalformat&&$.type===o.type,"incompatible type for mip image"),!$.compressed)if($.data){var J=Math.ceil(dt($.type,I)*z/$.unpackAlignment)*$.unpackAlignment;y($.data.byteLength===J*Z,"invalid data for image, buffer size is inconsistent with image format")}else $.element||$.copy}else t.genMipmaps||y((o.mipmask&1<<D)===0,"extra mipmap data");o.compressed&&y(!t.genMipmaps,"mipmap generation for compressed images not supported")}function nr(t,o,h,D){var B=t.width,k=t.height,I=t.channels;y(B>0&&B<=D.maxTextureSize&&k>0&&k<=D.maxTextureSize,"invalid texture shape"),y(B===k,"cube map must be square"),y(o.wrapS===Je&&o.wrapT===Je,"wrap mode not supported by cube map");for(var X=0;X<h.length;++X){var z=h[X];y(z.width===B&&z.height===k,"inconsistent cube map face shape"),o.genMipmaps&&(y(!z.compressed,"can not generate mipmap for compressed textures"),y(z.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Z=z.images,$=0;$<16;++$){var J=Z[$];if(J){var ae=B>>$,W=k>>$;y(z.mipmask&1<<$,"missing mipmap data"),y(J.width===ae&&J.height===W,"invalid shape for mip images"),y(J.format===t.format&&J.internalformat===t.internalformat&&J.type===t.type,"incompatible type for mip image"),J.compressed||(J.data?y(J.data.byteLength===ae*W*Math.max(dt(J.type,I),J.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):J.element||J.copy)}}}}var f=a(y,{optional:Ne,raise:T,commandRaise:at,command:St,parameter:x,commandParameter:De,constructor:Ce,type:ve,commandType:Se,isTypedArray:q,nni:Me,oneOf:ke,shaderError:H,linkError:P,callSite:pt,saveCommandRef:fe,saveDrawInfo:Te,framebufferFormat:ue,guessCommand:Ke,texture2D:lr,textureCube:nr}),yt=0,ar=0,Bt=5,qt=6;function Yt(t,o){this.id=yt++,this.type=t,this.data=o}function mr(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function tr(t){if(t.length===0)return[];var o=t.charAt(0),h=t.charAt(t.length-1);if(t.length>1&&o===h&&(o==='"'||o==="'"))return['"'+mr(t.substr(1,t.length-2))+'"'];var D=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(D)return tr(t.substr(0,D.index)).concat(tr(D[1])).concat(tr(t.substr(D.index+D[0].length)));var B=t.split(".");if(B.length===1)return['"'+mr(t)+'"'];for(var k=[],I=0;I<B.length;++I)k=k.concat(tr(B[I]));return k}function cr(t){return"["+tr(t).join("][")+"]"}function zt(t,o){return new Yt(t,cr(o+""))}function xr(t){return typeof t=="function"&&!t._reglType||t instanceof Yt}function ot(t,o){if(typeof t=="function")return new Yt(ar,t);if(typeof t=="number"||typeof t=="boolean")return new Yt(Bt,t);if(Array.isArray(t))return new Yt(qt,t.map(function(h,D){return ot(h,o+"["+D+"]")}));if(t instanceof Yt)return t;f(!1,"invalid option type in uniform "+o)}var Tt={DynamicVariable:Yt,define:zt,isDynamic:xr,unbox:ot,accessor:cr},Fr={next:typeof requestAnimationFrame=="function"?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:typeof cancelAnimationFrame=="function"?function(t){return cancelAnimationFrame(t)}:clearTimeout},fn=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function eu(){var t={"":0},o=[""];return{id:function(h){var D=t[h];return D||(D=t[h]=o.length,o.push(h),D)},str:function(h){return o[h]}}}function tu(t,o,h){var D=document.createElement("canvas");a(D.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(D),t===document.body&&(D.style.position="absolute",a(t.style,{margin:0,padding:0}));function B(){var X=window.innerWidth,z=window.innerHeight;if(t!==document.body){var Z=D.getBoundingClientRect();X=Z.right-Z.left,z=Z.bottom-Z.top}D.width=h*X,D.height=h*z}var k;t!==document.body&&typeof ResizeObserver=="function"?(k=new ResizeObserver(function(){setTimeout(B)}),k.observe(t)):window.addEventListener("resize",B,!1);function I(){k?k.disconnect():window.removeEventListener("resize",B),t.removeChild(D)}return B(),{canvas:D,onDestroy:I}}function ru(t,o){function h(D){try{return t.getContext(D,o)}catch{return null}}return h("webgl")||h("experimental-webgl")||h("webgl-experimental")}function nu(t){return typeof t.nodeName=="string"&&typeof t.appendChild=="function"&&typeof t.getBoundingClientRect=="function"}function au(t){return typeof t.drawArrays=="function"||typeof t.drawElements=="function"}function of(t){return typeof t=="string"?t.split():(f(Array.isArray(t),"invalid extension array"),t)}function sf(t){return typeof t=="string"?(f(typeof document<"u","not supported outside of DOM"),document.querySelector(t)):t}function iu(t){var o=t||{},h,D,B,k,I={},X=[],z=[],Z=typeof window>"u"?1:window.devicePixelRatio,$=!1,J=function(K){K&&f.raise(K)},ae=function(){};if(typeof o=="string"?(f(typeof document<"u","selector queries only supported in DOM environments"),h=document.querySelector(o),f(h,"invalid query string for element")):typeof o=="object"?nu(o)?h=o:au(o)?(k=o,B=k.canvas):(f.constructor(o),"gl"in o?k=o.gl:"canvas"in o?B=sf(o.canvas):"container"in o&&(D=sf(o.container)),"attributes"in o&&(I=o.attributes,f.type(I,"object","invalid context attributes")),"extensions"in o&&(X=of(o.extensions)),"optionalExtensions"in o&&(z=of(o.optionalExtensions)),"onDone"in o&&(f.type(o.onDone,"function","invalid or missing onDone callback"),J=o.onDone),"profile"in o&&($=!!o.profile),"pixelRatio"in o&&(Z=+o.pixelRatio,f(Z>0,"invalid pixel ratio"))):f.raise("invalid arguments to regl"),h&&(h.nodeName.toLowerCase()==="canvas"?B=h:D=h),!k){if(!B){f(typeof document<"u","must manually specify webgl context outside of DOM environments");var W=tu(D||document.body,J,Z);if(!W)return null;B=W.canvas,ae=W.onDestroy}I.premultipliedAlpha===void 0&&(I.premultipliedAlpha=!0),k=ru(B,I)}return k?{gl:k,canvas:B,container:D,extensions:X,optionalExtensions:z,pixelRatio:Z,profile:$,onDone:J,onDestroy:ae}:(ae(),J("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function fu(t,o){var h={};function D(I){f.type(I,"string","extension name must be string");var X=I.toLowerCase(),z;try{z=h[X]=t.getExtension(X)}catch{}return!!z}for(var B=0;B<o.extensions.length;++B){var k=o.extensions[B];if(!D(k))return o.onDestroy(),o.onDone('"'+k+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return o.optionalExtensions.forEach(D),{extensions:h,restore:function(){Object.keys(h).forEach(function(I){if(h[I]&&!D(I))throw new Error("(regl): error restoring extension "+I)})}}}function or(t,o){for(var h=Array(t),D=0;D<t;++D)h[D]=o(D);return h}var ou=5120,su=5121,uu=5122,lu=5123,cu=5124,du=5125,hu=5126;function mu(t){for(var o=16;o<=1<<28;o*=16)if(t<=o)return o;return 0}function uf(t){var o,h;return o=(t>65535)<<4,t>>>=o,h=(t>255)<<3,t>>>=h,o|=h,h=(t>15)<<2,t>>>=h,o|=h,h=(t>3)<<1,t>>>=h,o|=h,o|t>>1}function lf(){var t=or(8,function(){return[]});function o(k){var I=mu(k),X=t[uf(I)>>2];return X.length>0?X.pop():new ArrayBuffer(I)}function h(k){t[uf(k.byteLength)>>2].push(k)}function D(k,I){var X=null;switch(k){case ou:X=new Int8Array(o(I),0,I);break;case su:X=new Uint8Array(o(I),0,I);break;case uu:X=new Int16Array(o(2*I),0,I);break;case lu:X=new Uint16Array(o(2*I),0,I);break;case cu:X=new Int32Array(o(4*I),0,I);break;case du:X=new Uint32Array(o(4*I),0,I);break;case hu:X=new Float32Array(o(4*I),0,I);break;default:return null}return X.length!==I?X.subarray(0,I):X}function B(k){h(k.buffer)}return{alloc:o,free:h,allocType:D,freeType:B}}var Pt=lf();Pt.zero=lf();var pu=3408,vu=3410,_u=3411,bu=3412,yu=3413,gu=3414,xu=3415,Eu=33901,Au=33902,Tu=3379,wu=3386,Su=34921,Ru=36347,Lu=36348,Cu=35661,Ou=35660,ku=34930,Du=36349,Fu=34076,Gu=34024,Nu=7936,Iu=7937,Mu=7938,Bu=35724,Pu=34047,Uu=36063,ju=34852,Zn=3553,cf=34067,Vu=34069,zu=33984,wn=6408,Xa=5126,df=5121,Wa=36160,Hu=36053,Xu=36064,Wu=16384,qu=function(t,o){var h=1;o.ext_texture_filter_anisotropic&&(h=t.getParameter(Pu));var D=1,B=1;o.webgl_draw_buffers&&(D=t.getParameter(ju),B=t.getParameter(Uu));var k=!!o.oes_texture_float;if(k){var I=t.createTexture();t.bindTexture(Zn,I),t.texImage2D(Zn,0,wn,1,1,0,wn,Xa,null);var X=t.createFramebuffer();if(t.bindFramebuffer(Wa,X),t.framebufferTexture2D(Wa,Xu,Zn,I,0),t.bindTexture(Zn,null),t.checkFramebufferStatus(Wa)!==Hu)k=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(Wu);var z=Pt.allocType(Xa,4);t.readPixels(0,0,1,1,wn,Xa,z),t.getError()?k=!1:(t.deleteFramebuffer(X),t.deleteTexture(I),k=z[0]===1),Pt.freeType(z)}}var Z=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),$=!0;if(!Z){var J=t.createTexture(),ae=Pt.allocType(df,36);t.activeTexture(zu),t.bindTexture(cf,J),t.texImage2D(Vu,0,wn,3,3,0,wn,df,ae),Pt.freeType(ae),t.bindTexture(cf,null),t.deleteTexture(J),$=!t.getError()}return{colorBits:[t.getParameter(vu),t.getParameter(_u),t.getParameter(bu),t.getParameter(yu)],depthBits:t.getParameter(gu),stencilBits:t.getParameter(xu),subpixelBits:t.getParameter(pu),extensions:Object.keys(o).filter(function(W){return!!o[W]}),maxAnisotropic:h,maxDrawbuffers:D,maxColorAttachments:B,pointSizeDims:t.getParameter(Eu),lineWidthDims:t.getParameter(Au),maxViewportDims:t.getParameter(wu),maxCombinedTextureUnits:t.getParameter(Cu),maxCubeMapSize:t.getParameter(Fu),maxRenderbufferSize:t.getParameter(Gu),maxTextureUnits:t.getParameter(ku),maxTextureSize:t.getParameter(Tu),maxAttributes:t.getParameter(Su),maxVertexUniforms:t.getParameter(Ru),maxVertexTextureUnits:t.getParameter(Ou),maxVaryingVectors:t.getParameter(Lu),maxFragmentUniforms:t.getParameter(Du),glsl:t.getParameter(Bu),renderer:t.getParameter(Iu),vendor:t.getParameter(Nu),version:t.getParameter(Mu),readFloat:k,npotTextureCube:$}};function pr(t){return!!t&&typeof t=="object"&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&typeof t.offset=="number"&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||n(t.data))}var sr=function(t){return Object.keys(t).map(function(o){return t[o]})},Jn={shape:Zu,flatten:Ku};function Yu(t,o,h){for(var D=0;D<o;++D)h[D]=t[D]}function Qu(t,o,h,D){for(var B=0,k=0;k<o;++k)for(var I=t[k],X=0;X<h;++X)D[B++]=I[X]}function hf(t,o,h,D,B,k){for(var I=k,X=0;X<o;++X)for(var z=t[X],Z=0;Z<h;++Z)for(var $=z[Z],J=0;J<D;++J)B[I++]=$[J]}function mf(t,o,h,D,B){for(var k=1,I=h+1;I<o.length;++I)k*=o[I];var X=o[h];if(o.length-h===4){var z=o[h+1],Z=o[h+2],$=o[h+3];for(I=0;I<X;++I)hf(t[I],z,Z,$,D,B),B+=k}else for(I=0;I<X;++I)mf(t[I],o,h+1,D,B),B+=k}function Ku(t,o,h,D){var B=1;if(o.length)for(var k=0;k<o.length;++k)B*=o[k];else B=0;var I=D||Pt.allocType(h,B);switch(o.length){case 0:break;case 1:Yu(t,o[0],I);break;case 2:Qu(t,o[0],o[1],I);break;case 3:hf(t,o[0],o[1],o[2],I,0);break;default:mf(t,o,0,I,0)}return I}function Zu(t){for(var o=[],h=t;h.length;h=h[0])o.push(h.length);return o}var qa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ju=5120,$u=5122,el=5124,tl=5121,rl=5123,nl=5125,al=5126,il=5126,Hr={int8:Ju,int16:$u,int32:el,uint8:tl,uint16:rl,uint32:nl,float:al,float32:il},fl=35048,ol=35040,$n={dynamic:fl,stream:ol,static:35044},Ya=Jn.flatten,pf=Jn.shape,vf=35044,sl=35040,Qa=5121,Ka=5126,Gr=[];Gr[5120]=1,Gr[5122]=2,Gr[5124]=4,Gr[5121]=1,Gr[5123]=2,Gr[5125]=4,Gr[5126]=4;function ea(t){return qa[Object.prototype.toString.call(t)]|0}function _f(t,o){for(var h=0;h<o.length;++h)t[h]=o[h]}function bf(t,o,h,D,B,k,I){for(var X=0,z=0;z<h;++z)for(var Z=0;Z<D;++Z)t[X++]=o[B*z+k*Z+I]}function ul(t,o,h,D){var B=0,k={};function I(A){this.id=B++,this.buffer=t.createBuffer(),this.type=A,this.usage=vf,this.byteLength=0,this.dimension=1,this.dtype=Qa,this.persistentData=null,h.profile&&(this.stats={size:0})}I.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},I.prototype.destroy=function(){ae(this)};var X=[];function z(A,G){var Q=X.pop();return Q||(Q=new I(A)),Q.bind(),J(Q,G,sl,0,1,!1),Q}function Z(A){X.push(A)}function $(A,G,Q){A.byteLength=G.byteLength,t.bufferData(A.type,G,Q)}function J(A,G,Q,pe,V,he){var le;if(A.usage=Q,Array.isArray(G)){if(A.dtype=pe||Ka,G.length>0){var Fe;if(Array.isArray(G[0])){le=pf(G);for(var U=1,M=1;M<le.length;++M)U*=le[M];A.dimension=U,Fe=Ya(G,le,A.dtype),$(A,Fe,Q),he?A.persistentData=Fe:Pt.freeType(Fe)}else if(typeof G[0]=="number"){A.dimension=V;var ye=Pt.allocType(A.dtype,G.length);_f(ye,G),$(A,ye,Q),he?A.persistentData=ye:Pt.freeType(ye)}else n(G[0])?(A.dimension=G[0].length,A.dtype=pe||ea(G[0])||Ka,Fe=Ya(G,[G.length,G[0].length],A.dtype),$(A,Fe,Q),he?A.persistentData=Fe:Pt.freeType(Fe)):f.raise("invalid buffer data")}}else if(n(G))A.dtype=pe||ea(G),A.dimension=V,$(A,G,Q),he&&(A.persistentData=new Uint8Array(new Uint8Array(G.buffer)));else if(pr(G)){le=G.shape;var ie=G.stride,Y=G.offset,oe=0,se=0,Xe=0,Ve=0;le.length===1?(oe=le[0],se=1,Xe=ie[0],Ve=0):le.length===2?(oe=le[0],se=le[1],Xe=ie[0],Ve=ie[1]):f.raise("invalid shape"),A.dtype=pe||ea(G.data)||Ka,A.dimension=se;var ce=Pt.allocType(A.dtype,oe*se);bf(ce,G.data,oe,se,Xe,Ve,Y),$(A,ce,Q),he?A.persistentData=ce:Pt.freeType(ce)}else G instanceof ArrayBuffer?(A.dtype=Qa,A.dimension=V,$(A,G,Q),he&&(A.persistentData=new Uint8Array(new Uint8Array(G)))):f.raise("invalid buffer data")}function ae(A){o.bufferCount--,D(A);var G=A.buffer;f(G,"buffer must not be deleted already"),t.deleteBuffer(G),A.buffer=null,delete k[A.id]}function W(A,G,Q,pe){o.bufferCount++;var V=new I(G);k[V.id]=V;function he(U){var M=vf,ye=null,ie=0,Y=0,oe=1;return Array.isArray(U)||n(U)||pr(U)||U instanceof ArrayBuffer?ye=U:typeof U=="number"?ie=U|0:U&&(f.type(U,"object","buffer arguments must be an object, a number or an array"),"data"in U&&(f(ye===null||Array.isArray(ye)||n(ye)||pr(ye),"invalid data for buffer"),ye=U.data),"usage"in U&&(f.parameter(U.usage,$n,"invalid buffer usage"),M=$n[U.usage]),"type"in U&&(f.parameter(U.type,Hr,"invalid buffer type"),Y=Hr[U.type]),"dimension"in U&&(f.type(U.dimension,"number","invalid dimension"),oe=U.dimension|0),"length"in U&&(f.nni(ie,"buffer length must be a nonnegative integer"),ie=U.length|0)),V.bind(),ye?J(V,ye,M,Y,oe,pe):(ie&&t.bufferData(V.type,ie,M),V.dtype=Y||Qa,V.usage=M,V.dimension=oe,V.byteLength=ie),h.profile&&(V.stats.size=V.byteLength*Gr[V.dtype]),he}function le(U,M){f(M+U.byteLength<=V.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+U.byteLength+" starting from offset "+M+" to a buffer of size "+V.byteLength),t.bufferSubData(V.type,M,U)}function Fe(U,M){var ye=(M||0)|0,ie;if(V.bind(),n(U)||U instanceof ArrayBuffer)le(U,ye);else if(Array.isArray(U)){if(U.length>0)if(typeof U[0]=="number"){var Y=Pt.allocType(V.dtype,U.length);_f(Y,U),le(Y,ye),Pt.freeType(Y)}else if(Array.isArray(U[0])||n(U[0])){ie=pf(U);var oe=Ya(U,ie,V.dtype);le(oe,ye),Pt.freeType(oe)}else f.raise("invalid buffer data")}else if(pr(U)){ie=U.shape;var se=U.stride,Xe=0,Ve=0,ce=0,me=0;ie.length===1?(Xe=ie[0],Ve=1,ce=se[0],me=0):ie.length===2?(Xe=ie[0],Ve=ie[1],ce=se[0],me=se[1]):f.raise("invalid shape");var Pe=Array.isArray(U.data)?V.dtype:ea(U.data),He=Pt.allocType(Pe,Xe*Ve);bf(He,U.data,Xe,Ve,ce,me,U.offset),le(He,ye),Pt.freeType(He)}else f.raise("invalid data for buffer subdata");return he}return Q||he(A),he._reglType="buffer",he._buffer=V,he.subdata=Fe,h.profile&&(he.stats=V.stats),he.destroy=function(){ae(V)},he}function K(){sr(k).forEach(function(A){A.buffer=t.createBuffer(),t.bindBuffer(A.type,A.buffer),t.bufferData(A.type,A.persistentData||A.byteLength,A.usage)})}return h.profile&&(o.getTotalBufferSize=function(){var A=0;return Object.keys(k).forEach(function(G){A+=k[G].stats.size}),A}),{create:W,createStream:z,destroyStream:Z,clear:function(){sr(k).forEach(ae),X.forEach(ae)},getBuffer:function(A){return A&&A._buffer instanceof I?A._buffer:null},restore:K,_initBuffer:J}}var ll=0,cl=0,dl=1,hl=1,ml=4,pl=4,Nr={points:ll,point:cl,lines:dl,line:hl,triangles:ml,triangle:pl,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},vl=0,_l=1,Sn=4,bl=5120,on=5121,yf=5122,sn=5123,gf=5124,Xr=5125,Za=34963,yl=35040,gl=35044;function xl(t,o,h,D){var B={},k=0,I={uint8:on,uint16:sn};o.oes_element_index_uint&&(I.uint32=Xr);function X(K){this.id=k++,B[this.id]=this,this.buffer=K,this.primType=Sn,this.vertCount=0,this.type=0}X.prototype.bind=function(){this.buffer.bind()};var z=[];function Z(K){var A=z.pop();return A||(A=new X(h.create(null,Za,!0,!1)._buffer)),J(A,K,yl,-1,-1,0,0),A}function $(K){z.push(K)}function J(K,A,G,Q,pe,V,he){K.buffer.bind();var le;if(A){var Fe=he;!he&&(!n(A)||pr(A)&&!n(A.data))&&(Fe=o.oes_element_index_uint?Xr:sn),h._initBuffer(K.buffer,A,G,Fe,3)}else t.bufferData(Za,V,G),K.buffer.dtype=le||on,K.buffer.usage=G,K.buffer.dimension=3,K.buffer.byteLength=V;if(le=he,!he){switch(K.buffer.dtype){case on:case bl:le=on;break;case sn:case yf:le=sn;break;case Xr:case gf:le=Xr;break;default:f.raise("unsupported type for element array")}K.buffer.dtype=le}K.type=le,f(le!==Xr||!!o.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var U=pe;U<0&&(U=K.buffer.byteLength,le===sn?U>>=1:le===Xr&&(U>>=2)),K.vertCount=U;var M=Q;if(Q<0){M=Sn;var ye=K.buffer.dimension;ye===1&&(M=vl),ye===2&&(M=_l),ye===3&&(M=Sn)}K.primType=M}function ae(K){D.elementsCount--,f(K.buffer!==null,"must not double destroy elements"),delete B[K.id],K.buffer.destroy(),K.buffer=null}function W(K,A){var G=h.create(null,Za,!0),Q=new X(G._buffer);D.elementsCount++;function pe(V){if(!V)G(),Q.primType=Sn,Q.vertCount=0,Q.type=on;else if(typeof V=="number")G(V),Q.primType=Sn,Q.vertCount=V|0,Q.type=on;else{var he=null,le=gl,Fe=-1,U=-1,M=0,ye=0;Array.isArray(V)||n(V)||pr(V)?he=V:(f.type(V,"object","invalid arguments for elements"),"data"in V&&(he=V.data,f(Array.isArray(he)||n(he)||pr(he),"invalid data for element buffer")),"usage"in V&&(f.parameter(V.usage,$n,"invalid element buffer usage"),le=$n[V.usage]),"primitive"in V&&(f.parameter(V.primitive,Nr,"invalid element buffer primitive"),Fe=Nr[V.primitive]),"count"in V&&(f(typeof V.count=="number"&&V.count>=0,"invalid vertex count for elements"),U=V.count|0),"type"in V&&(f.parameter(V.type,I,"invalid buffer type"),ye=I[V.type]),"length"in V?M=V.length|0:(M=U,ye===sn||ye===yf?M*=2:(ye===Xr||ye===gf)&&(M*=4))),J(Q,he,le,Fe,U,M,ye)}return pe}return pe(K),pe._reglType="elements",pe._elements=Q,pe.subdata=function(V,he){return G.subdata(V,he),pe},pe.destroy=function(){ae(Q)},pe}return{create:W,createStream:Z,destroyStream:$,getElements:function(K){return typeof K=="function"&&K._elements instanceof X?K._elements:null},clear:function(){sr(B).forEach(ae)}}}var xf=new Float32Array(1),El=new Uint32Array(xf.buffer),Al=5123;function Ef(t){for(var o=Pt.allocType(Al,t.length),h=0;h<t.length;++h)if(isNaN(t[h]))o[h]=65535;else if(t[h]===1/0)o[h]=31744;else if(t[h]===-1/0)o[h]=64512;else{xf[0]=t[h];var D=El[0],B=D>>>31<<15,k=(D<<1>>>24)-127,I=D>>13&(1<<10)-1;if(k<-24)o[h]=B;else if(k<-14){var X=-14-k;o[h]=B+(I+(1<<10)>>X)}else k>15?o[h]=B+31744:o[h]=B+(k+15<<10)+I}return o}function Gt(t){return Array.isArray(t)||n(t)}var Af=function(t){return!(t&t-1)&&!!t},Tl=34467,Er=3553,Ja=34067,ta=34069,Wr=6408,$a=6406,ra=6407,Rn=6409,na=6410,Tf=32854,ei=32855,wf=36194,wl=32819,Sl=32820,Rl=33635,Ll=34042,ti=6402,aa=34041,ri=35904,ni=35906,un=36193,ai=33776,ii=33777,fi=33778,oi=33779,Sf=35986,Rf=35987,Lf=34798,Cf=35840,Of=35841,kf=35842,Df=35843,Ff=36196,ln=5121,si=5123,ui=5125,Ln=5126,Cl=10242,Ol=10243,kl=10497,li=33071,Dl=33648,Fl=10240,Gl=10241,ci=9728,Nl=9729,di=9984,Gf=9985,Nf=9986,hi=9987,Il=33170,ia=4352,Ml=4353,Bl=4354,Pl=34046,Ul=3317,jl=37440,Vl=37441,zl=37443,If=37444,Cn=33984,Hl=[di,Nf,Gf,hi],fa=[0,Rn,na,ra,Wr],dr={};dr[Rn]=dr[$a]=dr[ti]=1,dr[aa]=dr[na]=2,dr[ra]=dr[ri]=3,dr[Wr]=dr[ni]=4;function cn(t){return"[object "+t+"]"}var Mf=cn("HTMLCanvasElement"),Bf=cn("OffscreenCanvas"),Pf=cn("CanvasRenderingContext2D"),Uf=cn("ImageBitmap"),jf=cn("HTMLImageElement"),Vf=cn("HTMLVideoElement"),Xl=Object.keys(qa).concat([Mf,Bf,Pf,Uf,jf,Vf]),dn=[];dn[ln]=1,dn[Ln]=4,dn[un]=2,dn[si]=2,dn[ui]=4;var Jt=[];Jt[Tf]=2,Jt[ei]=2,Jt[wf]=2,Jt[aa]=4,Jt[ai]=.5,Jt[ii]=.5,Jt[fi]=1,Jt[oi]=1,Jt[Sf]=.5,Jt[Rf]=1,Jt[Lf]=1,Jt[Cf]=.5,Jt[Of]=.25,Jt[kf]=.5,Jt[Df]=.25,Jt[Ff]=.5;function zf(t){return Array.isArray(t)&&(t.length===0||typeof t[0]=="number")}function Hf(t){if(!Array.isArray(t))return!1;var o=t.length;return!(o===0||!Gt(t[0]))}function qr(t){return Object.prototype.toString.call(t)}function Xf(t){return qr(t)===Mf}function Wf(t){return qr(t)===Bf}function Wl(t){return qr(t)===Pf}function ql(t){return qr(t)===Uf}function Yl(t){return qr(t)===jf}function Ql(t){return qr(t)===Vf}function mi(t){if(!t)return!1;var o=qr(t);return Xl.indexOf(o)>=0?!0:zf(t)||Hf(t)||pr(t)}function qf(t){return qa[Object.prototype.toString.call(t)]|0}function Kl(t,o){var h=o.length;switch(t.type){case ln:case si:case ui:case Ln:var D=Pt.allocType(t.type,h);D.set(o),t.data=D;break;case un:t.data=Ef(o);break;default:f.raise("unsupported texture type, must specify a typed array")}}function Yf(t,o){return Pt.allocType(t.type===un?Ln:t.type,o)}function Qf(t,o){t.type===un?(t.data=Ef(o),Pt.freeType(o)):t.data=o}function Zl(t,o,h,D,B,k){for(var I=t.width,X=t.height,z=t.channels,Z=I*X*z,$=Yf(t,Z),J=0,ae=0;ae<X;++ae)for(var W=0;W<I;++W)for(var K=0;K<z;++K)$[J++]=o[h*W+D*ae+B*K+k];Qf(t,$)}function oa(t,o,h,D,B,k){var I;if(typeof Jt[t]<"u"?I=Jt[t]:I=dr[t]*dn[o],k&&(I*=6),B){for(var X=0,z=h;z>=1;)X+=I*z*z,z/=2;return X}else return I*h*D}function Jl(t,o,h,D,B,k,I){var X={"don't care":ia,"dont care":ia,nice:Bl,fast:Ml},z={repeat:kl,clamp:li,mirror:Dl},Z={nearest:ci,linear:Nl},$=a({mipmap:hi,"nearest mipmap nearest":di,"linear mipmap nearest":Gf,"nearest mipmap linear":Nf,"linear mipmap linear":hi},Z),J={none:0,browser:If},ae={uint8:ln,rgba4:wl,rgb565:Rl,"rgb5 a1":Sl},W={alpha:$a,luminance:Rn,"luminance alpha":na,rgb:ra,rgba:Wr,rgba4:Tf,"rgb5 a1":ei,rgb565:wf},K={};o.ext_srgb&&(W.srgb=ri,W.srgba=ni),o.oes_texture_float&&(ae.float32=ae.float=Ln),o.oes_texture_half_float&&(ae.float16=ae["half float"]=un),o.webgl_depth_texture&&(a(W,{depth:ti,"depth stencil":aa}),a(ae,{uint16:si,uint32:ui,"depth stencil":Ll})),o.webgl_compressed_texture_s3tc&&a(K,{"rgb s3tc dxt1":ai,"rgba s3tc dxt1":ii,"rgba s3tc dxt3":fi,"rgba s3tc dxt5":oi}),o.webgl_compressed_texture_atc&&a(K,{"rgb atc":Sf,"rgba atc explicit alpha":Rf,"rgba atc interpolated alpha":Lf}),o.webgl_compressed_texture_pvrtc&&a(K,{"rgb pvrtc 4bppv1":Cf,"rgb pvrtc 2bppv1":Of,"rgba pvrtc 4bppv1":kf,"rgba pvrtc 2bppv1":Df}),o.webgl_compressed_texture_etc1&&(K["rgb etc1"]=Ff);var A=Array.prototype.slice.call(t.getParameter(Tl));Object.keys(K).forEach(function(c){var F=K[c];A.indexOf(F)>=0&&(W[c]=F)});var G=Object.keys(W);h.textureFormats=G;var Q=[];Object.keys(W).forEach(function(c){var F=W[c];Q[F]=c});var pe=[];Object.keys(ae).forEach(function(c){var F=ae[c];pe[F]=c});var V=[];Object.keys(Z).forEach(function(c){var F=Z[c];V[F]=c});var he=[];Object.keys($).forEach(function(c){var F=$[c];he[F]=c});var le=[];Object.keys(z).forEach(function(c){var F=z[c];le[F]=c});var Fe=G.reduce(function(c,F){var C=W[F];return C===Rn||C===$a||C===Rn||C===na||C===ti||C===aa||o.ext_srgb&&(C===ri||C===ni)?c[C]=C:C===ei||F.indexOf("rgba")>=0?c[C]=Wr:c[C]=ra,c},{});function U(){this.internalformat=Wr,this.format=Wr,this.type=ln,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=If,this.width=0,this.height=0,this.channels=0}function M(c,F){c.internalformat=F.internalformat,c.format=F.format,c.type=F.type,c.compressed=F.compressed,c.premultiplyAlpha=F.premultiplyAlpha,c.flipY=F.flipY,c.unpackAlignment=F.unpackAlignment,c.colorSpace=F.colorSpace,c.width=F.width,c.height=F.height,c.channels=F.channels}function ye(c,F){if(!(typeof F!="object"||!F)){if("premultiplyAlpha"in F&&(f.type(F.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),c.premultiplyAlpha=F.premultiplyAlpha),"flipY"in F&&(f.type(F.flipY,"boolean","invalid texture flip"),c.flipY=F.flipY),"alignment"in F&&(f.oneOf(F.alignment,[1,2,4,8],"invalid texture unpack alignment"),c.unpackAlignment=F.alignment),"colorSpace"in F&&(f.parameter(F.colorSpace,J,"invalid colorSpace"),c.colorSpace=J[F.colorSpace]),"type"in F){var C=F.type;f(o.oes_texture_float||!(C==="float"||C==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),f(o.oes_texture_half_float||!(C==="half float"||C==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),f(o.webgl_depth_texture||!(C==="uint16"||C==="uint32"||C==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),f.parameter(C,ae,"invalid texture type"),c.type=ae[C]}var be=c.width,Ze=c.height,u=c.channels,i=!1;"shape"in F?(f(Array.isArray(F.shape)&&F.shape.length>=2,"shape must be an array"),be=F.shape[0],Ze=F.shape[1],F.shape.length===3&&(u=F.shape[2],f(u>0&&u<=4,"invalid number of channels"),i=!0),f(be>=0&&be<=h.maxTextureSize,"invalid width"),f(Ze>=0&&Ze<=h.maxTextureSize,"invalid height")):("radius"in F&&(be=Ze=F.radius,f(be>=0&&be<=h.maxTextureSize,"invalid radius")),"width"in F&&(be=F.width,f(be>=0&&be<=h.maxTextureSize,"invalid width")),"height"in F&&(Ze=F.height,f(Ze>=0&&Ze<=h.maxTextureSize,"invalid height")),"channels"in F&&(u=F.channels,f(u>0&&u<=4,"invalid number of channels"),i=!0)),c.width=be|0,c.height=Ze|0,c.channels=u|0;var v=!1;if("format"in F){var E=F.format;f(o.webgl_depth_texture||!(E==="depth"||E==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),f.parameter(E,W,"invalid texture format");var S=c.internalformat=W[E];c.format=Fe[S],E in ae&&("type"in F||(c.type=ae[E])),E in K&&(c.compressed=!0),v=!0}!i&&v?c.channels=dr[c.format]:i&&!v?c.channels!==fa[c.format]&&(c.format=c.internalformat=fa[c.channels]):v&&i&&f(c.channels===dr[c.format],"number of channels inconsistent with specified format")}}function ie(c){t.pixelStorei(jl,c.flipY),t.pixelStorei(Vl,c.premultiplyAlpha),t.pixelStorei(zl,c.colorSpace),t.pixelStorei(Ul,c.unpackAlignment)}function Y(){U.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function oe(c,F){var C=null;if(mi(F)?C=F:F&&(f.type(F,"object","invalid pixel data type"),ye(c,F),"x"in F&&(c.xOffset=F.x|0),"y"in F&&(c.yOffset=F.y|0),mi(F.data)&&(C=F.data)),f(!c.compressed||C instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),F.copy){f(!C,"can not specify copy and data field for the same texture");var be=B.viewportWidth,Ze=B.viewportHeight;c.width=c.width||be-c.xOffset,c.height=c.height||Ze-c.yOffset,c.needsCopy=!0,f(c.xOffset>=0&&c.xOffset<be&&c.yOffset>=0&&c.yOffset<Ze&&c.width>0&&c.width<=be&&c.height>0&&c.height<=Ze,"copy texture read out of bounds")}else if(!C)c.width=c.width||1,c.height=c.height||1,c.channels=c.channels||4;else if(n(C))c.channels=c.channels||4,c.data=C,!("type"in F)&&c.type===ln&&(c.type=qf(C));else if(zf(C))c.channels=c.channels||4,Kl(c,C),c.alignment=1,c.needsFree=!0;else if(pr(C)){var u=C.data;!Array.isArray(u)&&c.type===ln&&(c.type=qf(u));var i=C.shape,v=C.stride,E,S,b,_,g,s;i.length===3?(b=i[2],s=v[2]):(f(i.length===2,"invalid ndarray pixel data, must be 2 or 3D"),b=1,s=1),E=i[0],S=i[1],_=v[0],g=v[1],c.alignment=1,c.width=E,c.height=S,c.channels=b,c.format=c.internalformat=fa[b],c.needsFree=!0,Zl(c,u,_,g,s,C.offset)}else if(Xf(C)||Wf(C)||Wl(C))Xf(C)||Wf(C)?c.element=C:c.element=C.canvas,c.width=c.element.width,c.height=c.element.height,c.channels=4;else if(ql(C))c.element=C,c.width=C.width,c.height=C.height,c.channels=4;else if(Yl(C))c.element=C,c.width=C.naturalWidth,c.height=C.naturalHeight,c.channels=4;else if(Ql(C))c.element=C,c.width=C.videoWidth,c.height=C.videoHeight,c.channels=4;else if(Hf(C)){var p=c.width||C[0].length,l=c.height||C.length,w=c.channels;Gt(C[0][0])?w=w||C[0][0].length:w=w||1;for(var R=Jn.shape(C),j=1,re=0;re<R.length;++re)j*=R[re];var ne=Yf(c,j);Jn.flatten(C,R,"",ne),Qf(c,ne),c.alignment=1,c.width=p,c.height=l,c.channels=w,c.format=c.internalformat=fa[w],c.needsFree=!0}c.type===Ln?f(h.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):c.type===un&&f(h.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function se(c,F,C){var be=c.element,Ze=c.data,u=c.internalformat,i=c.format,v=c.type,E=c.width,S=c.height;ie(c),be?t.texImage2D(F,C,i,i,v,be):c.compressed?t.compressedTexImage2D(F,C,u,E,S,0,Ze):c.needsCopy?(D(),t.copyTexImage2D(F,C,i,c.xOffset,c.yOffset,E,S,0)):t.texImage2D(F,C,i,E,S,0,i,v,Ze||null)}function Xe(c,F,C,be,Ze){var u=c.element,i=c.data,v=c.internalformat,E=c.format,S=c.type,b=c.width,_=c.height;ie(c),u?t.texSubImage2D(F,Ze,C,be,E,S,u):c.compressed?t.compressedTexSubImage2D(F,Ze,C,be,v,b,_,i):c.needsCopy?(D(),t.copyTexSubImage2D(F,Ze,C,be,c.xOffset,c.yOffset,b,_)):t.texSubImage2D(F,Ze,C,be,b,_,E,S,i)}var Ve=[];function ce(){return Ve.pop()||new Y}function me(c){c.needsFree&&Pt.freeType(c.data),Y.call(c),Ve.push(c)}function Pe(){U.call(this),this.genMipmaps=!1,this.mipmapHint=ia,this.mipmask=0,this.images=Array(16)}function He(c,F,C){var be=c.images[0]=ce();c.mipmask=1,be.width=c.width=F,be.height=c.height=C,be.channels=c.channels=4}function tt(c,F){var C=null;if(mi(F))C=c.images[0]=ce(),M(C,c),oe(C,F),c.mipmask=1;else if(ye(c,F),Array.isArray(F.mipmap))for(var be=F.mipmap,Ze=0;Ze<be.length;++Ze)C=c.images[Ze]=ce(),M(C,c),C.width>>=Ze,C.height>>=Ze,oe(C,be[Ze]),c.mipmask|=1<<Ze;else C=c.images[0]=ce(),M(C,c),oe(C,F),c.mipmask=1;M(c,c.images[0]),c.compressed&&(c.internalformat===ai||c.internalformat===ii||c.internalformat===fi||c.internalformat===oi)&&f(c.width%4===0&&c.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ot(c,F){for(var C=c.images,be=0;be<C.length;++be){if(!C[be])return;se(C[be],F,be)}}var kt=[];function it(){var c=kt.pop()||new Pe;U.call(c),c.mipmask=0;for(var F=0;F<16;++F)c.images[F]=null;return c}function Ht(c){for(var F=c.images,C=0;C<F.length;++C)F[C]&&me(F[C]),F[C]=null;kt.push(c)}function Rt(){this.minFilter=ci,this.magFilter=ci,this.wrapS=li,this.wrapT=li,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ia}function jt(c,F){if("min"in F){var C=F.min;f.parameter(C,$),c.minFilter=$[C],Hl.indexOf(c.minFilter)>=0&&!("faces"in F)&&(c.genMipmaps=!0)}if("mag"in F){var be=F.mag;f.parameter(be,Z),c.magFilter=Z[be]}var Ze=c.wrapS,u=c.wrapT;if("wrap"in F){var i=F.wrap;typeof i=="string"?(f.parameter(i,z),Ze=u=z[i]):Array.isArray(i)&&(f.parameter(i[0],z),f.parameter(i[1],z),Ze=z[i[0]],u=z[i[1]])}else{if("wrapS"in F){var v=F.wrapS;f.parameter(v,z),Ze=z[v]}if("wrapT"in F){var E=F.wrapT;f.parameter(E,z),u=z[E]}}if(c.wrapS=Ze,c.wrapT=u,"anisotropic"in F){var S=F.anisotropic;f(typeof S=="number"&&S>=1&&S<=h.maxAnisotropic,"aniso samples must be between 1 and "),c.anisotropic=F.anisotropic}if("mipmap"in F){var b=!1;switch(typeof F.mipmap){case"string":f.parameter(F.mipmap,X,"invalid mipmap hint"),c.mipmapHint=X[F.mipmap],c.genMipmaps=!0,b=!0;break;case"boolean":b=c.genMipmaps=F.mipmap;break;case"object":f(Array.isArray(F.mipmap),"invalid mipmap type"),c.genMipmaps=!1,b=!0;break;default:f.raise("invalid mipmap type")}b&&!("min"in F)&&(c.minFilter=di)}}function Xt(c,F){t.texParameteri(F,Gl,c.minFilter),t.texParameteri(F,Fl,c.magFilter),t.texParameteri(F,Cl,c.wrapS),t.texParameteri(F,Ol,c.wrapT),o.ext_texture_filter_anisotropic&&t.texParameteri(F,Pl,c.anisotropic),c.genMipmaps&&(t.hint(Il,c.mipmapHint),t.generateMipmap(F))}var Wt=0,Kt={},$t=h.maxTextureUnits,Nt=Array($t).map(function(){return null});function qe(c){U.call(this),this.mipmask=0,this.internalformat=Wr,this.id=Wt++,this.refCount=1,this.target=c,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Rt,I.profile&&(this.stats={size:0})}function er(c){t.activeTexture(Cn),t.bindTexture(c.target,c.texture)}function mt(){var c=Nt[0];c?t.bindTexture(c.target,c.texture):t.bindTexture(Er,null)}function Ie(c){var F=c.texture;f(F,"must not double destroy texture");var C=c.unit,be=c.target;C>=0&&(t.activeTexture(Cn+C),t.bindTexture(be,null),Nt[C]=null),t.deleteTexture(F),c.texture=null,c.params=null,c.pixels=null,c.refCount=0,delete Kt[c.id],k.textureCount--}a(qe.prototype,{bind:function(){var c=this;c.bindCount+=1;var F=c.unit;if(F<0){for(var C=0;C<$t;++C){var be=Nt[C];if(be){if(be.bindCount>0)continue;be.unit=-1}Nt[C]=c,F=C;break}F>=$t&&f.raise("insufficient number of texture units"),I.profile&&k.maxTextureUnits<F+1&&(k.maxTextureUnits=F+1),c.unit=F,t.activeTexture(Cn+F),t.bindTexture(c.target,c.texture)}return F},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ie(this)}});function rt(c,F){var C=new qe(Er);Kt[C.id]=C,k.textureCount++;function be(i,v){var E=C.texInfo;Rt.call(E);var S=it();return typeof i=="number"?typeof v=="number"?He(S,i|0,v|0):He(S,i|0,i|0):i?(f.type(i,"object","invalid arguments to regl.texture"),jt(E,i),tt(S,i)):He(S,1,1),E.genMipmaps&&(S.mipmask=(S.width<<1)-1),C.mipmask=S.mipmask,M(C,S),f.texture2D(E,S,h),C.internalformat=S.internalformat,be.width=S.width,be.height=S.height,er(C),Ot(S,Er),Xt(E,Er),mt(),Ht(S),I.profile&&(C.stats.size=oa(C.internalformat,C.type,S.width,S.height,E.genMipmaps,!1)),be.format=Q[C.internalformat],be.type=pe[C.type],be.mag=V[E.magFilter],be.min=he[E.minFilter],be.wrapS=le[E.wrapS],be.wrapT=le[E.wrapT],be}function Ze(i,v,E,S){f(!!i,"must specify image data");var b=v|0,_=E|0,g=S|0,s=ce();return M(s,C),s.width=0,s.height=0,oe(s,i),s.width=s.width||(C.width>>g)-b,s.height=s.height||(C.height>>g)-_,f(C.type===s.type&&C.format===s.format&&C.internalformat===s.internalformat,"incompatible format for texture.subimage"),f(b>=0&&_>=0&&b+s.width<=C.width&&_+s.height<=C.height,"texture.subimage write out of bounds"),f(C.mipmask&1<<g,"missing mipmap data"),f(s.data||s.element||s.needsCopy,"missing image data"),er(C),Xe(s,Er,b,_,g),mt(),me(s),be}function u(i,v){var E=i|0,S=v|0||E;if(E===C.width&&S===C.height)return be;be.width=C.width=E,be.height=C.height=S,er(C);for(var b=0;C.mipmask>>b;++b){var _=E>>b,g=S>>b;if(!_||!g)break;t.texImage2D(Er,b,C.format,_,g,0,C.format,C.type,null)}return mt(),I.profile&&(C.stats.size=oa(C.internalformat,C.type,E,S,!1,!1)),be}return be(c,F),be.subimage=Ze,be.resize=u,be._reglType="texture2d",be._texture=C,I.profile&&(be.stats=C.stats),be.destroy=function(){C.decRef()},be}function ct(c,F,C,be,Ze,u){var i=new qe(Ja);Kt[i.id]=i,k.cubeCount++;var v=new Array(6);function E(_,g,s,p,l,w){var R,j=i.texInfo;for(Rt.call(j),R=0;R<6;++R)v[R]=it();if(typeof _=="number"||!_){var re=_|0||1;for(R=0;R<6;++R)He(v[R],re,re)}else if(typeof _=="object")if(g)tt(v[0],_),tt(v[1],g),tt(v[2],s),tt(v[3],p),tt(v[4],l),tt(v[5],w);else if(jt(j,_),ye(i,_),"faces"in _){var ne=_.faces;for(f(Array.isArray(ne)&&ne.length===6,"cube faces must be a length 6 array"),R=0;R<6;++R)f(typeof ne[R]=="object"&&!!ne[R],"invalid input for cube map face"),M(v[R],i),tt(v[R],ne[R])}else for(R=0;R<6;++R)tt(v[R],_);else f.raise("invalid arguments to cube map");for(M(i,v[0]),f.optional(function(){h.npotTextureCube||f(Af(i.width)&&Af(i.height),"your browser does not support non power or two texture dimensions")}),j.genMipmaps?i.mipmask=(v[0].width<<1)-1:i.mipmask=v[0].mipmask,f.textureCube(i,j,v,h),i.internalformat=v[0].internalformat,E.width=v[0].width,E.height=v[0].height,er(i),R=0;R<6;++R)Ot(v[R],ta+R);for(Xt(j,Ja),mt(),I.profile&&(i.stats.size=oa(i.internalformat,i.type,E.width,E.height,j.genMipmaps,!0)),E.format=Q[i.internalformat],E.type=pe[i.type],E.mag=V[j.magFilter],E.min=he[j.minFilter],E.wrapS=le[j.wrapS],E.wrapT=le[j.wrapT],R=0;R<6;++R)Ht(v[R]);return E}function S(_,g,s,p,l){f(!!g,"must specify image data"),f(typeof _=="number"&&_===(_|0)&&_>=0&&_<6,"invalid face");var w=s|0,R=p|0,j=l|0,re=ce();return M(re,i),re.width=0,re.height=0,oe(re,g),re.width=re.width||(i.width>>j)-w,re.height=re.height||(i.height>>j)-R,f(i.type===re.type&&i.format===re.format&&i.internalformat===re.internalformat,"incompatible format for texture.subimage"),f(w>=0&&R>=0&&w+re.width<=i.width&&R+re.height<=i.height,"texture.subimage write out of bounds"),f(i.mipmask&1<<j,"missing mipmap data"),f(re.data||re.element||re.needsCopy,"missing image data"),er(i),Xe(re,ta+_,w,R,j),mt(),me(re),E}function b(_){var g=_|0;if(g!==i.width){E.width=i.width=g,E.height=i.height=g,er(i);for(var s=0;s<6;++s)for(var p=0;i.mipmask>>p;++p)t.texImage2D(ta+s,p,i.format,g>>p,g>>p,0,i.format,i.type,null);return mt(),I.profile&&(i.stats.size=oa(i.internalformat,i.type,E.width,E.height,!1,!0)),E}}return E(c,F,C,be,Ze,u),E.subimage=S,E.resize=b,E._reglType="textureCube",E._texture=i,I.profile&&(E.stats=i.stats),E.destroy=function(){i.decRef()},E}function It(){for(var c=0;c<$t;++c)t.activeTexture(Cn+c),t.bindTexture(Er,null),Nt[c]=null;sr(Kt).forEach(Ie),k.cubeCount=0,k.textureCount=0}I.profile&&(k.getTotalTextureSize=function(){var c=0;return Object.keys(Kt).forEach(function(F){c+=Kt[F].stats.size}),c});function Tr(){for(var c=0;c<$t;++c){var F=Nt[c];F&&(F.bindCount=0,F.unit=-1,Nt[c]=null)}sr(Kt).forEach(function(C){C.texture=t.createTexture(),t.bindTexture(C.target,C.texture);for(var be=0;be<32;++be)if((C.mipmask&1<<be)!==0)if(C.target===Er)t.texImage2D(Er,be,C.internalformat,C.width>>be,C.height>>be,0,C.internalformat,C.type,null);else for(var Ze=0;Ze<6;++Ze)t.texImage2D(ta+Ze,be,C.internalformat,C.width>>be,C.height>>be,0,C.internalformat,C.type,null);Xt(C.texInfo,C.target)})}function en(){for(var c=0;c<$t;++c){var F=Nt[c];F&&(F.bindCount=0,F.unit=-1,Nt[c]=null),t.activeTexture(Cn+c),t.bindTexture(Er,null),t.bindTexture(Ja,null)}}return{create2D:rt,createCube:ct,clear:It,getTexture:function(c){return null},restore:Tr,refresh:en}}var Ir=36161,sa=32854,Kf=32855,Zf=36194,Jf=33189,$f=36168,eo=34041,to=35907,ro=34836,no=34842,ao=34843,vr=[];vr[sa]=2,vr[Kf]=2,vr[Zf]=2,vr[Jf]=2,vr[$f]=1,vr[eo]=4,vr[to]=4,vr[ro]=16,vr[no]=8,vr[ao]=6;function io(t,o,h){return vr[t]*o*h}var $l=function(t,o,h,D,B){var k={rgba4:sa,rgb565:Zf,"rgb5 a1":Kf,depth:Jf,stencil:$f,"depth stencil":eo};o.ext_srgb&&(k.srgba=to),o.ext_color_buffer_half_float&&(k.rgba16f=no,k.rgb16f=ao),o.webgl_color_buffer_float&&(k.rgba32f=ro);var I=[];Object.keys(k).forEach(function(W){var K=k[W];I[K]=W});var X=0,z={};function Z(W){this.id=X++,this.refCount=1,this.renderbuffer=W,this.format=sa,this.width=0,this.height=0,B.profile&&(this.stats={size:0})}Z.prototype.decRef=function(){--this.refCount<=0&&$(this)};function $(W){var K=W.renderbuffer;f(K,"must not double destroy renderbuffer"),t.bindRenderbuffer(Ir,null),t.deleteRenderbuffer(K),W.renderbuffer=null,W.refCount=0,delete z[W.id],D.renderbufferCount--}function J(W,K){var A=new Z(t.createRenderbuffer());z[A.id]=A,D.renderbufferCount++;function G(pe,V){var he=0,le=0,Fe=sa;if(typeof pe=="object"&&pe){var U=pe;if("shape"in U){var M=U.shape;f(Array.isArray(M)&&M.length>=2,"invalid renderbuffer shape"),he=M[0]|0,le=M[1]|0}else"radius"in U&&(he=le=U.radius|0),"width"in U&&(he=U.width|0),"height"in U&&(le=U.height|0);"format"in U&&(f.parameter(U.format,k,"invalid renderbuffer format"),Fe=k[U.format])}else typeof pe=="number"?(he=pe|0,typeof V=="number"?le=V|0:le=he):pe?f.raise("invalid arguments to renderbuffer constructor"):he=le=1;if(f(he>0&&le>0&&he<=h.maxRenderbufferSize&&le<=h.maxRenderbufferSize,"invalid renderbuffer size"),!(he===A.width&&le===A.height&&Fe===A.format))return G.width=A.width=he,G.height=A.height=le,A.format=Fe,t.bindRenderbuffer(Ir,A.renderbuffer),t.renderbufferStorage(Ir,Fe,he,le),f(t.getError()===0,"invalid render buffer format"),B.profile&&(A.stats.size=io(A.format,A.width,A.height)),G.format=I[A.format],G}function Q(pe,V){var he=pe|0,le=V|0||he;return he===A.width&&le===A.height||(f(he>0&&le>0&&he<=h.maxRenderbufferSize&&le<=h.maxRenderbufferSize,"invalid renderbuffer size"),G.width=A.width=he,G.height=A.height=le,t.bindRenderbuffer(Ir,A.renderbuffer),t.renderbufferStorage(Ir,A.format,he,le),f(t.getError()===0,"invalid render buffer format"),B.profile&&(A.stats.size=io(A.format,A.width,A.height))),G}return G(W,K),G.resize=Q,G._reglType="renderbuffer",G._renderbuffer=A,B.profile&&(G.stats=A.stats),G.destroy=function(){A.decRef()},G}B.profile&&(D.getTotalRenderbufferSize=function(){var W=0;return Object.keys(z).forEach(function(K){W+=z[K].stats.size}),W});function ae(){sr(z).forEach(function(W){W.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Ir,W.renderbuffer),t.renderbufferStorage(Ir,W.format,W.width,W.height)}),t.bindRenderbuffer(Ir,null)}return{create:J,clear:function(){sr(z).forEach($)},restore:ae}},Rr=36160,pi=36161,Yr=3553,ua=34069,fo=36064,oo=36096,so=36128,uo=33306,lo=36053,ec=36054,tc=36055,rc=36057,nc=36061,ac=36193,ic=5121,fc=5126,co=6407,ho=6408,oc=6402,sc=[co,ho],vi=[];vi[ho]=4,vi[co]=3;var la=[];la[ic]=1,la[fc]=4,la[ac]=2;var uc=32854,lc=32855,cc=36194,dc=33189,hc=36168,mo=34041,mc=35907,pc=34836,vc=34842,_c=34843,bc=[uc,lc,cc,mc,vc,_c,pc],hn={};hn[lo]="complete",hn[ec]="incomplete attachment",hn[rc]="incomplete dimensions",hn[tc]="incomplete, missing attachment",hn[nc]="unsupported";function yc(t,o,h,D,B,k){var I={cur:null,next:null,dirty:!1,setFBO:null},X=["rgba"],z=["rgba4","rgb565","rgb5 a1"];o.ext_srgb&&z.push("srgba"),o.ext_color_buffer_half_float&&z.push("rgba16f","rgb16f"),o.webgl_color_buffer_float&&z.push("rgba32f");var Z=["uint8"];o.oes_texture_half_float&&Z.push("half float","float16"),o.oes_texture_float&&Z.push("float","float32");function $(Y,oe,se){this.target=Y,this.texture=oe,this.renderbuffer=se;var Xe=0,Ve=0;oe?(Xe=oe.width,Ve=oe.height):se&&(Xe=se.width,Ve=se.height),this.width=Xe,this.height=Ve}function J(Y){Y&&(Y.texture&&Y.texture._texture.decRef(),Y.renderbuffer&&Y.renderbuffer._renderbuffer.decRef())}function ae(Y,oe,se){if(!!Y)if(Y.texture){var Xe=Y.texture._texture,Ve=Math.max(1,Xe.width),ce=Math.max(1,Xe.height);f(Ve===oe&&ce===se,"inconsistent width/height for supplied texture"),Xe.refCount+=1}else{var me=Y.renderbuffer._renderbuffer;f(me.width===oe&&me.height===se,"inconsistent width/height for renderbuffer"),me.refCount+=1}}function W(Y,oe){oe&&(oe.texture?t.framebufferTexture2D(Rr,Y,oe.target,oe.texture._texture.texture,0):t.framebufferRenderbuffer(Rr,Y,pi,oe.renderbuffer._renderbuffer.renderbuffer))}function K(Y){var oe=Yr,se=null,Xe=null,Ve=Y;typeof Y=="object"&&(Ve=Y.data,"target"in Y&&(oe=Y.target|0)),f.type(Ve,"function","invalid attachment data");var ce=Ve._reglType;return ce==="texture2d"?(se=Ve,f(oe===Yr)):ce==="textureCube"?(se=Ve,f(oe>=ua&&oe<ua+6,"invalid cube map target")):ce==="renderbuffer"?(Xe=Ve,oe=pi):f.raise("invalid regl object for attachment"),new $(oe,se,Xe)}function A(Y,oe,se,Xe,Ve){if(se){var ce=D.create2D({width:Y,height:oe,format:Xe,type:Ve});return ce._texture.refCount=0,new $(Yr,ce,null)}else{var me=B.create({width:Y,height:oe,format:Xe});return me._renderbuffer.refCount=0,new $(pi,null,me)}}function G(Y){return Y&&(Y.texture||Y.renderbuffer)}function Q(Y,oe,se){Y&&(Y.texture?Y.texture.resize(oe,se):Y.renderbuffer&&Y.renderbuffer.resize(oe,se),Y.width=oe,Y.height=se)}var pe=0,V={};function he(){this.id=pe++,V[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function le(Y){Y.colorAttachments.forEach(J),J(Y.depthAttachment),J(Y.stencilAttachment),J(Y.depthStencilAttachment)}function Fe(Y){var oe=Y.framebuffer;f(oe,"must not double destroy framebuffer"),t.deleteFramebuffer(oe),Y.framebuffer=null,k.framebufferCount--,delete V[Y.id]}function U(Y){var oe;t.bindFramebuffer(Rr,Y.framebuffer);var se=Y.colorAttachments;for(oe=0;oe<se.length;++oe)W(fo+oe,se[oe]);for(oe=se.length;oe<h.maxColorAttachments;++oe)t.framebufferTexture2D(Rr,fo+oe,Yr,null,0);t.framebufferTexture2D(Rr,uo,Yr,null,0),t.framebufferTexture2D(Rr,oo,Yr,null,0),t.framebufferTexture2D(Rr,so,Yr,null,0),W(oo,Y.depthAttachment),W(so,Y.stencilAttachment),W(uo,Y.depthStencilAttachment);var Xe=t.checkFramebufferStatus(Rr);!t.isContextLost()&&Xe!==lo&&f.raise("framebuffer configuration not supported, status = "+hn[Xe]),t.bindFramebuffer(Rr,I.next?I.next.framebuffer:null),I.cur=I.next,t.getError()}function M(Y,oe){var se=new he;k.framebufferCount++;function Xe(ce,me){var Pe;f(I.next!==se,"can not update framebuffer which is currently in use");var He=0,tt=0,Ot=!0,kt=!0,it=null,Ht=!0,Rt="rgba",jt="uint8",Xt=1,Wt=null,Kt=null,$t=null,Nt=!1;if(typeof ce=="number")He=ce|0,tt=me|0||He;else if(!ce)He=tt=1;else{f.type(ce,"object","invalid arguments for framebuffer");var qe=ce;if("shape"in qe){var er=qe.shape;f(Array.isArray(er)&&er.length>=2,"invalid shape for framebuffer"),He=er[0],tt=er[1]}else"radius"in qe&&(He=tt=qe.radius),"width"in qe&&(He=qe.width),"height"in qe&&(tt=qe.height);("color"in qe||"colors"in qe)&&(it=qe.color||qe.colors,Array.isArray(it)&&f(it.length===1||o.webgl_draw_buffers,"multiple render targets not supported")),it||("colorCount"in qe&&(Xt=qe.colorCount|0,f(Xt>0,"invalid color buffer count")),"colorTexture"in qe&&(Ht=!!qe.colorTexture,Rt="rgba4"),"colorType"in qe&&(jt=qe.colorType,Ht?(f(o.oes_texture_float||!(jt==="float"||jt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),f(o.oes_texture_half_float||!(jt==="half float"||jt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):jt==="half float"||jt==="float16"?(f(o.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Rt="rgba16f"):(jt==="float"||jt==="float32")&&(f(o.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Rt="rgba32f"),f.oneOf(jt,Z,"invalid color type")),"colorFormat"in qe&&(Rt=qe.colorFormat,X.indexOf(Rt)>=0?Ht=!0:z.indexOf(Rt)>=0?Ht=!1:f.optional(function(){Ht?f.oneOf(qe.colorFormat,X,"invalid color format for texture"):f.oneOf(qe.colorFormat,z,"invalid color format for renderbuffer")}))),("depthTexture"in qe||"depthStencilTexture"in qe)&&(Nt=!!(qe.depthTexture||qe.depthStencilTexture),f(!Nt||o.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in qe&&(typeof qe.depth=="boolean"?Ot=qe.depth:(Wt=qe.depth,kt=!1)),"stencil"in qe&&(typeof qe.stencil=="boolean"?kt=qe.stencil:(Kt=qe.stencil,Ot=!1)),"depthStencil"in qe&&(typeof qe.depthStencil=="boolean"?Ot=kt=qe.depthStencil:($t=qe.depthStencil,Ot=!1,kt=!1))}var mt=null,Ie=null,rt=null,ct=null;if(Array.isArray(it))mt=it.map(K);else if(it)mt=[K(it)];else for(mt=new Array(Xt),Pe=0;Pe<Xt;++Pe)mt[Pe]=A(He,tt,Ht,Rt,jt);f(o.webgl_draw_buffers||mt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),f(mt.length<=h.maxColorAttachments,"too many color attachments, not supported"),He=He||mt[0].width,tt=tt||mt[0].height,Wt?Ie=K(Wt):Ot&&!kt&&(Ie=A(He,tt,Nt,"depth","uint32")),Kt?rt=K(Kt):kt&&!Ot&&(rt=A(He,tt,!1,"stencil","uint8")),$t?ct=K($t):!Wt&&!Kt&&kt&&Ot&&(ct=A(He,tt,Nt,"depth stencil","depth stencil")),f(!!Wt+!!Kt+!!$t<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var It=null;for(Pe=0;Pe<mt.length;++Pe)if(ae(mt[Pe],He,tt),f(!mt[Pe]||mt[Pe].texture&&sc.indexOf(mt[Pe].texture._texture.format)>=0||mt[Pe].renderbuffer&&bc.indexOf(mt[Pe].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Pe+" is invalid"),mt[Pe]&&mt[Pe].texture){var Tr=vi[mt[Pe].texture._texture.format]*la[mt[Pe].texture._texture.type];It===null?It=Tr:f(It===Tr,"all color attachments much have the same number of bits per pixel.")}return ae(Ie,He,tt),f(!Ie||Ie.texture&&Ie.texture._texture.format===oc||Ie.renderbuffer&&Ie.renderbuffer._renderbuffer.format===dc,"invalid depth attachment for framebuffer object"),ae(rt,He,tt),f(!rt||rt.renderbuffer&&rt.renderbuffer._renderbuffer.format===hc,"invalid stencil attachment for framebuffer object"),ae(ct,He,tt),f(!ct||ct.texture&&ct.texture._texture.format===mo||ct.renderbuffer&&ct.renderbuffer._renderbuffer.format===mo,"invalid depth-stencil attachment for framebuffer object"),le(se),se.width=He,se.height=tt,se.colorAttachments=mt,se.depthAttachment=Ie,se.stencilAttachment=rt,se.depthStencilAttachment=ct,Xe.color=mt.map(G),Xe.depth=G(Ie),Xe.stencil=G(rt),Xe.depthStencil=G(ct),Xe.width=se.width,Xe.height=se.height,U(se),Xe}function Ve(ce,me){f(I.next!==se,"can not resize a framebuffer which is currently in use");var Pe=Math.max(ce|0,1),He=Math.max(me|0||Pe,1);if(Pe===se.width&&He===se.height)return Xe;for(var tt=se.colorAttachments,Ot=0;Ot<tt.length;++Ot)Q(tt[Ot],Pe,He);return Q(se.depthAttachment,Pe,He),Q(se.stencilAttachment,Pe,He),Q(se.depthStencilAttachment,Pe,He),se.width=Xe.width=Pe,se.height=Xe.height=He,U(se),Xe}return Xe(Y,oe),a(Xe,{resize:Ve,_reglType:"framebuffer",_framebuffer:se,destroy:function(){Fe(se),le(se)},use:function(ce){I.setFBO({framebuffer:Xe},ce)}})}function ye(Y){var oe=Array(6);function se(Ve){var ce;f(oe.indexOf(I.next)<0,"can not update framebuffer which is currently in use");var me={color:null},Pe=0,He=null,tt="rgba",Ot="uint8",kt=1;if(typeof Ve=="number")Pe=Ve|0;else if(!Ve)Pe=1;else{f.type(Ve,"object","invalid arguments for framebuffer");var it=Ve;if("shape"in it){var Ht=it.shape;f(Array.isArray(Ht)&&Ht.length>=2,"invalid shape for framebuffer"),f(Ht[0]===Ht[1],"cube framebuffer must be square"),Pe=Ht[0]}else"radius"in it&&(Pe=it.radius|0),"width"in it?(Pe=it.width|0,"height"in it&&f(it.height===Pe,"must be square")):"height"in it&&(Pe=it.height|0);("color"in it||"colors"in it)&&(He=it.color||it.colors,Array.isArray(He)&&f(He.length===1||o.webgl_draw_buffers,"multiple render targets not supported")),He||("colorCount"in it&&(kt=it.colorCount|0,f(kt>0,"invalid color buffer count")),"colorType"in it&&(f.oneOf(it.colorType,Z,"invalid color type"),Ot=it.colorType),"colorFormat"in it&&(tt=it.colorFormat,f.oneOf(it.colorFormat,X,"invalid color format for texture"))),"depth"in it&&(me.depth=it.depth),"stencil"in it&&(me.stencil=it.stencil),"depthStencil"in it&&(me.depthStencil=it.depthStencil)}var Rt;if(He)if(Array.isArray(He))for(Rt=[],ce=0;ce<He.length;++ce)Rt[ce]=He[ce];else Rt=[He];else{Rt=Array(kt);var jt={radius:Pe,format:tt,type:Ot};for(ce=0;ce<kt;++ce)Rt[ce]=D.createCube(jt)}for(me.color=Array(Rt.length),ce=0;ce<Rt.length;++ce){var Xt=Rt[ce];f(typeof Xt=="function"&&Xt._reglType==="textureCube","invalid cube map"),Pe=Pe||Xt.width,f(Xt.width===Pe&&Xt.height===Pe,"invalid cube map shape"),me.color[ce]={target:ua,data:Rt[ce]}}for(ce=0;ce<6;++ce){for(var Wt=0;Wt<Rt.length;++Wt)me.color[Wt].target=ua+ce;ce>0&&(me.depth=oe[0].depth,me.stencil=oe[0].stencil,me.depthStencil=oe[0].depthStencil),oe[ce]?oe[ce](me):oe[ce]=M(me)}return a(se,{width:Pe,height:Pe,color:Rt})}function Xe(Ve){var ce,me=Ve|0;if(f(me>0&&me<=h.maxCubeMapSize,"invalid radius for cube fbo"),me===se.width)return se;var Pe=se.color;for(ce=0;ce<Pe.length;++ce)Pe[ce].resize(me);for(ce=0;ce<6;++ce)oe[ce].resize(me);return se.width=se.height=me,se}return se(Y),a(se,{faces:oe,resize:Xe,_reglType:"framebufferCube",destroy:function(){oe.forEach(function(Ve){Ve.destroy()})}})}function ie(){I.cur=null,I.next=null,I.dirty=!0,sr(V).forEach(function(Y){Y.framebuffer=t.createFramebuffer(),U(Y)})}return a(I,{getFramebuffer:function(Y){if(typeof Y=="function"&&Y._reglType==="framebuffer"){var oe=Y._framebuffer;if(oe instanceof he)return oe}return null},create:M,createCube:ye,clear:function(){sr(V).forEach(Fe)},restore:ie})}var gc=5126,po=34962,ca=34963,vo=["attributes","elements","offset","count","primitive","instances"];function _i(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=gc,this.offset=0,this.stride=0,this.divisor=0}function xc(t,o,h,D,B,k,I){for(var X=h.maxAttributes,z=new Array(X),Z=0;Z<X;++Z)z[Z]=new _i;var $=0,J={},ae={Record:_i,scope:{},state:z,currentVAO:null,targetVAO:null,restore:K()?le:function(){},createVAO:Fe,getVAO:G,destroyBuffer:W,setVAO:K()?Q:pe,clear:K()?V:function(){}};function W(U){for(var M=0;M<z.length;++M){var ye=z[M];ye.buffer===U&&(t.disableVertexAttribArray(M),ye.buffer=null)}}function K(){return o.oes_vertex_array_object}function A(){return o.angle_instanced_arrays}function G(U){return typeof U=="function"&&U._vao?U._vao:null}function Q(U){if(U!==ae.currentVAO){var M=K();U?M.bindVertexArrayOES(U.vao):M.bindVertexArrayOES(null),ae.currentVAO=U}}function pe(U){if(U!==ae.currentVAO){if(U)U.bindAttrs();else{for(var M=A(),ye=0;ye<z.length;++ye){var ie=z[ye];ie.buffer?(t.enableVertexAttribArray(ye),ie.buffer.bind(),t.vertexAttribPointer(ye,ie.size,ie.type,ie.normalized,ie.stride,ie.offfset),M&&ie.divisor&&M.vertexAttribDivisorANGLE(ye,ie.divisor)):(t.disableVertexAttribArray(ye),t.vertexAttrib4f(ye,ie.x,ie.y,ie.z,ie.w))}I.elements?t.bindBuffer(ca,I.elements.buffer.buffer):t.bindBuffer(ca,null)}ae.currentVAO=U}}function V(){sr(J).forEach(function(U){U.destroy()})}function he(){this.id=++$,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var U=K();U?this.vao=U.createVertexArrayOES():this.vao=null,J[this.id]=this,this.buffers=[]}he.prototype.bindAttrs=function(){for(var U=A(),M=this.attributes,ye=0;ye<M.length;++ye){var ie=M[ye];ie.buffer?(t.enableVertexAttribArray(ye),t.bindBuffer(po,ie.buffer.buffer),t.vertexAttribPointer(ye,ie.size,ie.type,ie.normalized,ie.stride,ie.offset),U&&ie.divisor&&U.vertexAttribDivisorANGLE(ye,ie.divisor)):(t.disableVertexAttribArray(ye),t.vertexAttrib4f(ye,ie.x,ie.y,ie.z,ie.w))}for(var Y=M.length;Y<X;++Y)t.disableVertexAttribArray(Y);var oe=k.getElements(this.elements);oe?t.bindBuffer(ca,oe.buffer.buffer):t.bindBuffer(ca,null)},he.prototype.refresh=function(){var U=K();U&&(U.bindVertexArrayOES(this.vao),this.bindAttrs(),ae.currentVAO=null,U.bindVertexArrayOES(null))},he.prototype.destroy=function(){if(this.vao){var U=K();this===ae.currentVAO&&(ae.currentVAO=null,U.bindVertexArrayOES(null)),U.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),J[this.id]&&(delete J[this.id],D.vaoCount-=1)};function le(){var U=K();U&&sr(J).forEach(function(M){M.refresh()})}function Fe(U){var M=new he;D.vaoCount+=1;function ye(ie){var Y;if(Array.isArray(ie))Y=ie,M.elements&&M.ownsElements&&M.elements.destroy(),M.elements=null,M.ownsElements=!1,M.offset=0,M.count=0,M.instances=-1,M.primitive=4;else{if(f(typeof ie=="object","invalid arguments for create vao"),f("attributes"in ie,"must specify attributes for vao"),ie.elements){var oe=ie.elements;M.ownsElements?typeof oe=="function"&&oe._reglType==="elements"?(M.elements.destroy(),M.ownsElements=!1):(M.elements(oe),M.ownsElements=!1):k.getElements(ie.elements)?(M.elements=ie.elements,M.ownsElements=!1):(M.elements=k.create(ie.elements),M.ownsElements=!0)}else M.elements=null,M.ownsElements=!1;Y=ie.attributes,M.offset=0,M.count=-1,M.instances=-1,M.primitive=4,M.elements&&(M.count=M.elements._elements.vertCount,M.primitive=M.elements._elements.primType),"offset"in ie&&(M.offset=ie.offset|0),"count"in ie&&(M.count=ie.count|0),"instances"in ie&&(M.instances=ie.instances|0),"primitive"in ie&&(f(ie.primitive in Nr,"bad primitive type: "+ie.primitive),M.primitive=Nr[ie.primitive]),f.optional(()=>{for(var Ot=Object.keys(ie),kt=0;kt<Ot.length;++kt)f(vo.indexOf(Ot[kt])>=0,'invalid option for vao: "'+Ot[kt]+'" valid options are '+vo)}),f(Array.isArray(Y),"attributes must be an array")}f(Y.length<X,"too many attributes"),f(Y.length>0,"must specify at least one attribute");var se={},Xe=M.attributes;Xe.length=Y.length;for(var Ve=0;Ve<Y.length;++Ve){var ce=Y[Ve],me=Xe[Ve]=new _i,Pe=ce.data||ce;if(Array.isArray(Pe)||n(Pe)||pr(Pe)){var He;M.buffers[Ve]&&(He=M.buffers[Ve],n(Pe)&&He._buffer.byteLength>=Pe.byteLength?He.subdata(Pe):(He.destroy(),M.buffers[Ve]=null)),M.buffers[Ve]||(He=M.buffers[Ve]=B.create(ce,po,!1,!0)),me.buffer=B.getBuffer(He),me.size=me.buffer.dimension|0,me.normalized=!1,me.type=me.buffer.dtype,me.offset=0,me.stride=0,me.divisor=0,me.state=1,se[Ve]=1}else B.getBuffer(ce)?(me.buffer=B.getBuffer(ce),me.size=me.buffer.dimension|0,me.normalized=!1,me.type=me.buffer.dtype,me.offset=0,me.stride=0,me.divisor=0,me.state=1):B.getBuffer(ce.buffer)?(me.buffer=B.getBuffer(ce.buffer),me.size=(+ce.size||me.buffer.dimension)|0,me.normalized=!!ce.normalized||!1,"type"in ce?(f.parameter(ce.type,Hr,"invalid buffer type"),me.type=Hr[ce.type]):me.type=me.buffer.dtype,me.offset=(ce.offset||0)|0,me.stride=(ce.stride||0)|0,me.divisor=(ce.divisor||0)|0,me.state=1,f(me.size>=1&&me.size<=4,"size must be between 1 and 4"),f(me.offset>=0,"invalid offset"),f(me.stride>=0&&me.stride<=255,"stride must be between 0 and 255"),f(me.divisor>=0,"divisor must be positive"),f(!me.divisor||!!o.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ce?(f(Ve>0,"first attribute must not be a constant"),me.x=+ce.x||0,me.y=+ce.y||0,me.z=+ce.z||0,me.w=+ce.w||0,me.state=2):f(!1,"invalid attribute spec for location "+Ve)}for(var tt=0;tt<M.buffers.length;++tt)!se[tt]&&M.buffers[tt]&&(M.buffers[tt].destroy(),M.buffers[tt]=null);return M.refresh(),ye}return ye.destroy=function(){for(var ie=0;ie<M.buffers.length;++ie)M.buffers[ie]&&M.buffers[ie].destroy();M.buffers.length=0,M.ownsElements&&(M.elements.destroy(),M.elements=null,M.ownsElements=!1),M.destroy()},ye._vao=M,ye._reglType="vao",ye(U)}return ae}var _o=35632,Ec=35633,Ac=35718,Tc=35721;function wc(t,o,h,D){var B={},k={};function I(A,G,Q,pe){this.name=A,this.id=G,this.location=Q,this.info=pe}function X(A,G){for(var Q=0;Q<A.length;++Q)if(A[Q].id===G.id){A[Q].location=G.location;return}A.push(G)}function z(A,G,Q){var pe=A===_o?B:k,V=pe[G];if(!V){var he=o.str(G);V=t.createShader(A),t.shaderSource(V,he),t.compileShader(V),f.shaderError(t,V,he,A,Q),pe[G]=V}return V}var Z={},$=[],J=0;function ae(A,G){this.id=J++,this.fragId=A,this.vertId=G,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,D.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function W(A,G,Q){var pe,V,he=z(_o,A.fragId),le=z(Ec,A.vertId),Fe=A.program=t.createProgram();if(t.attachShader(Fe,he),t.attachShader(Fe,le),Q)for(pe=0;pe<Q.length;++pe){var U=Q[pe];t.bindAttribLocation(Fe,U[0],U[1])}t.linkProgram(Fe),f.linkError(t,Fe,o.str(A.fragId),o.str(A.vertId),G);var M=t.getProgramParameter(Fe,Ac);D.profile&&(A.stats.uniformsCount=M);var ye=A.uniforms;for(pe=0;pe<M;++pe)if(V=t.getActiveUniform(Fe,pe),V)if(V.size>1)for(var ie=0;ie<V.size;++ie){var Y=V.name.replace("[0]","["+ie+"]");X(ye,new I(Y,o.id(Y),t.getUniformLocation(Fe,Y),V))}else X(ye,new I(V.name,o.id(V.name),t.getUniformLocation(Fe,V.name),V));var oe=t.getProgramParameter(Fe,Tc);D.profile&&(A.stats.attributesCount=oe);var se=A.attributes;for(pe=0;pe<oe;++pe)V=t.getActiveAttrib(Fe,pe),V&&X(se,new I(V.name,o.id(V.name),t.getAttribLocation(Fe,V.name),V))}D.profile&&(h.getMaxUniformsCount=function(){var A=0;return $.forEach(function(G){G.stats.uniformsCount>A&&(A=G.stats.uniformsCount)}),A},h.getMaxAttributesCount=function(){var A=0;return $.forEach(function(G){G.stats.attributesCount>A&&(A=G.stats.attributesCount)}),A});function K(){B={},k={};for(var A=0;A<$.length;++A)W($[A],null,$[A].attributes.map(function(G){return[G.location,G.name]}))}return{clear:function(){var A=t.deleteShader.bind(t);sr(B).forEach(A),B={},sr(k).forEach(A),k={},$.forEach(function(G){t.deleteProgram(G.program)}),$.length=0,Z={},h.shaderCount=0},program:function(A,G,Q,pe){f.command(A>=0,"missing vertex shader",Q),f.command(G>=0,"missing fragment shader",Q);var V=Z[G];V||(V=Z[G]={});var he=V[A];if(he&&(he.refCount++,!pe))return he;var le=new ae(G,A);return h.shaderCount++,W(le,Q,pe),he||(V[A]=le),$.push(le),a(le,{destroy:function(){if(le.refCount--,le.refCount<=0){t.deleteProgram(le.program);var Fe=$.indexOf(le);$.splice(Fe,1),h.shaderCount--}V[le.vertId].refCount<=0&&(t.deleteShader(k[le.vertId]),delete k[le.vertId],delete Z[le.fragId][le.vertId]),Object.keys(Z[le.fragId]).length||(t.deleteShader(B[le.fragId]),delete B[le.fragId],delete Z[le.fragId])}})},restore:K,shader:z,frag:-1,vert:-1}}var Sc=6408,On=5121,Rc=3333,da=5126;function Lc(t,o,h,D,B,k,I){function X($){var J;o.next===null?(f(B.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),J=On):(f(o.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),J=o.next.colorAttachments[0].texture._texture.type,f.optional(function(){k.oes_texture_float?(f(J===On||J===da,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),J===da&&f(I.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):f(J===On,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var ae=0,W=0,K=D.framebufferWidth,A=D.framebufferHeight,G=null;n($)?G=$:$&&(f.type($,"object","invalid arguments to regl.read()"),ae=$.x|0,W=$.y|0,f(ae>=0&&ae<D.framebufferWidth,"invalid x offset for regl.read"),f(W>=0&&W<D.framebufferHeight,"invalid y offset for regl.read"),K=($.width||D.framebufferWidth-ae)|0,A=($.height||D.framebufferHeight-W)|0,G=$.data||null),G&&(J===On?f(G instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):J===da&&f(G instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),f(K>0&&K+ae<=D.framebufferWidth,"invalid width for read pixels"),f(A>0&&A+W<=D.framebufferHeight,"invalid height for read pixels"),h();var Q=K*A*4;return G||(J===On?G=new Uint8Array(Q):J===da&&(G=G||new Float32Array(Q))),f.isTypedArray(G,"data buffer for regl.read() must be a typedarray"),f(G.byteLength>=Q,"data buffer for regl.read() too small"),t.pixelStorei(Rc,4),t.readPixels(ae,W,K,A,Sc,J,G),G}function z($){var J;return o.setFBO({framebuffer:$.framebuffer},function(){J=X($)}),J}function Z($){return!$||!("framebuffer"in $)?X($):z($)}return Z}function mn(t){return Array.prototype.slice.call(t)}function pn(t){return mn(t).join("")}function Cc(){var t=0,o=[],h=[];function D(J){for(var ae=0;ae<h.length;++ae)if(h[ae]===J)return o[ae];var W="g"+t++;return o.push(W),h.push(J),W}function B(){var J=[];function ae(){J.push.apply(J,mn(arguments))}var W=[];function K(){var A="v"+t++;return W.push(A),arguments.length>0&&(J.push(A,"="),J.push.apply(J,mn(arguments)),J.push(";")),A}return a(ae,{def:K,toString:function(){return pn([W.length>0?"var "+W.join(",")+";":"",pn(J)])}})}function k(){var J=B(),ae=B(),W=J.toString,K=ae.toString;function A(G,Q){ae(G,Q,"=",J.def(G,Q),";")}return a(function(){J.apply(J,mn(arguments))},{def:J.def,entry:J,exit:ae,save:A,set:function(G,Q,pe){A(G,Q),J(G,Q,"=",pe,";")},toString:function(){return W()+K()}})}function I(){var J=pn(arguments),ae=k(),W=k(),K=ae.toString,A=W.toString;return a(ae,{then:function(){return ae.apply(ae,mn(arguments)),this},else:function(){return W.apply(W,mn(arguments)),this},toString:function(){var G=A();return G&&(G="else{"+G+"}"),pn(["if(",J,"){",K(),"}",G])}})}var X=B(),z={};function Z(J,ae){var W=[];function K(){var V="a"+W.length;return W.push(V),V}ae=ae||0;for(var A=0;A<ae;++A)K();var G=k(),Q=G.toString,pe=z[J]=a(G,{arg:K,toString:function(){return pn(["function(",W.join(),"){",Q(),"}"])}});return pe}function $(){var J=['"use strict";',X,"return {"];Object.keys(z).forEach(function(K){J.push('"',K,'":',z[K].toString(),",")}),J.push("}");var ae=pn(J).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),W=Function.apply(null,o.concat(ae));return W.apply(null,h)}return{global:X,link:D,block:B,proc:Z,scope:k,cond:I,compile:$}}var vn="xyzw".split(""),bo=5121,_n=1,bi=2,yi=0,gi=1,xi=2,Ei=3,ha=4,yo=5,go=6,xo="dither",Eo="blend.enable",Ao="blend.color",Ai="blend.equation",Ti="blend.func",To="depth.enable",wo="depth.func",So="depth.range",Ro="depth.mask",wi="colorMask",Lo="cull.enable",Co="cull.face",Si="frontFace",Ri="lineWidth",Oo="polygonOffset.enable",Li="polygonOffset.offset",ko="sample.alpha",Do="sample.enable",Ci="sample.coverage",Fo="stencil.enable",Go="stencil.mask",Oi="stencil.func",ki="stencil.opFront",kn="stencil.opBack",No="scissor.enable",ma="scissor.box",Lr="viewport",Dn="profile",Qr="framebuffer",Fn="vert",Gn="frag",Kr="elements",Zr="primitive",Jr="count",pa="offset",va="instances",Nn="vao",Di="Width",Fi="Height",bn=Qr+Di,yn=Qr+Fi,Oc=Lr+Di,kc=Lr+Fi,Io="drawingBuffer",Mo=Io+Di,Bo=Io+Fi,Dc=[Ti,Ai,Oi,ki,kn,Ci,Lr,ma,Li],gn=34962,Gi=34963,Fc=35632,Gc=35633,Po=3553,Nc=34067,Ic=2884,Mc=3042,Bc=3024,Pc=2960,Uc=2929,jc=3089,Vc=32823,zc=32926,Hc=32928,Ni=5126,_a=35664,ba=35665,ya=35666,Ii=5124,ga=35667,xa=35668,Ea=35669,Mi=35670,Aa=35671,Ta=35672,wa=35673,In=35674,Mn=35675,Bn=35676,Pn=35678,Un=35680,Bi=4,jn=1028,$r=1029,Uo=2304,Pi=2305,Xc=32775,Wc=32776,qc=519,Mr=7680,jo=0,Vo=1,zo=32774,Yc=513,Ho=36160,Qc=36064,Ar={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Xo=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],xn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Br={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Wo={frag:Fc,vert:Gc},Ui={cw:Uo,ccw:Pi};function Sa(t){return Array.isArray(t)||n(t)||pr(t)}function qo(t){return t.sort(function(o,h){return o===Lr?-1:h===Lr?1:o<h?-1:1})}function Qt(t,o,h,D){this.thisDep=t,this.contextDep=o,this.propDep=h,this.append=D}function Pr(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function Ut(t){return new Qt(!1,!1,!1,t)}function ir(t,o){var h=t.type;if(h===yi){var D=t.data.length;return new Qt(!0,D>=1,D>=2,o)}else if(h===ha){var B=t.data;return new Qt(B.thisDep,B.contextDep,B.propDep,o)}else{if(h===yo)return new Qt(!1,!1,!1,o);if(h===go){for(var k=!1,I=!1,X=!1,z=0;z<t.data.length;++z){var Z=t.data[z];if(Z.type===gi)X=!0;else if(Z.type===xi)I=!0;else if(Z.type===Ei)k=!0;else if(Z.type===yi){k=!0;var $=Z.data;$>=1&&(I=!0),$>=2&&(X=!0)}else Z.type===ha&&(k=k||Z.data.thisDep,I=I||Z.data.contextDep,X=X||Z.data.propDep)}return new Qt(k,I,X,o)}else return new Qt(h===Ei,h===xi,h===gi,o)}}var Yo=new Qt(!1,!1,!1,function(){});function Kc(t,o,h,D,B,k,I,X,z,Z,$,J,ae,W,K){var A=Z.Record,G={add:32774,subtract:32778,"reverse subtract":32779};h.ext_blend_minmax&&(G.min=Xc,G.max=Wc);var Q=h.angle_instanced_arrays,pe=h.webgl_draw_buffers,V=h.oes_vertex_array_object,he={dirty:!0,profile:K.profile},le={},Fe=[],U={},M={};function ye(u){return u.replace(".","_")}function ie(u,i,v){var E=ye(u);Fe.push(u),le[E]=he[E]=!!v,U[E]=i}function Y(u,i,v){var E=ye(u);Fe.push(u),Array.isArray(v)?(he[E]=v.slice(),le[E]=v.slice()):he[E]=le[E]=v,M[E]=i}ie(xo,Bc),ie(Eo,Mc),Y(Ao,"blendColor",[0,0,0,0]),Y(Ai,"blendEquationSeparate",[zo,zo]),Y(Ti,"blendFuncSeparate",[Vo,jo,Vo,jo]),ie(To,Uc,!0),Y(wo,"depthFunc",Yc),Y(So,"depthRange",[0,1]),Y(Ro,"depthMask",!0),Y(wi,wi,[!0,!0,!0,!0]),ie(Lo,Ic),Y(Co,"cullFace",$r),Y(Si,Si,Pi),Y(Ri,Ri,1),ie(Oo,Vc),Y(Li,"polygonOffset",[0,0]),ie(ko,zc),ie(Do,Hc),Y(Ci,"sampleCoverage",[1,!1]),ie(Fo,Pc),Y(Go,"stencilMask",-1),Y(Oi,"stencilFunc",[qc,0,-1]),Y(ki,"stencilOpSeparate",[jn,Mr,Mr,Mr]),Y(kn,"stencilOpSeparate",[$r,Mr,Mr,Mr]),ie(No,jc),Y(ma,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),Y(Lr,Lr,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var oe={gl:t,context:ae,strings:o,next:le,current:he,draw:J,elements:k,buffer:B,shader:$,attributes:Z.state,vao:Z,uniforms:z,framebuffer:X,extensions:h,timer:W,isBufferArgs:Sa},se={primTypes:Nr,compareFuncs:xn,blendFuncs:Ar,blendEquations:G,stencilOps:Br,glTypes:Hr,orientationType:Ui};f.optional(function(){oe.isArrayLike=Gt}),pe&&(se.backBuffer=[$r],se.drawBuffer=or(D.maxDrawbuffers,function(u){return u===0?[0]:or(u,function(i){return Qc+i})}));var Xe=0;function Ve(){var u=Cc(),i=u.link,v=u.global;u.id=Xe++,u.batchId="0";var E=i(oe),S=u.shared={props:"a0"};Object.keys(oe).forEach(function(p){S[p]=v.def(E,".",p)}),f.optional(function(){u.CHECK=i(f),u.commandStr=f.guessCommand(),u.command=i(u.commandStr),u.assert=function(p,l,w){p("if(!(",l,"))",this.CHECK,".commandRaise(",i(w),",",this.command,");")},se.invalidBlendCombinations=Xo});var b=u.next={},_=u.current={};Object.keys(M).forEach(function(p){Array.isArray(he[p])&&(b[p]=v.def(S.next,".",p),_[p]=v.def(S.current,".",p))});var g=u.constants={};Object.keys(se).forEach(function(p){g[p]=v.def(JSON.stringify(se[p]))}),u.invoke=function(p,l){switch(l.type){case yi:var w=["this",S.context,S.props,u.batchId];return p.def(i(l.data),".call(",w.slice(0,Math.max(l.data.length+1,4)),")");case gi:return p.def(S.props,l.data);case xi:return p.def(S.context,l.data);case Ei:return p.def("this",l.data);case ha:return l.data.append(u,p),l.data.ref;case yo:return l.data.toString();case go:return l.data.map(function(R){return u.invoke(p,R)})}},u.attribCache={};var s={};return u.scopeAttrib=function(p){var l=o.id(p);if(l in s)return s[l];var w=Z.scope[l];w||(w=Z.scope[l]=new A);var R=s[l]=i(w);return R},u}function ce(u){var i=u.static,v=u.dynamic,E;if(Dn in i){var S=!!i[Dn];E=Ut(function(_,g){return S}),E.enable=S}else if(Dn in v){var b=v[Dn];E=ir(b,function(_,g){return _.invoke(g,b)})}return E}function me(u,i){var v=u.static,E=u.dynamic;if(Qr in v){var S=v[Qr];return S?(S=X.getFramebuffer(S),f.command(S,"invalid framebuffer object"),Ut(function(_,g){var s=_.link(S),p=_.shared;g.set(p.framebuffer,".next",s);var l=p.context;return g.set(l,"."+bn,s+".width"),g.set(l,"."+yn,s+".height"),s})):Ut(function(_,g){var s=_.shared;g.set(s.framebuffer,".next","null");var p=s.context;return g.set(p,"."+bn,p+"."+Mo),g.set(p,"."+yn,p+"."+Bo),"null"})}else if(Qr in E){var b=E[Qr];return ir(b,function(_,g){var s=_.invoke(g,b),p=_.shared,l=p.framebuffer,w=g.def(l,".getFramebuffer(",s,")");f.optional(function(){_.assert(g,"!"+s+"||"+w,"invalid framebuffer object")}),g.set(l,".next",w);var R=p.context;return g.set(R,"."+bn,w+"?"+w+".width:"+R+"."+Mo),g.set(R,"."+yn,w+"?"+w+".height:"+R+"."+Bo),w})}else return null}function Pe(u,i,v){var E=u.static,S=u.dynamic;function b(s){if(s in E){var p=E[s];f.commandType(p,"object","invalid "+s,v.commandStr);var l=!0,w=p.x|0,R=p.y|0,j,re;return"width"in p?(j=p.width|0,f.command(j>=0,"invalid "+s,v.commandStr)):l=!1,"height"in p?(re=p.height|0,f.command(re>=0,"invalid "+s,v.commandStr)):l=!1,new Qt(!l&&i&&i.thisDep,!l&&i&&i.contextDep,!l&&i&&i.propDep,function(te,Ee){var _e=te.shared.context,ge=j;"width"in p||(ge=Ee.def(_e,".",bn,"-",w));var xe=re;return"height"in p||(xe=Ee.def(_e,".",yn,"-",R)),[w,R,ge,xe]})}else if(s in S){var ne=S[s],de=ir(ne,function(te,Ee){var _e=te.invoke(Ee,ne);f.optional(function(){te.assert(Ee,_e+"&&typeof "+_e+'==="object"',"invalid "+s)});var ge=te.shared.context,xe=Ee.def(_e,".x|0"),Ae=Ee.def(_e,".y|0"),Ue=Ee.def('"width" in ',_e,"?",_e,".width|0:","(",ge,".",bn,"-",xe,")"),wt=Ee.def('"height" in ',_e,"?",_e,".height|0:","(",ge,".",yn,"-",Ae,")");return f.optional(function(){te.assert(Ee,Ue+">=0&&"+wt+">=0","invalid "+s)}),[xe,Ae,Ue,wt]});return i&&(de.thisDep=de.thisDep||i.thisDep,de.contextDep=de.contextDep||i.contextDep,de.propDep=de.propDep||i.propDep),de}else return i?new Qt(i.thisDep,i.contextDep,i.propDep,function(te,Ee){var _e=te.shared.context;return[0,0,Ee.def(_e,".",bn),Ee.def(_e,".",yn)]}):null}var _=b(Lr);if(_){var g=_;_=new Qt(_.thisDep,_.contextDep,_.propDep,function(s,p){var l=g.append(s,p),w=s.shared.context;return p.set(w,"."+Oc,l[2]),p.set(w,"."+kc,l[3]),l})}return{viewport:_,scissor_box:b(ma)}}function He(u,i){var v=u.static,E=typeof v[Gn]=="string"&&typeof v[Fn]=="string";if(E){if(Object.keys(i.dynamic).length>0)return null;var S=i.static,b=Object.keys(S);if(b.length>0&&typeof S[b[0]]=="number"){for(var _=[],g=0;g<b.length;++g)f(typeof S[b[g]]=="number","must specify all vertex attribute locations when using vaos"),_.push([S[b[g]]|0,b[g]]);return _}}return null}function tt(u,i,v){var E=u.static,S=u.dynamic;function b(l){if(l in E){var w=o.id(E[l]);f.optional(function(){$.shader(Wo[l],w,f.guessCommand())});var R=Ut(function(){return w});return R.id=w,R}else if(l in S){var j=S[l];return ir(j,function(re,ne){var de=re.invoke(ne,j),te=ne.def(re.shared.strings,".id(",de,")");return f.optional(function(){ne(re.shared.shader,".shader(",Wo[l],",",te,",",re.command,");")}),te})}return null}var _=b(Gn),g=b(Fn),s=null,p;return Pr(_)&&Pr(g)?(s=$.program(g.id,_.id,null,v),p=Ut(function(l,w){return l.link(s)})):p=new Qt(_&&_.thisDep||g&&g.thisDep,_&&_.contextDep||g&&g.contextDep,_&&_.propDep||g&&g.propDep,function(l,w){var R=l.shared.shader,j;_?j=_.append(l,w):j=w.def(R,".",Gn);var re;g?re=g.append(l,w):re=w.def(R,".",Fn);var ne=R+".program("+re+","+j;return f.optional(function(){ne+=","+l.command}),w.def(ne+")")}),{frag:_,vert:g,progVar:p,program:s}}function Ot(u,i){var v=u.static,E=u.dynamic,S={},b=!1;function _(){if(Nn in v){var Ee=v[Nn];return Ee!==null&&Z.getVAO(Ee)===null&&(Ee=Z.createVAO(Ee)),b=!0,S.vao=Ee,Ut(function(ge){var xe=Z.getVAO(Ee);return xe?ge.link(xe):"null"})}else if(Nn in E){b=!0;var _e=E[Nn];return ir(_e,function(ge,xe){var Ae=ge.invoke(xe,_e);return xe.def(ge.shared.vao+".getVAO("+Ae+")")})}return null}var g=_(),s=!1;function p(){if(Kr in v){var Ee=v[Kr];if(S.elements=Ee,Sa(Ee)){var _e=S.elements=k.create(Ee,!0);Ee=k.getElements(_e),s=!0}else Ee&&(Ee=k.getElements(Ee),s=!0,f.command(Ee,"invalid elements",i.commandStr));var ge=Ut(function(Ae,Ue){if(Ee){var wt=Ae.link(Ee);return Ae.ELEMENTS=wt,wt}return Ae.ELEMENTS=null,null});return ge.value=Ee,ge}else if(Kr in E){s=!0;var xe=E[Kr];return ir(xe,function(Ae,Ue){var wt=Ae.shared,Zt=wt.isBufferArgs,Cr=wt.elements,Or=Ae.invoke(Ue,xe),kr=Ue.def("null"),rr=Ue.def(Zt,"(",Or,")"),wr=Ae.cond(rr).then(kr,"=",Cr,".createStream(",Or,");").else(kr,"=",Cr,".getElements(",Or,");");return f.optional(function(){Ae.assert(wr.else,"!"+Or+"||"+kr,"invalid elements")}),Ue.entry(wr),Ue.exit(Ae.cond(rr).then(Cr,".destroyStream(",kr,");")),Ae.ELEMENTS=kr,kr})}else if(b)return new Qt(g.thisDep,g.contextDep,g.propDep,function(Ae,Ue){return Ue.def(Ae.shared.vao+".currentVAO?"+Ae.shared.elements+".getElements("+Ae.shared.vao+".currentVAO.elements):null")});return null}var l=p();function w(){if(Zr in v){var Ee=v[Zr];return S.primitive=Ee,f.commandParameter(Ee,Nr,"invalid primitve",i.commandStr),Ut(function(ge,xe){return Nr[Ee]})}else if(Zr in E){var _e=E[Zr];return ir(_e,function(ge,xe){var Ae=ge.constants.primTypes,Ue=ge.invoke(xe,_e);return f.optional(function(){ge.assert(xe,Ue+" in "+Ae,"invalid primitive, must be one of "+Object.keys(Nr))}),xe.def(Ae,"[",Ue,"]")})}else{if(s)return Pr(l)?l.value?Ut(function(ge,xe){return xe.def(ge.ELEMENTS,".primType")}):Ut(function(){return Bi}):new Qt(l.thisDep,l.contextDep,l.propDep,function(ge,xe){var Ae=ge.ELEMENTS;return xe.def(Ae,"?",Ae,".primType:",Bi)});if(b)return new Qt(g.thisDep,g.contextDep,g.propDep,function(ge,xe){return xe.def(ge.shared.vao+".currentVAO?"+ge.shared.vao+".currentVAO.primitive:"+Bi)})}return null}function R(Ee,_e){if(Ee in v){var ge=v[Ee]|0;return _e?S.offset=ge:S.instances=ge,f.command(!_e||ge>=0,"invalid "+Ee,i.commandStr),Ut(function(Ae,Ue){return _e&&(Ae.OFFSET=ge),ge})}else if(Ee in E){var xe=E[Ee];return ir(xe,function(Ae,Ue){var wt=Ae.invoke(Ue,xe);return _e&&(Ae.OFFSET=wt,f.optional(function(){Ae.assert(Ue,wt+">=0","invalid "+Ee)})),wt})}else if(_e){if(s)return Ut(function(Ae,Ue){return Ae.OFFSET=0,0});if(b)return new Qt(g.thisDep,g.contextDep,g.propDep,function(Ae,Ue){return Ue.def(Ae.shared.vao+".currentVAO?"+Ae.shared.vao+".currentVAO.offset:0")})}else if(b)return new Qt(g.thisDep,g.contextDep,g.propDep,function(Ae,Ue){return Ue.def(Ae.shared.vao+".currentVAO?"+Ae.shared.vao+".currentVAO.instances:-1")});return null}var j=R(pa,!0);function re(){if(Jr in v){var Ee=v[Jr]|0;return S.count=Ee,f.command(typeof Ee=="number"&&Ee>=0,"invalid vertex count",i.commandStr),Ut(function(){return Ee})}else if(Jr in E){var _e=E[Jr];return ir(_e,function(Ue,wt){var Zt=Ue.invoke(wt,_e);return f.optional(function(){Ue.assert(wt,"typeof "+Zt+'==="number"&&'+Zt+">=0&&"+Zt+"===("+Zt+"|0)","invalid vertex count")}),Zt})}else if(s)if(Pr(l)){if(l)return j?new Qt(j.thisDep,j.contextDep,j.propDep,function(Ue,wt){var Zt=wt.def(Ue.ELEMENTS,".vertCount-",Ue.OFFSET);return f.optional(function(){Ue.assert(wt,Zt+">=0","invalid vertex offset/element buffer too small")}),Zt}):Ut(function(Ue,wt){return wt.def(Ue.ELEMENTS,".vertCount")});var ge=Ut(function(){return-1});return f.optional(function(){ge.MISSING=!0}),ge}else{var xe=new Qt(l.thisDep||j.thisDep,l.contextDep||j.contextDep,l.propDep||j.propDep,function(Ue,wt){var Zt=Ue.ELEMENTS;return Ue.OFFSET?wt.def(Zt,"?",Zt,".vertCount-",Ue.OFFSET,":-1"):wt.def(Zt,"?",Zt,".vertCount:-1")});return f.optional(function(){xe.DYNAMIC=!0}),xe}else if(b){var Ae=new Qt(g.thisDep,g.contextDep,g.propDep,function(Ue,wt){return wt.def(Ue.shared.vao,".currentVAO?",Ue.shared.vao,".currentVAO.count:-1")});return Ae}return null}var ne=w(),de=re(),te=R(va,!1);return{elements:l,primitive:ne,count:de,instances:te,offset:j,vao:g,vaoActive:b,elementsActive:s,static:S}}function kt(u,i){var v=u.static,E=u.dynamic,S={};return Fe.forEach(function(b){var _=ye(b);function g(s,p){if(b in v){var l=s(v[b]);S[_]=Ut(function(){return l})}else if(b in E){var w=E[b];S[_]=ir(w,function(R,j){return p(R,j,R.invoke(j,w))})}}switch(b){case Lo:case Eo:case xo:case Fo:case To:case No:case Oo:case ko:case Do:case Ro:return g(function(s){return f.commandType(s,"boolean",b,i.commandStr),s},function(s,p,l){return f.optional(function(){s.assert(p,"typeof "+l+'==="boolean"',"invalid flag "+b,s.commandStr)}),l});case wo:return g(function(s){return f.commandParameter(s,xn,"invalid "+b,i.commandStr),xn[s]},function(s,p,l){var w=s.constants.compareFuncs;return f.optional(function(){s.assert(p,l+" in "+w,"invalid "+b+", must be one of "+Object.keys(xn))}),p.def(w,"[",l,"]")});case So:return g(function(s){return f.command(Gt(s)&&s.length===2&&typeof s[0]=="number"&&typeof s[1]=="number"&&s[0]<=s[1],"depth range is 2d array",i.commandStr),s},function(s,p,l){f.optional(function(){s.assert(p,s.shared.isArrayLike+"("+l+")&&"+l+".length===2&&typeof "+l+'[0]==="number"&&typeof '+l+'[1]==="number"&&'+l+"[0]<="+l+"[1]","depth range must be a 2d array")});var w=p.def("+",l,"[0]"),R=p.def("+",l,"[1]");return[w,R]});case Ti:return g(function(s){f.commandType(s,"object","blend.func",i.commandStr);var p="srcRGB"in s?s.srcRGB:s.src,l="srcAlpha"in s?s.srcAlpha:s.src,w="dstRGB"in s?s.dstRGB:s.dst,R="dstAlpha"in s?s.dstAlpha:s.dst;return f.commandParameter(p,Ar,_+".srcRGB",i.commandStr),f.commandParameter(l,Ar,_+".srcAlpha",i.commandStr),f.commandParameter(w,Ar,_+".dstRGB",i.commandStr),f.commandParameter(R,Ar,_+".dstAlpha",i.commandStr),f.command(Xo.indexOf(p+", "+w)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+p+", "+w+")",i.commandStr),[Ar[p],Ar[w],Ar[l],Ar[R]]},function(s,p,l){var w=s.constants.blendFuncs;f.optional(function(){s.assert(p,l+"&&typeof "+l+'==="object"',"invalid blend func, must be an object")});function R(_e,ge){var xe=p.def('"',_e,ge,'" in ',l,"?",l,".",_e,ge,":",l,".",_e);return f.optional(function(){s.assert(p,xe+" in "+w,"invalid "+b+"."+_e+ge+", must be one of "+Object.keys(Ar))}),xe}var j=R("src","RGB"),re=R("dst","RGB");f.optional(function(){var _e=s.constants.invalidBlendCombinations;s.assert(p,_e+".indexOf("+j+'+", "+'+re+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ne=p.def(w,"[",j,"]"),de=p.def(w,"[",R("src","Alpha"),"]"),te=p.def(w,"[",re,"]"),Ee=p.def(w,"[",R("dst","Alpha"),"]");return[ne,te,de,Ee]});case Ai:return g(function(s){if(typeof s=="string")return f.commandParameter(s,G,"invalid "+b,i.commandStr),[G[s],G[s]];if(typeof s=="object")return f.commandParameter(s.rgb,G,b+".rgb",i.commandStr),f.commandParameter(s.alpha,G,b+".alpha",i.commandStr),[G[s.rgb],G[s.alpha]];f.commandRaise("invalid blend.equation",i.commandStr)},function(s,p,l){var w=s.constants.blendEquations,R=p.def(),j=p.def(),re=s.cond("typeof ",l,'==="string"');return f.optional(function(){function ne(de,te,Ee){s.assert(de,Ee+" in "+w,"invalid "+te+", must be one of "+Object.keys(G))}ne(re.then,b,l),s.assert(re.else,l+"&&typeof "+l+'==="object"',"invalid "+b),ne(re.else,b+".rgb",l+".rgb"),ne(re.else,b+".alpha",l+".alpha")}),re.then(R,"=",j,"=",w,"[",l,"];"),re.else(R,"=",w,"[",l,".rgb];",j,"=",w,"[",l,".alpha];"),p(re),[R,j]});case Ao:return g(function(s){return f.command(Gt(s)&&s.length===4,"blend.color must be a 4d array",i.commandStr),or(4,function(p){return+s[p]})},function(s,p,l){return f.optional(function(){s.assert(p,s.shared.isArrayLike+"("+l+")&&"+l+".length===4","blend.color must be a 4d array")}),or(4,function(w){return p.def("+",l,"[",w,"]")})});case Go:return g(function(s){return f.commandType(s,"number",_,i.commandStr),s|0},function(s,p,l){return f.optional(function(){s.assert(p,"typeof "+l+'==="number"',"invalid stencil.mask")}),p.def(l,"|0")});case Oi:return g(function(s){f.commandType(s,"object",_,i.commandStr);var p=s.cmp||"keep",l=s.ref||0,w="mask"in s?s.mask:-1;return f.commandParameter(p,xn,b+".cmp",i.commandStr),f.commandType(l,"number",b+".ref",i.commandStr),f.commandType(w,"number",b+".mask",i.commandStr),[xn[p],l,w]},function(s,p,l){var w=s.constants.compareFuncs;f.optional(function(){function ne(){s.assert(p,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ne(l+"&&typeof ",l,'==="object"'),ne('!("cmp" in ',l,")||(",l,".cmp in ",w,")")});var R=p.def('"cmp" in ',l,"?",w,"[",l,".cmp]",":",Mr),j=p.def(l,".ref|0"),re=p.def('"mask" in ',l,"?",l,".mask|0:-1");return[R,j,re]});case ki:case kn:return g(function(s){f.commandType(s,"object",_,i.commandStr);var p=s.fail||"keep",l=s.zfail||"keep",w=s.zpass||"keep";return f.commandParameter(p,Br,b+".fail",i.commandStr),f.commandParameter(l,Br,b+".zfail",i.commandStr),f.commandParameter(w,Br,b+".zpass",i.commandStr),[b===kn?$r:jn,Br[p],Br[l],Br[w]]},function(s,p,l){var w=s.constants.stencilOps;f.optional(function(){s.assert(p,l+"&&typeof "+l+'==="object"',"invalid "+b)});function R(j){return f.optional(function(){s.assert(p,'!("'+j+'" in '+l+")||("+l+"."+j+" in "+w+")","invalid "+b+"."+j+", must be one of "+Object.keys(Br))}),p.def('"',j,'" in ',l,"?",w,"[",l,".",j,"]:",Mr)}return[b===kn?$r:jn,R("fail"),R("zfail"),R("zpass")]});case Li:return g(function(s){f.commandType(s,"object",_,i.commandStr);var p=s.factor|0,l=s.units|0;return f.commandType(p,"number",_+".factor",i.commandStr),f.commandType(l,"number",_+".units",i.commandStr),[p,l]},function(s,p,l){f.optional(function(){s.assert(p,l+"&&typeof "+l+'==="object"',"invalid "+b)});var w=p.def(l,".factor|0"),R=p.def(l,".units|0");return[w,R]});case Co:return g(function(s){var p=0;return s==="front"?p=jn:s==="back"&&(p=$r),f.command(!!p,_,i.commandStr),p},function(s,p,l){return f.optional(function(){s.assert(p,l+'==="front"||'+l+'==="back"',"invalid cull.face")}),p.def(l,'==="front"?',jn,":",$r)});case Ri:return g(function(s){return f.command(typeof s=="number"&&s>=D.lineWidthDims[0]&&s<=D.lineWidthDims[1],"invalid line width, must be a positive number between "+D.lineWidthDims[0]+" and "+D.lineWidthDims[1],i.commandStr),s},function(s,p,l){return f.optional(function(){s.assert(p,"typeof "+l+'==="number"&&'+l+">="+D.lineWidthDims[0]+"&&"+l+"<="+D.lineWidthDims[1],"invalid line width")}),l});case Si:return g(function(s){return f.commandParameter(s,Ui,_,i.commandStr),Ui[s]},function(s,p,l){return f.optional(function(){s.assert(p,l+'==="cw"||'+l+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),p.def(l+'==="cw"?'+Uo+":"+Pi)});case wi:return g(function(s){return f.command(Gt(s)&&s.length===4,"color.mask must be length 4 array",i.commandStr),s.map(function(p){return!!p})},function(s,p,l){return f.optional(function(){s.assert(p,s.shared.isArrayLike+"("+l+")&&"+l+".length===4","invalid color.mask")}),or(4,function(w){return"!!"+l+"["+w+"]"})});case Ci:return g(function(s){f.command(typeof s=="object"&&s,_,i.commandStr);var p="value"in s?s.value:1,l=!!s.invert;return f.command(typeof p=="number"&&p>=0&&p<=1,"sample.coverage.value must be a number between 0 and 1",i.commandStr),[p,l]},function(s,p,l){f.optional(function(){s.assert(p,l+"&&typeof "+l+'==="object"',"invalid sample.coverage")});var w=p.def('"value" in ',l,"?+",l,".value:1"),R=p.def("!!",l,".invert");return[w,R]})}}),S}function it(u,i){var v=u.static,E=u.dynamic,S={};return Object.keys(v).forEach(function(b){var _=v[b],g;if(typeof _=="number"||typeof _=="boolean")g=Ut(function(){return _});else if(typeof _=="function"){var s=_._reglType;s==="texture2d"||s==="textureCube"?g=Ut(function(p){return p.link(_)}):s==="framebuffer"||s==="framebufferCube"?(f.command(_.color.length>0,'missing color attachment for framebuffer sent to uniform "'+b+'"',i.commandStr),g=Ut(function(p){return p.link(_.color[0])})):f.commandRaise('invalid data for uniform "'+b+'"',i.commandStr)}else Gt(_)?g=Ut(function(p){var l=p.global.def("[",or(_.length,function(w){return f.command(typeof _[w]=="number"||typeof _[w]=="boolean","invalid uniform "+b,p.commandStr),_[w]}),"]");return l}):f.commandRaise('invalid or missing data for uniform "'+b+'"',i.commandStr);g.value=_,S[b]=g}),Object.keys(E).forEach(function(b){var _=E[b];S[b]=ir(_,function(g,s){return g.invoke(s,_)})}),S}function Ht(u,i){var v=u.static,E=u.dynamic,S={};return Object.keys(v).forEach(function(b){var _=v[b],g=o.id(b),s=new A;if(Sa(_))s.state=_n,s.buffer=B.getBuffer(B.create(_,gn,!1,!0)),s.type=0;else{var p=B.getBuffer(_);if(p)s.state=_n,s.buffer=p,s.type=0;else if(f.command(typeof _=="object"&&_,"invalid data for attribute "+b,i.commandStr),"constant"in _){var l=_.constant;s.buffer="null",s.state=bi,typeof l=="number"?s.x=l:(f.command(Gt(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+b,i.commandStr),vn.forEach(function(te,Ee){Ee<l.length&&(s[te]=l[Ee])}))}else{Sa(_.buffer)?p=B.getBuffer(B.create(_.buffer,gn,!1,!0)):p=B.getBuffer(_.buffer),f.command(!!p,'missing buffer for attribute "'+b+'"',i.commandStr);var w=_.offset|0;f.command(w>=0,'invalid offset for attribute "'+b+'"',i.commandStr);var R=_.stride|0;f.command(R>=0&&R<256,'invalid stride for attribute "'+b+'", must be integer betweeen [0, 255]',i.commandStr);var j=_.size|0;f.command(!("size"in _)||j>0&&j<=4,'invalid size for attribute "'+b+'", must be 1,2,3,4',i.commandStr);var re=!!_.normalized,ne=0;"type"in _&&(f.commandParameter(_.type,Hr,"invalid type for attribute "+b,i.commandStr),ne=Hr[_.type]);var de=_.divisor|0;f.optional(function(){"divisor"in _&&(f.command(de===0||Q,'cannot specify divisor for attribute "'+b+'", instancing not supported',i.commandStr),f.command(de>=0,'invalid divisor for attribute "'+b+'"',i.commandStr));var te=i.commandStr,Ee=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(_).forEach(function(_e){f.command(Ee.indexOf(_e)>=0,'unknown parameter "'+_e+'" for attribute pointer "'+b+'" (valid parameters are '+Ee+")",te)})}),s.buffer=p,s.state=_n,s.size=j,s.normalized=re,s.type=ne||p.dtype,s.offset=w,s.stride=R,s.divisor=de}}S[b]=Ut(function(te,Ee){var _e=te.attribCache;if(g in _e)return _e[g];var ge={isStream:!1};return Object.keys(s).forEach(function(xe){ge[xe]=s[xe]}),s.buffer&&(ge.buffer=te.link(s.buffer),ge.type=ge.type||ge.buffer+".dtype"),_e[g]=ge,ge})}),Object.keys(E).forEach(function(b){var _=E[b];function g(s,p){var l=s.invoke(p,_),w=s.shared,R=s.constants,j=w.isBufferArgs,re=w.buffer;f.optional(function(){s.assert(p,l+"&&(typeof "+l+'==="object"||typeof '+l+'==="function")&&('+j+"("+l+")||"+re+".getBuffer("+l+")||"+re+".getBuffer("+l+".buffer)||"+j+"("+l+'.buffer)||("constant" in '+l+"&&(typeof "+l+'.constant==="number"||'+w.isArrayLike+"("+l+".constant))))",'invalid dynamic attribute "'+b+'"')});var ne={isStream:p.def(!1)},de=new A;de.state=_n,Object.keys(de).forEach(function(ge){ne[ge]=p.def(""+de[ge])});var te=ne.buffer,Ee=ne.type;p("if(",j,"(",l,")){",ne.isStream,"=true;",te,"=",re,".createStream(",gn,",",l,");",Ee,"=",te,".dtype;","}else{",te,"=",re,".getBuffer(",l,");","if(",te,"){",Ee,"=",te,".dtype;",'}else if("constant" in ',l,"){",ne.state,"=",bi,";","if(typeof "+l+'.constant === "number"){',ne[vn[0]],"=",l,".constant;",vn.slice(1).map(function(ge){return ne[ge]}).join("="),"=0;","}else{",vn.map(function(ge,xe){return ne[ge]+"="+l+".constant.length>"+xe+"?"+l+".constant["+xe+"]:0;"}).join(""),"}}else{","if(",j,"(",l,".buffer)){",te,"=",re,".createStream(",gn,",",l,".buffer);","}else{",te,"=",re,".getBuffer(",l,".buffer);","}",Ee,'="type" in ',l,"?",R.glTypes,"[",l,".type]:",te,".dtype;",ne.normalized,"=!!",l,".normalized;");function _e(ge){p(ne[ge],"=",l,".",ge,"|0;")}return _e("size"),_e("offset"),_e("stride"),_e("divisor"),p("}}"),p.exit("if(",ne.isStream,"){",re,".destroyStream(",te,");","}"),ne}S[b]=ir(_,g)}),S}function Rt(u){var i=u.static,v=u.dynamic,E={};return Object.keys(i).forEach(function(S){var b=i[S];E[S]=Ut(function(_,g){return typeof b=="number"||typeof b=="boolean"?""+b:_.link(b)})}),Object.keys(v).forEach(function(S){var b=v[S];E[S]=ir(b,function(_,g){return _.invoke(g,b)})}),E}function jt(u,i,v,E,S){var b=u.static,_=u.dynamic;f.optional(function(){var _e=[Qr,Fn,Gn,Kr,Zr,pa,Jr,va,Dn,Nn].concat(Fe);function ge(xe){Object.keys(xe).forEach(function(Ae){f.command(_e.indexOf(Ae)>=0,'unknown parameter "'+Ae+'"',S.commandStr)})}ge(b),ge(_)});var g=He(u,i),s=me(u),p=Pe(u,s,S),l=Ot(u,S),w=kt(u,S),R=tt(u,S,g);function j(_e){var ge=p[_e];ge&&(w[_e]=ge)}j(Lr),j(ye(ma));var re=Object.keys(w).length>0,ne={framebuffer:s,draw:l,shader:R,state:w,dirty:re,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ne.profile=ce(u),ne.uniforms=it(v,S),ne.drawVAO=ne.scopeVAO=l.vao,!ne.drawVAO&&R.program&&!g&&h.angle_instanced_arrays&&l.static.elements){var de=!0,te=R.program.attributes.map(function(_e){var ge=i.static[_e];return de=de&&!!ge,ge});if(de&&te.length>0){var Ee=Z.getVAO(Z.createVAO({attributes:te,elements:l.static.elements}));ne.drawVAO=new Qt(null,null,null,function(_e,ge){return _e.link(Ee)}),ne.useVAO=!0}}return g?ne.useVAO=!0:ne.attributes=Ht(i,S),ne.context=Rt(E),ne}function Xt(u,i,v){var E=u.shared,S=E.context,b=u.scope();Object.keys(v).forEach(function(_){i.save(S,"."+_);var g=v[_],s=g.append(u,i);Array.isArray(s)?b(S,".",_,"=[",s.join(),"];"):b(S,".",_,"=",s,";")}),i(b)}function Wt(u,i,v,E){var S=u.shared,b=S.gl,_=S.framebuffer,g;pe&&(g=i.def(S.extensions,".webgl_draw_buffers"));var s=u.constants,p=s.drawBuffer,l=s.backBuffer,w;v?w=v.append(u,i):w=i.def(_,".next"),E||i("if(",w,"!==",_,".cur){"),i("if(",w,"){",b,".bindFramebuffer(",Ho,",",w,".framebuffer);"),pe&&i(g,".drawBuffersWEBGL(",p,"[",w,".colorAttachments.length]);"),i("}else{",b,".bindFramebuffer(",Ho,",null);"),pe&&i(g,".drawBuffersWEBGL(",l,");"),i("}",_,".cur=",w,";"),E||i("}")}function Kt(u,i,v){var E=u.shared,S=E.gl,b=u.current,_=u.next,g=E.current,s=E.next,p=u.cond(g,".dirty");Fe.forEach(function(l){var w=ye(l);if(!(w in v.state)){var R,j;if(w in _){R=_[w],j=b[w];var re=or(he[w].length,function(de){return p.def(R,"[",de,"]")});p(u.cond(re.map(function(de,te){return de+"!=="+j+"["+te+"]"}).join("||")).then(S,".",M[w],"(",re,");",re.map(function(de,te){return j+"["+te+"]="+de}).join(";"),";"))}else{R=p.def(s,".",w);var ne=u.cond(R,"!==",g,".",w);p(ne),w in U?ne(u.cond(R).then(S,".enable(",U[w],");").else(S,".disable(",U[w],");"),g,".",w,"=",R,";"):ne(S,".",M[w],"(",R,");",g,".",w,"=",R,";")}}}),Object.keys(v.state).length===0&&p(g,".dirty=false;"),i(p)}function $t(u,i,v,E){var S=u.shared,b=u.current,_=S.current,g=S.gl;qo(Object.keys(v)).forEach(function(s){var p=v[s];if(!(E&&!E(p))){var l=p.append(u,i);if(U[s]){var w=U[s];Pr(p)?l?i(g,".enable(",w,");"):i(g,".disable(",w,");"):i(u.cond(l).then(g,".enable(",w,");").else(g,".disable(",w,");")),i(_,".",s,"=",l,";")}else if(Gt(l)){var R=b[s];i(g,".",M[s],"(",l,");",l.map(function(j,re){return R+"["+re+"]="+j}).join(";"),";")}else i(g,".",M[s],"(",l,");",_,".",s,"=",l,";")}})}function Nt(u,i){Q&&(u.instancing=i.def(u.shared.extensions,".angle_instanced_arrays"))}function qe(u,i,v,E,S){var b=u.shared,_=u.stats,g=b.current,s=b.timer,p=v.profile;function l(){return typeof performance>"u"?"Date.now()":"performance.now()"}var w,R;function j(_e){w=i.def(),_e(w,"=",l(),";"),typeof S=="string"?_e(_,".count+=",S,";"):_e(_,".count++;"),W&&(E?(R=i.def(),_e(R,"=",s,".getNumPendingQueries();")):_e(s,".beginQuery(",_,");"))}function re(_e){_e(_,".cpuTime+=",l(),"-",w,";"),W&&(E?_e(s,".pushScopeStats(",R,",",s,".getNumPendingQueries(),",_,");"):_e(s,".endQuery();"))}function ne(_e){var ge=i.def(g,".profile");i(g,".profile=",_e,";"),i.exit(g,".profile=",ge,";")}var de;if(p){if(Pr(p)){p.enable?(j(i),re(i.exit),ne("true")):ne("false");return}de=p.append(u,i),ne(de)}else de=i.def(g,".profile");var te=u.block();j(te),i("if(",de,"){",te,"}");var Ee=u.block();re(Ee),i.exit("if(",de,"){",Ee,"}")}function er(u,i,v,E,S){var b=u.shared;function _(s){switch(s){case _a:case ga:case Aa:return 2;case ba:case xa:case Ta:return 3;case ya:case Ea:case wa:return 4;default:return 1}}function g(s,p,l){var w=b.gl,R=i.def(s,".location"),j=i.def(b.attributes,"[",R,"]"),re=l.state,ne=l.buffer,de=[l.x,l.y,l.z,l.w],te=["buffer","normalized","offset","stride"];function Ee(){i("if(!",j,".buffer){",w,".enableVertexAttribArray(",R,");}");var ge=l.type,xe;if(l.size?xe=i.def(l.size,"||",p):xe=p,i("if(",j,".type!==",ge,"||",j,".size!==",xe,"||",te.map(function(Ue){return j+"."+Ue+"!=="+l[Ue]}).join("||"),"){",w,".bindBuffer(",gn,",",ne,".buffer);",w,".vertexAttribPointer(",[R,xe,ge,l.normalized,l.stride,l.offset],");",j,".type=",ge,";",j,".size=",xe,";",te.map(function(Ue){return j+"."+Ue+"="+l[Ue]+";"}).join(""),"}"),Q){var Ae=l.divisor;i("if(",j,".divisor!==",Ae,"){",u.instancing,".vertexAttribDivisorANGLE(",[R,Ae],");",j,".divisor=",Ae,";}")}}function _e(){i("if(",j,".buffer){",w,".disableVertexAttribArray(",R,");",j,".buffer=null;","}if(",vn.map(function(ge,xe){return j+"."+ge+"!=="+de[xe]}).join("||"),"){",w,".vertexAttrib4f(",R,",",de,");",vn.map(function(ge,xe){return j+"."+ge+"="+de[xe]+";"}).join(""),"}")}re===_n?Ee():re===bi?_e():(i("if(",re,"===",_n,"){"),Ee(),i("}else{"),_e(),i("}"))}E.forEach(function(s){var p=s.name,l=v.attributes[p],w;if(l){if(!S(l))return;w=l.append(u,i)}else{if(!S(Yo))return;var R=u.scopeAttrib(p);f.optional(function(){u.assert(i,R+".state","missing attribute "+p)}),w={},Object.keys(new A).forEach(function(j){w[j]=i.def(R,".",j)})}g(u.link(s),_(s.info.type),w)})}function mt(u,i,v,E,S,b){for(var _=u.shared,g=_.gl,s,p=0;p<E.length;++p){var l=E[p],w=l.name,R=l.info.type,j=v.uniforms[w],re=u.link(l),ne=re+".location",de;if(j){if(!S(j))continue;if(Pr(j)){var te=j.value;if(f.command(te!==null&&typeof te<"u",'missing uniform "'+w+'"',u.commandStr),R===Pn||R===Un){f.command(typeof te=="function"&&(R===Pn&&(te._reglType==="texture2d"||te._reglType==="framebuffer")||R===Un&&(te._reglType==="textureCube"||te._reglType==="framebufferCube")),"invalid texture for uniform "+w,u.commandStr);var Ee=u.link(te._texture||te.color[0]._texture);i(g,".uniform1i(",ne,",",Ee+".bind());"),i.exit(Ee,".unbind();")}else if(R===In||R===Mn||R===Bn){f.optional(function(){f.command(Gt(te),"invalid matrix for uniform "+w,u.commandStr),f.command(R===In&&te.length===4||R===Mn&&te.length===9||R===Bn&&te.length===16,"invalid length for matrix uniform "+w,u.commandStr)});var _e=u.global.def("new Float32Array(["+Array.prototype.slice.call(te)+"])"),ge=2;R===Mn?ge=3:R===Bn&&(ge=4),i(g,".uniformMatrix",ge,"fv(",ne,",false,",_e,");")}else{switch(R){case Ni:f.commandType(te,"number","uniform "+w,u.commandStr),s="1f";break;case _a:f.command(Gt(te)&&te.length===2,"uniform "+w,u.commandStr),s="2f";break;case ba:f.command(Gt(te)&&te.length===3,"uniform "+w,u.commandStr),s="3f";break;case ya:f.command(Gt(te)&&te.length===4,"uniform "+w,u.commandStr),s="4f";break;case Mi:f.commandType(te,"boolean","uniform "+w,u.commandStr),s="1i";break;case Ii:f.commandType(te,"number","uniform "+w,u.commandStr),s="1i";break;case Aa:f.command(Gt(te)&&te.length===2,"uniform "+w,u.commandStr),s="2i";break;case ga:f.command(Gt(te)&&te.length===2,"uniform "+w,u.commandStr),s="2i";break;case Ta:f.command(Gt(te)&&te.length===3,"uniform "+w,u.commandStr),s="3i";break;case xa:f.command(Gt(te)&&te.length===3,"uniform "+w,u.commandStr),s="3i";break;case wa:f.command(Gt(te)&&te.length===4,"uniform "+w,u.commandStr),s="4i";break;case Ea:f.command(Gt(te)&&te.length===4,"uniform "+w,u.commandStr),s="4i";break}i(g,".uniform",s,"(",ne,",",Gt(te)?Array.prototype.slice.call(te):te,");")}continue}else de=j.append(u,i)}else{if(!S(Yo))continue;de=i.def(_.uniforms,"[",o.id(w),"]")}R===Pn?(f(!Array.isArray(de),"must specify a scalar prop for textures"),i("if(",de,"&&",de,'._reglType==="framebuffer"){',de,"=",de,".color[0];","}")):R===Un&&(f(!Array.isArray(de),"must specify a scalar prop for cube maps"),i("if(",de,"&&",de,'._reglType==="framebufferCube"){',de,"=",de,".color[0];","}")),f.optional(function(){function rr(_r,ts){u.assert(i,_r,'bad data or missing for uniform "'+w+'".  '+ts)}function wr(_r){f(!Array.isArray(de),"must not specify an array type for uniform"),rr("typeof "+de+'==="'+_r+'"',"invalid type, expected "+_r)}function hr(_r,ts){Array.isArray(de)?f(de.length===_r,"must have length "+_r):rr(_.isArrayLike+"("+de+")&&"+de+".length==="+_r,"invalid vector, should have length "+_r,u.commandStr)}function es(_r){f(!Array.isArray(de),"must not specify a value type"),rr("typeof "+de+'==="function"&&'+de+'._reglType==="texture'+(_r===Po?"2d":"Cube")+'"',"invalid texture type",u.commandStr)}switch(R){case Ii:wr("number");break;case ga:hr(2);break;case xa:hr(3);break;case Ea:hr(4);break;case Ni:wr("number");break;case _a:hr(2);break;case ba:hr(3);break;case ya:hr(4);break;case Mi:wr("boolean");break;case Aa:hr(2);break;case Ta:hr(3);break;case wa:hr(4);break;case In:hr(4);break;case Mn:hr(9);break;case Bn:hr(16);break;case Pn:es(Po);break;case Un:es(Nc);break}});var xe=1;switch(R){case Pn:case Un:var Ae=i.def(de,"._texture");i(g,".uniform1i(",ne,",",Ae,".bind());"),i.exit(Ae,".unbind();");continue;case Ii:case Mi:s="1i";break;case ga:case Aa:s="2i",xe=2;break;case xa:case Ta:s="3i",xe=3;break;case Ea:case wa:s="4i",xe=4;break;case Ni:s="1f";break;case _a:s="2f",xe=2;break;case ba:s="3f",xe=3;break;case ya:s="4f",xe=4;break;case In:s="Matrix2fv";break;case Mn:s="Matrix3fv";break;case Bn:s="Matrix4fv";break}if(s.charAt(0)==="M"){i(g,".uniform",s,"(",ne,",");var Ue=Math.pow(R-In+2,2),wt=u.global.def("new Float32Array(",Ue,")");Array.isArray(de)?i("false,(",or(Ue,function(rr){return wt+"["+rr+"]="+de[rr]}),",",wt,")"):i("false,(Array.isArray(",de,")||",de," instanceof Float32Array)?",de,":(",or(Ue,function(rr){return wt+"["+rr+"]="+de+"["+rr+"]"}),",",wt,")"),i(");")}else if(xe>1){for(var Zt=[],Cr=[],Or=0;Or<xe;++Or)Array.isArray(de)?Cr.push(de[Or]):Cr.push(i.def(de+"["+Or+"]")),b&&Zt.push(i.def());b&&i("if(!",u.batchId,"||",Zt.map(function(rr,wr){return rr+"!=="+Cr[wr]}).join("||"),"){",Zt.map(function(rr,wr){return rr+"="+Cr[wr]+";"}).join("")),i(g,".uniform",s,"(",ne,",",Cr.join(","),");"),b&&i("}")}else{if(f(!Array.isArray(de),"uniform value must not be an array"),b){var kr=i.def();i("if(!",u.batchId,"||",kr,"!==",de,"){",kr,"=",de,";")}i(g,".uniform",s,"(",ne,",",de,");"),b&&i("}")}}}function Ie(u,i,v,E){var S=u.shared,b=S.gl,_=S.draw,g=E.draw;function s(){var xe=g.elements,Ae,Ue=i;return xe?((xe.contextDep&&E.contextDynamic||xe.propDep)&&(Ue=v),Ae=xe.append(u,Ue),g.elementsActive&&Ue("if("+Ae+")"+b+".bindBuffer("+Gi+","+Ae+".buffer.buffer);")):(Ae=Ue.def(),Ue(Ae,"=",_,".",Kr,";","if(",Ae,"){",b,".bindBuffer(",Gi,",",Ae,".buffer.buffer);}","else if(",S.vao,".currentVAO){",Ae,"=",u.shared.elements+".getElements("+S.vao,".currentVAO.elements);",V?"":"if("+Ae+")"+b+".bindBuffer("+Gi+","+Ae+".buffer.buffer);","}")),Ae}function p(){var xe=g.count,Ae,Ue=i;return xe?((xe.contextDep&&E.contextDynamic||xe.propDep)&&(Ue=v),Ae=xe.append(u,Ue),f.optional(function(){xe.MISSING&&u.assert(i,"false","missing vertex count"),xe.DYNAMIC&&u.assert(Ue,Ae+">=0","missing vertex count")})):(Ae=Ue.def(_,".",Jr),f.optional(function(){u.assert(Ue,Ae+">=0","missing vertex count")})),Ae}var l=s();function w(xe){var Ae=g[xe];return Ae?Ae.contextDep&&E.contextDynamic||Ae.propDep?Ae.append(u,v):Ae.append(u,i):i.def(_,".",xe)}var R=w(Zr),j=w(pa),re=p();if(typeof re=="number"){if(re===0)return}else v("if(",re,"){"),v.exit("}");var ne,de;Q&&(ne=w(va),de=u.instancing);var te=l+".type",Ee=g.elements&&Pr(g.elements)&&!g.vaoActive;function _e(){function xe(){v(de,".drawElementsInstancedANGLE(",[R,re,te,j+"<<(("+te+"-"+bo+")>>1)",ne],");")}function Ae(){v(de,".drawArraysInstancedANGLE(",[R,j,re,ne],");")}l&&l!=="null"?Ee?xe():(v("if(",l,"){"),xe(),v("}else{"),Ae(),v("}")):Ae()}function ge(){function xe(){v(b+".drawElements("+[R,re,te,j+"<<(("+te+"-"+bo+")>>1)"]+");")}function Ae(){v(b+".drawArrays("+[R,j,re]+");")}l&&l!=="null"?Ee?xe():(v("if(",l,"){"),xe(),v("}else{"),Ae(),v("}")):Ae()}Q&&(typeof ne!="number"||ne>=0)?typeof ne=="string"?(v("if(",ne,">0){"),_e(),v("}else if(",ne,"<0){"),ge(),v("}")):_e():ge()}function rt(u,i,v,E,S){var b=Ve(),_=b.proc("body",S);return f.optional(function(){b.commandStr=i.commandStr,b.command=b.link(i.commandStr)}),Q&&(b.instancing=_.def(b.shared.extensions,".angle_instanced_arrays")),u(b,_,v,E),b.compile().body}function ct(u,i,v,E){Nt(u,i),v.useVAO?v.drawVAO?i(u.shared.vao,".setVAO(",v.drawVAO.append(u,i),");"):i(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(i(u.shared.vao,".setVAO(null);"),er(u,i,v,E.attributes,function(){return!0})),mt(u,i,v,E.uniforms,function(){return!0},!1),Ie(u,i,i,v)}function It(u,i){var v=u.proc("draw",1);Nt(u,v),Xt(u,v,i.context),Wt(u,v,i.framebuffer),Kt(u,v,i),$t(u,v,i.state),qe(u,v,i,!1,!0);var E=i.shader.progVar.append(u,v);if(v(u.shared.gl,".useProgram(",E,".program);"),i.shader.program)ct(u,v,i,i.shader.program);else{v(u.shared.vao,".setVAO(null);");var S=u.global.def("{}"),b=v.def(E,".id"),_=v.def(S,"[",b,"]");v(u.cond(_).then(_,".call(this,a0);").else(_,"=",S,"[",b,"]=",u.link(function(g){return rt(ct,u,i,g,1)}),"(",E,");",_,".call(this,a0);"))}Object.keys(i.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function Tr(u,i,v,E){u.batchId="a1",Nt(u,i);function S(){return!0}er(u,i,v,E.attributes,S),mt(u,i,v,E.uniforms,S,!1),Ie(u,i,i,v)}function en(u,i,v,E){Nt(u,i);var S=v.contextDep,b=i.def(),_="a0",g="a1",s=i.def();u.shared.props=s,u.batchId=b;var p=u.scope(),l=u.scope();i(p.entry,"for(",b,"=0;",b,"<",g,";++",b,"){",s,"=",_,"[",b,"];",l,"}",p.exit);function w(te){return te.contextDep&&S||te.propDep}function R(te){return!w(te)}if(v.needsContext&&Xt(u,l,v.context),v.needsFramebuffer&&Wt(u,l,v.framebuffer),$t(u,l,v.state,w),v.profile&&w(v.profile)&&qe(u,l,v,!1,!0),E)v.useVAO?v.drawVAO?w(v.drawVAO)?l(u.shared.vao,".setVAO(",v.drawVAO.append(u,l),");"):p(u.shared.vao,".setVAO(",v.drawVAO.append(u,p),");"):p(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(p(u.shared.vao,".setVAO(null);"),er(u,p,v,E.attributes,R),er(u,l,v,E.attributes,w)),mt(u,p,v,E.uniforms,R,!1),mt(u,l,v,E.uniforms,w,!0),Ie(u,p,l,v);else{var j=u.global.def("{}"),re=v.shader.progVar.append(u,l),ne=l.def(re,".id"),de=l.def(j,"[",ne,"]");l(u.shared.gl,".useProgram(",re,".program);","if(!",de,"){",de,"=",j,"[",ne,"]=",u.link(function(te){return rt(Tr,u,v,te,2)}),"(",re,");}",de,".call(this,a0[",b,"],",b,");")}}function c(u,i){var v=u.proc("batch",2);u.batchId="0",Nt(u,v);var E=!1,S=!0;Object.keys(i.context).forEach(function(j){E=E||i.context[j].propDep}),E||(Xt(u,v,i.context),S=!1);var b=i.framebuffer,_=!1;b?(b.propDep?E=_=!0:b.contextDep&&E&&(_=!0),_||Wt(u,v,b)):Wt(u,v,null),i.state.viewport&&i.state.viewport.propDep&&(E=!0);function g(j){return j.contextDep&&E||j.propDep}Kt(u,v,i),$t(u,v,i.state,function(j){return!g(j)}),(!i.profile||!g(i.profile))&&qe(u,v,i,!1,"a1"),i.contextDep=E,i.needsContext=S,i.needsFramebuffer=_;var s=i.shader.progVar;if(s.contextDep&&E||s.propDep)en(u,v,i,null);else{var p=s.append(u,v);if(v(u.shared.gl,".useProgram(",p,".program);"),i.shader.program)en(u,v,i,i.shader.program);else{v(u.shared.vao,".setVAO(null);");var l=u.global.def("{}"),w=v.def(p,".id"),R=v.def(l,"[",w,"]");v(u.cond(R).then(R,".call(this,a0,a1);").else(R,"=",l,"[",w,"]=",u.link(function(j){return rt(en,u,i,j,2)}),"(",p,");",R,".call(this,a0,a1);"))}}Object.keys(i.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function F(u,i){var v=u.proc("scope",3);u.batchId="a2";var E=u.shared,S=E.current;Xt(u,v,i.context),i.framebuffer&&i.framebuffer.append(u,v),qo(Object.keys(i.state)).forEach(function(_){var g=i.state[_],s=g.append(u,v);Gt(s)?s.forEach(function(p,l){v.set(u.next[_],"["+l+"]",p)}):v.set(E.next,"."+_,s)}),qe(u,v,i,!0,!0),[Kr,pa,Jr,va,Zr].forEach(function(_){var g=i.draw[_];!g||v.set(E.draw,"."+_,""+g.append(u,v))}),Object.keys(i.uniforms).forEach(function(_){var g=i.uniforms[_].append(u,v);Array.isArray(g)&&(g="["+g.join()+"]"),v.set(E.uniforms,"["+o.id(_)+"]",g)}),Object.keys(i.attributes).forEach(function(_){var g=i.attributes[_].append(u,v),s=u.scopeAttrib(_);Object.keys(new A).forEach(function(p){v.set(s,"."+p,g[p])})}),i.scopeVAO&&v.set(E.vao,".targetVAO",i.scopeVAO.append(u,v));function b(_){var g=i.shader[_];g&&v.set(E.shader,"."+_,g.append(u,v))}b(Fn),b(Gn),Object.keys(i.state).length>0&&(v(S,".dirty=true;"),v.exit(S,".dirty=true;")),v("a1(",u.shared.context,",a0,",u.batchId,");")}function C(u){if(!(typeof u!="object"||Gt(u))){for(var i=Object.keys(u),v=0;v<i.length;++v)if(Tt.isDynamic(u[i[v]]))return!0;return!1}}function be(u,i,v){var E=i.static[v];if(!E||!C(E))return;var S=u.global,b=Object.keys(E),_=!1,g=!1,s=!1,p=u.global.def("{}");b.forEach(function(w){var R=E[w];if(Tt.isDynamic(R)){typeof R=="function"&&(R=E[w]=Tt.unbox(R));var j=ir(R,null);_=_||j.thisDep,s=s||j.propDep,g=g||j.contextDep}else{switch(S(p,".",w,"="),typeof R){case"number":S(R);break;case"string":S('"',R,'"');break;case"object":Array.isArray(R)&&S("[",R.join(),"]");break;default:S(u.link(R));break}S(";")}});function l(w,R){b.forEach(function(j){var re=E[j];if(!!Tt.isDynamic(re)){var ne=w.invoke(R,re);R(p,".",j,"=",ne,";")}})}i.dynamic[v]=new Tt.DynamicVariable(ha,{thisDep:_,contextDep:g,propDep:s,ref:p,append:l}),delete i.static[v]}function Ze(u,i,v,E,S){var b=Ve();b.stats=b.link(S),Object.keys(i.static).forEach(function(g){be(b,i,g)}),Dc.forEach(function(g){be(b,u,g)});var _=jt(u,i,v,E,b);return It(b,_),F(b,_),c(b,_),a(b.compile(),{destroy:function(){_.shader.program.destroy()}})}return{next:le,current:he,procs:function(){var u=Ve(),i=u.proc("poll"),v=u.proc("refresh"),E=u.block();i(E),v(E);var S=u.shared,b=S.gl,_=S.next,g=S.current;E(g,".dirty=false;"),Wt(u,i),Wt(u,v,null,!0);var s;Q&&(s=u.link(Q)),h.oes_vertex_array_object&&v(u.link(h.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<D.maxAttributes;++p){var l=v.def(S.attributes,"[",p,"]"),w=u.cond(l,".buffer");w.then(b,".enableVertexAttribArray(",p,");",b,".bindBuffer(",gn,",",l,".buffer.buffer);",b,".vertexAttribPointer(",p,",",l,".size,",l,".type,",l,".normalized,",l,".stride,",l,".offset);").else(b,".disableVertexAttribArray(",p,");",b,".vertexAttrib4f(",p,",",l,".x,",l,".y,",l,".z,",l,".w);",l,".buffer=null;"),v(w),Q&&v(s,".vertexAttribDivisorANGLE(",p,",",l,".divisor);")}return v(u.shared.vao,".currentVAO=null;",u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"),Object.keys(U).forEach(function(R){var j=U[R],re=E.def(_,".",R),ne=u.block();ne("if(",re,"){",b,".enable(",j,")}else{",b,".disable(",j,")}",g,".",R,"=",re,";"),v(ne),i("if(",re,"!==",g,".",R,"){",ne,"}")}),Object.keys(M).forEach(function(R){var j=M[R],re=he[R],ne,de,te=u.block();if(te(b,".",j,"("),Gt(re)){var Ee=re.length;ne=u.global.def(_,".",R),de=u.global.def(g,".",R),te(or(Ee,function(_e){return ne+"["+_e+"]"}),");",or(Ee,function(_e){return de+"["+_e+"]="+ne+"["+_e+"];"}).join("")),i("if(",or(Ee,function(_e){return ne+"["+_e+"]!=="+de+"["+_e+"]"}).join("||"),"){",te,"}")}else ne=E.def(_,".",R),de=E.def(g,".",R),te(ne,");",g,".",R,"=",ne,";"),i("if(",ne,"!==",de,"){",te,"}");v(te)}),u.compile()}(),compile:Ze}}function Zc(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Jc=34918,$c=34919,Qo=35007,ed=function(t,o){if(!o.ext_disjoint_timer_query)return null;var h=[];function D(){return h.pop()||o.ext_disjoint_timer_query.createQueryEXT()}function B(Q){h.push(Q)}var k=[];function I(Q){var pe=D();o.ext_disjoint_timer_query.beginQueryEXT(Qo,pe),k.push(pe),W(k.length-1,k.length,Q)}function X(){o.ext_disjoint_timer_query.endQueryEXT(Qo)}function z(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Z=[];function $(){return Z.pop()||new z}function J(Q){Z.push(Q)}var ae=[];function W(Q,pe,V){var he=$();he.startQueryIndex=Q,he.endQueryIndex=pe,he.sum=0,he.stats=V,ae.push(he)}var K=[],A=[];function G(){var Q,pe,V=k.length;if(V!==0){A.length=Math.max(A.length,V+1),K.length=Math.max(K.length,V+1),K[0]=0,A[0]=0;var he=0;for(Q=0,pe=0;pe<k.length;++pe){var le=k[pe];o.ext_disjoint_timer_query.getQueryObjectEXT(le,$c)?(he+=o.ext_disjoint_timer_query.getQueryObjectEXT(le,Jc),B(le)):k[Q++]=le,K[pe+1]=he,A[pe+1]=Q}for(k.length=Q,Q=0,pe=0;pe<ae.length;++pe){var Fe=ae[pe],U=Fe.startQueryIndex,M=Fe.endQueryIndex;Fe.sum+=K[M]-K[U];var ye=A[U],ie=A[M];ie===ye?(Fe.stats.gpuTime+=Fe.sum/1e6,J(Fe)):(Fe.startQueryIndex=ye,Fe.endQueryIndex=ie,ae[Q++]=Fe)}ae.length=Q}}return{beginQuery:I,endQuery:X,pushScopeStats:W,update:G,getNumPendingQueries:function(){return k.length},clear:function(){h.push.apply(h,k);for(var Q=0;Q<h.length;Q++)o.ext_disjoint_timer_query.deleteQueryEXT(h[Q]);k.length=0,h.length=0},restore:function(){k.length=0,h.length=0}}},td=16384,rd=256,nd=1024,ad=34962,Ko="webglcontextlost",Zo="webglcontextrestored",Jo=1,id=2,fd=3;function $o(t,o){for(var h=0;h<t.length;++h)if(t[h]===o)return h;return-1}function od(t){var o=iu(t);if(!o)return null;var h=o.gl,D=h.getContextAttributes(),B=h.isContextLost(),k=fu(h,o);if(!k)return null;var I=eu(),X=Zc(),z=k.extensions,Z=ed(h,z),$=fn(),J=h.drawingBufferWidth,ae=h.drawingBufferHeight,W={tick:0,time:0,viewportWidth:J,viewportHeight:ae,framebufferWidth:J,framebufferHeight:ae,drawingBufferWidth:J,drawingBufferHeight:ae,pixelRatio:o.pixelRatio},K={},A={elements:null,primitive:4,count:-1,offset:0,instances:-1},G=qu(h,z),Q=ul(h,X,o,he),pe=xl(h,z,Q,X),V=xc(h,z,G,X,Q,pe,A);function he(Ie){return V.destroyBuffer(Ie)}var le=wc(h,I,X,o),Fe=Jl(h,z,G,function(){ye.procs.poll()},W,X,o),U=$l(h,z,G,X,o),M=yc(h,z,G,Fe,U,X),ye=Kc(h,I,z,G,Q,pe,Fe,M,K,V,le,A,W,Z,o),ie=Lc(h,M,ye.procs.poll,W,D,z,G),Y=ye.next,oe=h.canvas,se=[],Xe=[],Ve=[],ce=[o.onDestroy],me=null;function Pe(){if(se.length===0){Z&&Z.update(),me=null;return}me=Fr.next(Pe),$t();for(var Ie=se.length-1;Ie>=0;--Ie){var rt=se[Ie];rt&&rt(W,null,0)}h.flush(),Z&&Z.update()}function He(){!me&&se.length>0&&(me=Fr.next(Pe))}function tt(){me&&(Fr.cancel(Pe),me=null)}function Ot(Ie){Ie.preventDefault(),B=!0,tt(),Xe.forEach(function(rt){rt()})}function kt(Ie){h.getError(),B=!1,k.restore(),le.restore(),Q.restore(),Fe.restore(),U.restore(),M.restore(),V.restore(),Z&&Z.restore(),ye.procs.refresh(),He(),Ve.forEach(function(rt){rt()})}oe&&(oe.addEventListener(Ko,Ot,!1),oe.addEventListener(Zo,kt,!1));function it(){se.length=0,tt(),oe&&(oe.removeEventListener(Ko,Ot),oe.removeEventListener(Zo,kt)),le.clear(),M.clear(),U.clear(),V.clear(),Fe.clear(),pe.clear(),Q.clear(),Z&&Z.clear(),ce.forEach(function(Ie){Ie()})}function Ht(Ie){f(!!Ie,"invalid args to regl({...})"),f.type(Ie,"object","invalid args to regl({...})");function rt(S){var b=a({},S);delete b.uniforms,delete b.attributes,delete b.context,delete b.vao,"stencil"in b&&b.stencil.op&&(b.stencil.opBack=b.stencil.opFront=b.stencil.op,delete b.stencil.op);function _(g){if(g in b){var s=b[g];delete b[g],Object.keys(s).forEach(function(p){b[g+"."+p]=s[p]})}}return _("blend"),_("depth"),_("cull"),_("stencil"),_("polygonOffset"),_("scissor"),_("sample"),"vao"in S&&(b.vao=S.vao),b}function ct(S,b){var _={},g={};return Object.keys(S).forEach(function(s){var p=S[s];if(Tt.isDynamic(p)){g[s]=Tt.unbox(p,s);return}else if(b&&Array.isArray(p)){for(var l=0;l<p.length;++l)if(Tt.isDynamic(p[l])){g[s]=Tt.unbox(p,s);return}}_[s]=p}),{dynamic:g,static:_}}var It=ct(Ie.context||{},!0),Tr=ct(Ie.uniforms||{},!0),en=ct(Ie.attributes||{},!1),c=ct(rt(Ie),!1),F={gpuTime:0,cpuTime:0,count:0},C=ye.compile(c,en,Tr,It,F),be=C.draw,Ze=C.batch,u=C.scope,i=[];function v(S){for(;i.length<S;)i.push(null);return i}function E(S,b){var _;if(B&&f.raise("context lost"),typeof S=="function")return u.call(this,null,S,0);if(typeof b=="function")if(typeof S=="number")for(_=0;_<S;++_)u.call(this,null,b,_);else if(Array.isArray(S))for(_=0;_<S.length;++_)u.call(this,S[_],b,_);else return u.call(this,S,b,0);else if(typeof S=="number"){if(S>0)return Ze.call(this,v(S|0),S|0)}else if(Array.isArray(S)){if(S.length)return Ze.call(this,S,S.length)}else return be.call(this,S)}return a(E,{stats:F,destroy:function(){C.destroy()}})}var Rt=M.setFBO=Ht({framebuffer:Tt.define.call(null,Jo,"framebuffer")});function jt(Ie,rt){var ct=0;ye.procs.poll();var It=rt.color;It&&(h.clearColor(+It[0]||0,+It[1]||0,+It[2]||0,+It[3]||0),ct|=td),"depth"in rt&&(h.clearDepth(+rt.depth),ct|=rd),"stencil"in rt&&(h.clearStencil(rt.stencil|0),ct|=nd),f(!!ct,"called regl.clear with no buffer specified"),h.clear(ct)}function Xt(Ie){if(f(typeof Ie=="object"&&Ie,"regl.clear() takes an object as input"),"framebuffer"in Ie)if(Ie.framebuffer&&Ie.framebuffer_reglType==="framebufferCube")for(var rt=0;rt<6;++rt)Rt(a({framebuffer:Ie.framebuffer.faces[rt]},Ie),jt);else Rt(Ie,jt);else jt(null,Ie)}function Wt(Ie){f.type(Ie,"function","regl.frame() callback must be a function"),se.push(Ie);function rt(){var ct=$o(se,Ie);f(ct>=0,"cannot cancel a frame twice");function It(){var Tr=$o(se,It);se[Tr]=se[se.length-1],se.length-=1,se.length<=0&&tt()}se[ct]=It}return He(),{cancel:rt}}function Kt(){var Ie=Y.viewport,rt=Y.scissor_box;Ie[0]=Ie[1]=rt[0]=rt[1]=0,W.viewportWidth=W.framebufferWidth=W.drawingBufferWidth=Ie[2]=rt[2]=h.drawingBufferWidth,W.viewportHeight=W.framebufferHeight=W.drawingBufferHeight=Ie[3]=rt[3]=h.drawingBufferHeight}function $t(){W.tick+=1,W.time=qe(),Kt(),ye.procs.poll()}function Nt(){Fe.refresh(),Kt(),ye.procs.refresh(),Z&&Z.update()}function qe(){return(fn()-$)/1e3}Nt();function er(Ie,rt){f.type(rt,"function","listener callback must be a function");var ct;switch(Ie){case"frame":return Wt(rt);case"lost":ct=Xe;break;case"restore":ct=Ve;break;case"destroy":ct=ce;break;default:f.raise("invalid event, must be one of frame,lost,restore,destroy")}return ct.push(rt),{cancel:function(){for(var It=0;It<ct.length;++It)if(ct[It]===rt){ct[It]=ct[ct.length-1],ct.pop();return}}}}var mt=a(Ht,{clear:Xt,prop:Tt.define.bind(null,Jo),context:Tt.define.bind(null,id),this:Tt.define.bind(null,fd),draw:Ht({}),buffer:function(Ie){return Q.create(Ie,ad,!1,!1)},elements:function(Ie){return pe.create(Ie,!1)},texture:Fe.create2D,cube:Fe.createCube,renderbuffer:U.create,framebuffer:M.create,framebufferCube:M.createCube,vao:V.createVAO,attributes:D,frame:Wt,on:er,limits:G,hasExtension:function(Ie){return G.extensions.indexOf(Ie.toLowerCase())>=0},read:ie,destroy:it,_gl:h,_refresh:Nt,poll:function(){$t(),Z&&Z.update()},now:qe,stats:X});return o.onDone(null,mt),mt}return od})})($s);const Ch=$s.exports;function Rs(e){let r,n;return r=new Lh({props:{hoveredData:e[4],data:e[0],domainColumn:e[1],colorScale:e[2]}}),{c(){tf(r.$$.fragment)},m(a,d){ja(r,a,d),n=!0},p(a,d){const m={};d&16&&(m.hoveredData=a[4]),d&1&&(m.data=a[0]),d&2&&(m.domainColumn=a[1]),d&4&&(m.colorScale=a[2]),r.$set(m)},i(a){n||(Dr(r.$$.fragment,a),n=!0)},o(a){nn(r.$$.fragment,a),n=!1},d(a){Va(r,a)}}}function Oh(e){let r,n,a,d,m,T,y=e[4]&&Rs(e);return{c(){r=nt("div"),n=nt("canvas"),a=Lt(),y&&y.c(),Ge(n,"width",Hn),Ge(n,"height",Xn),ur(n,"width",Hn+"px"),ur(n,"height",Xn+"px"),ur(n,"display","block"),Ge(n,"class","svelte-1me0aus"),Ge(r,"class","chart-container svelte-1me0aus")},m(N,x){Mt(N,r,x),je(r,n),e[20](n),je(r,a),y&&y.m(r,null),d=!0,m||(T=Vt(n,"mousemove",e[5]),m=!0)},p(N,[x]){N[4]?y?(y.p(N,x),x&16&&Dr(y,1)):(y=Rs(N),y.c(),Dr(y,1),y.m(r,null)):y&&(Ps(),nn(y,1,1,()=>{y=null}),Us())},i(N){d||(Dr(y),d=!0)},o(N){nn(y),d=!1},d(N){N&&Ft(r),e[20](null),y&&y.d(),m=!1,T()}}}let Hn=800,Xn=600;const Ls=6;function kh(e,r,n){let a,d,m,T,y,N,{data:x=[]}=r,{domainColumn:q=""}=r,{opacity:ee=1}=r,{selectedValues:ve=new Set}=r,{searchQuery:Me=""}=r,{highlightedData:ke=[]}=r,{startDate:lt=null}=r,{endDate:Ce=null}=r,Ye,st,gt,vt=null,Ke=null,pt=null;function We(){!st||!Ke||!pt||(st.clear({color:[1,1,1,1],depth:1}),gt({position:Ke,color:pt,count:Ke.length/2}))}ef(()=>{n(12,st=Ch({canvas:Ye})),gt=st({vert:`
        precision mediump float;
        attribute vec2 position;
        attribute vec4 color;
        varying vec4 fragColor;
        void main() {
          fragColor = color;
          gl_Position = vec4(position, 0, 1);
          gl_PointSize = ${Ls*2}.0;
        }
      `,frag:`
        precision mediump float;
        varying vec4 fragColor;
        void main() {
          float r = length(gl_PointCoord - 0.5);
          if (r > 0.5) discard;
          gl_FragColor = fragColor;
        }
      `,attributes:{position:{buffer:st.prop("position"),size:2},color:{buffer:st.prop("color"),size:4}},count:st.prop("count"),primitive:"points"}),We()}),hd(()=>{st&&st.destroy()});let L=0;function O(P){const fe=performance.now();if(fe-L<30)return;L=fe;const Te=Ye.getBoundingClientRect(),at=(P.clientX-Te.left)*(Hn/Te.width),St=(P.clientY-Te.top)*(Xn/Te.height);let De=null,Se=Ls+3;for(let Ne=0;Ne<x.length;++Ne){const ue=T(x[Ne].x),Je=y(x[Ne].y),Be=ue-at,Qe=Je-St,Oe=Math.sqrt(Be*Be+Qe*Qe);Oe<Se&&(De=x[Ne],Se=Oe)}n(4,vt=De)}function H(P){Vr[P?"unshift":"push"](()=>{Ye=P,n(3,Ye)})}return e.$$set=P=>{"data"in P&&n(0,x=P.data),"domainColumn"in P&&n(1,q=P.domainColumn),"opacity"in P&&n(6,ee=P.opacity),"selectedValues"in P&&n(7,ve=P.selectedValues),"searchQuery"in P&&n(8,Me=P.searchQuery),"highlightedData"in P&&n(9,ke=P.highlightedData),"startDate"in P&&n(10,lt=P.startDate),"endDate"in P&&n(11,Ce=P.endDate)},e.$$.update=()=>{var P;if(e.$$.dirty&512&&n(17,a=new Set(ke.map(fe=>fe.id))),e.$$.dirty&1&&n(19,d=[ls(x,fe=>fe.x),us(x,fe=>fe.x)]),e.$$.dirty&1&&n(18,m=[ls(x,fe=>fe.y),us(x,fe=>fe.y)]),e.$$.dirty&524288&&n(16,T=Ji().domain(d[0]===d[1]?[d[0]-1,d[1]+1]:d).range([0,Hn])),e.$$.dirty&262144&&n(15,y=Ji().domain(m[0]===m[1]?[m[0]-1,m[1]+1]:m).range([Xn,0])),e.$$.dirty&3&&n(2,N=Ws().domain([...new Set(x.map(fe=>fe[q]))]).range(Ah)),e.$$.dirty&232903&&x.length){const fe=[],Te=[],at=x.map(Ne=>Ne.date.getTime()),St=Math.min(...at),De=Math.max(...at);for(let Ne=0;Ne<x.length;++Ne){const ue=x[Ne],Je=Me&&((P=ue.title)==null?void 0:P.toLowerCase().includes(Me.toLowerCase())),Be=a.has(ue.id)||Je,Qe=ve.has(ue[q]),Oe=(!lt||ue.date>=lt)&&(!Ce||ue.date<=Ce),xt=(lt==null?void 0:lt.getTime())===St&&(Ce==null?void 0:Ce.getTime())===De;let _t=ee;((Be||Qe)&&Oe&&!xt||Oe&&!xt&&ve.size===0||(Be||Qe)&&xt)&&(_t=1);const ut=N(ue[q])||"#1f77b4";let Re;if(ut.startsWith("#"))Re=[parseInt(ut.slice(1,3),16)/255,parseInt(ut.slice(3,5),16)/255,parseInt(ut.slice(5,7),16)/255];else if(ut.startsWith("rgb")){const we=ut.match(/\d+/g).map(Number);Re=[we[0]/255,we[1]/255,we[2]/255]}else Re=[31/255,119/255,180/255];const Le={x:2*T(ue.x)/Hn-1,y:1-2*y(ue.y)/Xn,rgb:Re,alpha:_t};_t===1?Te.push(Le):fe.push(Le)}const Se=[...Te,...fe];n(13,Ke=new Float32Array(Se.length*2)),n(14,pt=new Float32Array(Se.length*4));for(let Ne=0;Ne<Se.length;++Ne){const ue=Se[Ne];n(13,Ke[2*Ne]=ue.x,Ke),n(13,Ke[2*Ne+1]=ue.y,Ke),n(14,pt[4*Ne]=ue.rgb[0],pt),n(14,pt[4*Ne+1]=ue.rgb[1],pt),n(14,pt[4*Ne+2]=ue.rgb[2],pt),n(14,pt[4*Ne+3]=ue.alpha,pt)}}e.$$.dirty&28672&&st&&Ke&&pt&&We()},[x,q,N,Ye,vt,O,ee,ve,Me,ke,lt,Ce,st,Ke,pt,y,T,a,m,d,H]}class Dh extends Ha{constructor(r){super(),za(this,r,kh,Oh,Ua,{data:0,domainColumn:1,opacity:6,selectedValues:7,searchQuery:8,highlightedData:9,startDate:10,endDate:11})}}function Fh(e){let r,n,a,d,m,T,y,N,x;return{c(){r=nt("div"),n=nt("div"),a=nt("div"),d=Lt(),m=nt("div"),T=Lt(),y=nt("div"),Ge(a,"class","track-inner svelte-vytkle"),Ge(n,"class","track svelte-vytkle"),Ge(m,"class","thumb start-thumb svelte-vytkle"),ur(m,"left",e[4]+"%"),Ge(y,"class","thumb end-thumb svelte-vytkle"),ur(y,"left",e[3]+"%"),Ge(r,"class","range-slider svelte-vytkle"),ur(r,"--start-percent",e[4]+"%"),ur(r,"--end-percent",e[3]+"%")},m(q,ee){Mt(q,r,ee),je(r,n),je(n,a),je(r,d),je(r,m),e[13](m),je(r,T),je(r,y),e[16](y),e[19](r),N||(x=[Vt(a,"mousedown",e[11]),Vt(a,"touchstart",e[12]),Vt(m,"mousedown",e[14]),Vt(m,"touchstart",e[15]),Vt(y,"mousedown",e[17]),Vt(y,"touchstart",e[18])],N=!0)},p(q,[ee]){ee&16&&ur(m,"left",q[4]+"%"),ee&8&&ur(y,"left",q[3]+"%"),ee&16&&ur(r,"--start-percent",q[4]+"%"),ee&8&&ur(r,"--end-percent",q[3]+"%")},i:gr,o:gr,d(q){q&&Ft(r),e[13](null),e[16](null),e[19](null),N=!1,zr(x)}}}function Gh(e,r,n){let a,d,{min:m=0}=r,{max:T=100}=r,{startValue:y}=r,{endValue:N}=r;const x=md();let q,ee,ve,Me=!1,ke=null,lt=null,Ce=0;function Ye(De,Se){Me=!0,ke=Se,lt=q.getBoundingClientRect(),Se==="range"&&(Ce=N-y),window.addEventListener("mousemove",st),window.addEventListener("mouseup",gt)}function st(De){if(!Me)return;const Se=Math.min(Math.max(0,(De.clientX-lt.left)/lt.width),1),Ne=Math.round(Se*(T-m)+m);if(ke==="start")n(7,y=Math.min(Ne,N)),x("startChange",y);else if(ke==="end")n(8,N=Math.max(Ne,y)),x("endChange",N);else if(ke==="range"){let ue=Ne-Math.floor(Ce/2),Je=Ne+Math.ceil(Ce/2);ue<m&&(ue=m,Je=m+Ce),Je>T&&(Je=T,ue=T-Ce),ue=Math.max(m,ue),Je=Math.min(T,Je),n(7,y=ue),n(8,N=Je),x("startChange",y),x("endChange",N)}}function gt(){Me=!1,window.removeEventListener("mousemove",st),window.removeEventListener("mouseup",gt)}function vt(De,Se){De.preventDefault(),Me=!0,ke=Se,lt=q.getBoundingClientRect(),Se==="range"&&(Ce=N-y),window.addEventListener("touchmove",Ke,{passive:!1}),window.addEventListener("touchend",pt)}function Ke(De){if(De.preventDefault(),!Me)return;const Se=De.touches[0],Ne=Math.min(Math.max(0,(Se.clientX-lt.left)/lt.width),1),ue=Math.round(Ne*(T-m)+m);if(ke==="start")n(7,y=Math.min(ue,N)),x("startChange",y);else if(ke==="end")n(8,N=Math.max(ue,y)),x("endChange",N);else if(ke==="range"){let Je=ue-Math.floor(Ce/2),Be=ue+Math.ceil(Ce/2);Je<m&&(Je=m,Be=m+Ce),Be>T&&(Be=T,Je=T-Ce),Je=Math.max(m,Je),Be=Math.min(T,Be),n(7,y=Je),n(8,N=Be),x("startChange",y),x("endChange",N)}}function pt(){Me=!1,window.removeEventListener("touchmove",Ke),window.removeEventListener("touchend",pt)}const We=De=>Ye(De,"range"),L=De=>vt(De,"range");function O(De){Vr[De?"unshift":"push"](()=>{ee=De,n(1,ee)})}const H=De=>Ye(De,"start"),P=De=>vt(De,"start");function fe(De){Vr[De?"unshift":"push"](()=>{ve=De,n(2,ve)})}const Te=De=>Ye(De,"end"),at=De=>vt(De,"end");function St(De){Vr[De?"unshift":"push"](()=>{q=De,n(0,q)})}return e.$$set=De=>{"min"in De&&n(9,m=De.min),"max"in De&&n(10,T=De.max),"startValue"in De&&n(7,y=De.startValue),"endValue"in De&&n(8,N=De.endValue)},e.$$.update=()=>{e.$$.dirty&1664&&n(4,a=T>m?(y-m)/(T-m)*100:0),e.$$.dirty&1792&&n(3,d=T>m?(N-m)/(T-m)*100:100)},[q,ee,ve,d,a,Ye,vt,y,N,m,T,We,L,O,H,P,fe,Te,at,St]}class Nh extends Ha{constructor(r){super(),za(this,r,Gh,Fh,Ua,{min:9,max:10,startValue:7,endValue:8})}}function Cs(e,r,n){const a=e.slice();return a[43]=r[n],a}function Os(e,r,n){const a=e.slice();return a[46]=r[n],a}function ks(e){let r,n,a,d,m,T,y=e[9],N=[];for(let x=0;x<y.length;x+=1)N[x]=Ds(Os(e,y,x));return{c(){r=nt("label"),r.textContent="\u{1F3A8} Color by Column:",n=Lt(),a=nt("select"),d=nt("option"),d.textContent="Select column";for(let x=0;x<N.length;x+=1)N[x].c();Ge(r,"for","domain-column"),Ge(r,"class","svelte-bcjotp"),d.__value="",d.value=d.__value,d.disabled=!0,Ge(a,"id","domain-column"),Ge(a,"class","svelte-bcjotp"),e[0]===void 0&&Ga(()=>e[24].call(a))},m(x,q){Mt(x,r,q),Mt(x,n,q),Mt(x,a,q),je(a,d);for(let ee=0;ee<N.length;ee+=1)N[ee].m(a,null);as(a,e[0]),m||(T=[Vt(a,"change",e[15]),Vt(a,"change",e[24])],m=!0)},p(x,q){if(q[0]&512){y=x[9];let ee;for(ee=0;ee<y.length;ee+=1){const ve=Os(x,y,ee);N[ee]?N[ee].p(ve,q):(N[ee]=Ds(ve),N[ee].c(),N[ee].m(a,null))}for(;ee<N.length;ee+=1)N[ee].d(1);N.length=y.length}q[0]&513&&as(a,x[0])},d(x){x&&Ft(r),x&&Ft(n),x&&Ft(a),Ms(N,x),m=!1,zr(T)}}}function Ds(e){let r,n=e[46]+"",a,d;return{c(){r=nt("option"),a=yr(n),r.__value=d=e[46],r.value=r.__value},m(m,T){Mt(m,r,T),je(r,a)},p(m,T){T[0]&512&&n!==(n=m[46]+"")&&jr(a,n),T[0]&512&&d!==(d=m[46])&&(r.__value=d,r.value=r.__value)},d(m){m&&Ft(r)}}}function Fs(e){let r,n,a,d,m,T=e[1],y=[];for(let N=0;N<T.length;N+=1)y[N]=Gs(Cs(e,T,N));return{c(){r=nt("label"),r.textContent="\u2728 Highlight Values:",n=Lt(),a=nt("select");for(let N=0;N<y.length;N+=1)y[N].c();Ge(r,"for","value-select"),Ge(r,"class","svelte-bcjotp"),Ge(a,"id","value-select"),a.multiple=!0,Ge(a,"size","5"),Ge(a,"class","multi-select svelte-bcjotp")},m(N,x){Mt(N,r,x),Mt(N,n,x),Mt(N,a,x);for(let q=0;q<y.length;q+=1)y[q].m(a,null);d||(m=Vt(a,"change",e[16]),d=!0)},p(N,x){if(x[0]&2){T=N[1];let q;for(q=0;q<T.length;q+=1){const ee=Cs(N,T,q);y[q]?y[q].p(ee,x):(y[q]=Gs(ee),y[q].c(),y[q].m(a,null))}for(;q<y.length;q+=1)y[q].d(1);y.length=T.length}},d(N){N&&Ft(r),N&&Ft(n),N&&Ft(a),Ms(y,N),d=!1,m()}}}function Gs(e){let r,n=e[43]+"",a,d;return{c(){r=nt("option"),a=yr(n),r.__value=d=e[43],r.value=r.__value},m(m,T){Mt(m,r,T),je(r,a)},p(m,T){T[0]&2&&n!==(n=m[43]+"")&&jr(a,n),T[0]&2&&d!==(d=m[43])&&(r.__value=d,r.value=r.__value)},d(m){m&&Ft(r)}}}function Ih(e){let r;return{c(){r=yr("\u25B6")},m(n,a){Mt(n,r,a)},d(n){n&&Ft(r)}}}function Mh(e){let r;return{c(){r=yr("\u275A\u275A")},m(n,a){Mt(n,r,a)},d(n){n&&Ft(r)}}}function Bh(e){let r;return{c(){r=nt("p"),r.textContent="Loading data..."},m(n,a){Mt(n,r,a)},p:gr,i:gr,o:gr,d(n){n&&Ft(r)}}}function Ph(e){let r,n;return r=new Dh({props:{data:e[11],domainColumn:e[0],selectedValues:e[2],opacity:e[10],searchQuery:e[13],showAnnotations:e[14],highlightedData:e[8],startDate:e[3],endDate:e[4]}}),{c(){tf(r.$$.fragment)},m(a,d){ja(r,a,d),n=!0},p(a,d){const m={};d[0]&2048&&(m.data=a[11]),d[0]&1&&(m.domainColumn=a[0]),d[0]&4&&(m.selectedValues=a[2]),d[0]&1024&&(m.opacity=a[10]),d[0]&8192&&(m.searchQuery=a[13]),d[0]&16384&&(m.showAnnotations=a[14]),d[0]&256&&(m.highlightedData=a[8]),d[0]&8&&(m.startDate=a[3]),d[0]&16&&(m.endDate=a[4]),r.$set(m)},i(a){n||(Dr(r.$$.fragment,a),n=!0)},o(a){nn(r.$$.fragment,a),n=!1},d(a){Va(r,a)}}}function Uh(e){let r,n,a,d,m,T,y,N,x,q,ee,ve,Me,ke,lt,Ce,Ye,st,gt,vt,Ke,pt,We,L,O,H,P,fe,Te,at,St,De,Se,Ne,ue=Ur(e[3])+"",Je,Be,Qe,Oe=Ur(e[4])+"",xt,_t,ut,Re,Le,we,$e,et,Et,Ct,At,ht,ft,Dt,ze,dt,bt,lr,nr,f=e[9].length&&ks(e),yt=e[1].length&&Fs(e);function ar(ot){e[28](ot)}function Bt(ot){e[29](ot)}let qt={min:0,max:e[5].length-1};e[6]!==void 0&&(qt.startValue=e[6]),e[7]!==void 0&&(qt.endValue=e[7]),Te=new Nh({props:qt}),Vr.push(()=>fs(Te,"startValue",ar)),Vr.push(()=>fs(Te,"endValue",Bt)),Te.$on("startChange",e[30]),Te.$on("endChange",e[31]);function Yt(ot,Tt){return ot[12]?Mh:Ih}let mr=Yt(e),tr=mr(e);const cr=[Ph,Bh],zt=[];function xr(ot,Tt){return ot[11].length?0:1}return ze=xr(e),dt=zt[ze]=cr[ze](e),{c(){r=nt("div"),n=nt("div"),a=Lt(),d=nt("div"),m=nt("div"),T=nt("label"),T.textContent="\u{1F4C1} Upload CSV:",y=Lt(),N=nt("input"),x=Lt(),q=nt("label"),q.textContent="\u{1F50D} Search Title:",ee=Lt(),ve=nt("input"),Me=Lt(),f&&f.c(),ke=Lt(),yt&&yt.c(),lt=Lt(),Ce=nt("label"),Ce.textContent="\u{1F4A1} Adjust Opacity:",Ye=Lt(),st=nt("input"),gt=Lt(),vt=nt("div"),Ke=nt("label"),Ke.textContent="\u{1F4C5} Date Range:",pt=Lt(),We=nt("input"),O=Lt(),H=nt("input"),fe=Lt(),tf(Te.$$.fragment),De=Lt(),Se=nt("div"),Ne=nt("span"),Je=yr(ue),Be=Lt(),Qe=nt("span"),xt=yr(Oe),_t=Lt(),ut=nt("div"),Re=nt("button"),Re.textContent="-1W",Le=Lt(),we=nt("button"),we.textContent="-1D",$e=Lt(),et=nt("button"),tr.c(),Et=Lt(),Ct=nt("button"),Ct.textContent="+1D",At=Lt(),ht=nt("button"),ht.textContent="+1W",ft=Lt(),Dt=nt("div"),dt.c(),Ge(n,"class","title-section svelte-bcjotp"),Ge(T,"for","file-upload"),Ge(T,"class","svelte-bcjotp"),Ge(N,"id","file-upload"),Ge(N,"type","file"),Ge(N,"accept",".csv"),Ge(N,"class","svelte-bcjotp"),Ge(q,"for","search-input"),Ge(q,"class","svelte-bcjotp"),Ge(ve,"id","search-input"),Ge(ve,"type","text"),Ge(ve,"placeholder","Search..."),Ge(ve,"class","svelte-bcjotp"),Ge(Ce,"for","opacity-slider"),Ge(Ce,"class","svelte-bcjotp"),Ge(st,"id","opacity-slider"),Ge(st,"type","range"),Ge(st,"min","0.01"),Ge(st,"max","1"),Ge(st,"step","0.1"),Ge(st,"class","svelte-bcjotp"),Ge(Ke,"for","start-date"),Ge(Ke,"class","svelte-bcjotp"),Ge(We,"id","start-date"),Ge(We,"type","date"),We.value=L=Ur(e[3]),Ge(We,"class","svelte-bcjotp"),Ge(H,"id","end-date"),Ge(H,"type","date"),H.value=P=Ur(e[4]),Ge(H,"class","svelte-bcjotp"),Ge(Se,"class","date-range-labels svelte-bcjotp"),Ge(Re,"class","svelte-bcjotp"),Ge(we,"class","svelte-bcjotp"),Ge(et,"class","play-button svelte-bcjotp"),Ge(Ct,"class","svelte-bcjotp"),Ge(ht,"class","svelte-bcjotp"),Ge(ut,"class","date-navigation svelte-bcjotp"),Ge(vt,"class","date-controls svelte-bcjotp"),Ge(m,"class","filter-panel svelte-bcjotp"),Ge(Dt,"class","scatterplot-container svelte-bcjotp"),Ge(d,"class","content svelte-bcjotp"),Ge(r,"class","container svelte-bcjotp")},m(ot,Tt){Mt(ot,r,Tt),je(r,n),je(r,a),je(r,d),je(d,m),je(m,T),je(m,y),je(m,N),je(m,x),je(m,q),je(m,ee),je(m,ve),je(m,Me),f&&f.m(m,null),je(m,ke),yt&&yt.m(m,null),je(m,lt),je(m,Ce),je(m,Ye),je(m,st),ns(st,e[10]),je(m,gt),je(m,vt),je(vt,Ke),je(vt,pt),je(vt,We),je(vt,O),je(vt,H),je(vt,fe),ja(Te,vt,null),je(vt,De),je(vt,Se),je(Se,Ne),je(Ne,Je),je(Se,Be),je(Se,Qe),je(Qe,xt),je(vt,_t),je(vt,ut),je(ut,Re),je(ut,Le),je(ut,we),je(ut,$e),je(ut,et),tr.m(et,null),je(ut,Et),je(ut,Ct),je(ut,At),je(ut,ht),je(d,ft),je(d,Dt),zt[ze].m(Dt,null),bt=!0,lr||(nr=[Vt(N,"change",e[18]),Vt(ve,"input",e[21]),Vt(st,"change",e[25]),Vt(st,"input",e[25]),Vt(st,"input",e[22]),Vt(We,"change",e[26]),Vt(H,"change",e[27]),Vt(Re,"click",e[32]),Vt(we,"click",e[33]),Vt(et,"click",e[20]),Vt(Ct,"click",e[34]),Vt(ht,"click",e[35])],lr=!0)},p(ot,Tt){ot[9].length?f?f.p(ot,Tt):(f=ks(ot),f.c(),f.m(m,ke)):f&&(f.d(1),f=null),ot[1].length?yt?yt.p(ot,Tt):(yt=Fs(ot),yt.c(),yt.m(m,lt)):yt&&(yt.d(1),yt=null),Tt[0]&1024&&ns(st,ot[10]),(!bt||Tt[0]&8&&L!==(L=Ur(ot[3])))&&(We.value=L),(!bt||Tt[0]&16&&P!==(P=Ur(ot[4])))&&(H.value=P);const Fr={};Tt[0]&32&&(Fr.max=ot[5].length-1),!at&&Tt[0]&64&&(at=!0,Fr.startValue=ot[6],is(()=>at=!1)),!St&&Tt[0]&128&&(St=!0,Fr.endValue=ot[7],is(()=>St=!1)),Te.$set(Fr),(!bt||Tt[0]&8)&&ue!==(ue=Ur(ot[3])+"")&&jr(Je,ue),(!bt||Tt[0]&16)&&Oe!==(Oe=Ur(ot[4])+"")&&jr(xt,Oe),mr!==(mr=Yt(ot))&&(tr.d(1),tr=mr(ot),tr&&(tr.c(),tr.m(et,null)));let fn=ze;ze=xr(ot),ze===fn?zt[ze].p(ot,Tt):(Ps(),nn(zt[fn],1,1,()=>{zt[fn]=null}),Us(),dt=zt[ze],dt?dt.p(ot,Tt):(dt=zt[ze]=cr[ze](ot),dt.c()),Dr(dt,1),dt.m(Dt,null))},i(ot){bt||(Dr(Te.$$.fragment,ot),Dr(dt),bt=!0)},o(ot){nn(Te.$$.fragment,ot),nn(dt),bt=!1},d(ot){ot&&Ft(r),f&&f.d(),yt&&yt.d(),Va(Te),tr.d(),zt[ze].d(),lr=!1,zr(nr)}}}function Ur(e){return e?e.toISOString().split("T")[0]:""}function jh(e,r,n){let a=[],d=[],m="org",T=[],y=new Set,N=.5,x=null,q=null,ee=[],ve=[],Me=0,ke=0,lt=!1,Ce=null,Ye=[],st="",gt=!0;ef(async()=>{const Le=await(await fetch("/semantic-maps/data.csv")).text();return vt(Le),()=>{Ce&&clearInterval(Ce)}});function vt(Re){const Le=yd.parse(Re,{header:!0});n(23,a=Le.data.filter(we=>we.x&&we.y&&we.date).map((we,$e)=>({...we,x:+we.x,y:+we.y,date:new Date(we.date),id:$e}))),n(9,d=Le.meta.fields||[]),n(5,ve=[...new Set(a.map(we=>we.date.getTime()))].sort((we,$e)=>we-$e).map(we=>new Date(we))),n(3,x=ve[0]),n(4,q=ve[ve.length-1]),n(6,Me=0),n(7,ke=ve.length-1),m&&n(1,T=[...new Set(a.map(we=>we[m]).filter(Boolean))])}function Ke(Re){n(0,m=Re.target.value),n(1,T=m?[...new Set(a.map(Le=>Le[m]).filter(Boolean))]:[]),n(2,y=new Set),n(14,gt=!1)}function pt(Re){const Le=[...Re.target.selectedOptions].map($e=>$e.value);Le.length===T.length||Le.length===0?(n(2,y=new Set),n(8,Ye=[])):(n(2,y=new Set(Le)),n(8,Ye=a.filter($e=>y.has($e[m])&&(!x||$e.date>=x)&&(!q||$e.date<=q)))),n(14,gt=!1)}function We(Re,Le,we=!1){we?(n(3,x=ve[Re]||ve[0]),n(4,q=ve[Le]||ve[ve.length-1])):(n(3,x=Re),n(4,q=Le)),n(14,gt=!1)}function L(){if(x){const Re=x.getTime();n(6,Me=Math.max(0,ve.findIndex(Le=>Le.getTime()>=Re)))}else n(6,Me=0);if(q){const Re=q.getTime(),Le=ve.findIndex(we=>we.getTime()>=Re);n(7,ke=Le>=0?Le:ve.length>0?ve.length-1:0)}else n(7,ke=ve.length-1);Me>ke&&n(6,Me=ke),ke<Me&&n(7,ke=Me)}function O(Re,Le){if(Re.detail!==void 0)Le==="start"?(n(6,Me=Re.detail),Me>ke&&n(6,Me=ke)):(n(7,ke=Re.detail),ke<Me&&n(7,ke=Me)),We(Me,ke,!0);else{const we=Re.target.value?new Date(Re.target.value):null;Le==="start"?We(we,q):We(x,we),L()}}function H(Re){const Le=Re.target.files[0];if(Le){const we=new FileReader;n(14,gt=!1),we.onload=$e=>vt($e.target.result),we.readAsText(Le)}}function P(Re){const Le=ke-Me;let we=Me+Re,$e=ke+Re;we<0&&(we=0,$e=Le),$e>=ve.length&&($e=ve.length-1,we=Math.max(0,$e-Le)),n(6,Me=we),n(7,ke=$e),We(Me,ke,!0)}function fe(){lt?(clearInterval(Ce),n(12,lt=!1)):(n(12,lt=!0),n(14,gt=!1),Ce=setInterval(()=>{if(ke>=ve.length-1){clearInterval(Ce),n(12,lt=!1);return}P(1)},500))}function Te(Re){n(13,st=Re.target.value),n(14,gt=!1)}function at(){n(14,gt=!1)}function St(){m=cd(this),n(0,m),n(9,d)}function De(){N=ud(this.value),n(10,N)}const Se=Re=>O(Re,"start"),Ne=Re=>O(Re,"end");function ue(Re){Me=Re,n(6,Me)}function Je(Re){ke=Re,n(7,ke)}const Be=Re=>O(Re,"start"),Qe=Re=>O(Re,"end"),Oe=()=>P(-7),xt=()=>P(-1),_t=()=>P(1),ut=()=>P(7);return e.$$.update=()=>{e.$$.dirty[0]&256&&new Set(Ye.map(Re=>Re.id)),e.$$.dirty[0]&8388639&&n(11,ee=a.map(Re=>({...Re,isHighlighted:y.size>0&&y.size<T.length&&y.has(Re[m])&&(!x||Re.date>=x)&&(!q||Re.date<=q)}))),e.$$.dirty[0]&96&&ve.length>1&&Me/(ve.length-1)*100,e.$$.dirty[0]&160&&ve.length>1&&ke/(ve.length-1)*100},[m,T,y,x,q,ve,Me,ke,Ye,d,N,ee,lt,st,gt,Ke,pt,O,H,P,fe,Te,at,a,St,De,Se,Ne,ue,Je,Be,Qe,Oe,xt,_t,ut]}class Vh extends Ha{constructor(r){super(),za(this,r,jh,Uh,Ua,{},null,[-1,-1])}}new Vh({target:document.getElementById("app")});
